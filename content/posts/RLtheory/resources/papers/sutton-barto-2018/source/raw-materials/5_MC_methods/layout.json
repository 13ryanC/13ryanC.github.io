{
    "pdf_info": [
        {
            "para_blocks": [
                {
                    "bbox": [
                        105,
                        215,
                        220,
                        240
                    ],
                    "type": "title",
                    "lines": [
                        {
                            "bbox": [
                                105,
                                215,
                                220,
                                240
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        105,
                                        215,
                                        220,
                                        240
                                    ],
                                    "type": "text",
                                    "content": "Chapter 5"
                                }
                            ]
                        }
                    ],
                    "index": 0,
                    "level": 1
                },
                {
                    "bbox": [
                        104,
                        267,
                        406,
                        296
                    ],
                    "type": "title",
                    "lines": [
                        {
                            "bbox": [
                                104,
                                267,
                                406,
                                296
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        104,
                                        267,
                                        406,
                                        296
                                    ],
                                    "type": "text",
                                    "content": "Monte Carlo Methods"
                                }
                            ]
                        }
                    ],
                    "index": 1,
                    "level": 1
                },
                {
                    "bbox": [
                        104,
                        340,
                        530,
                        485
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                104,
                                340,
                                530,
                                485
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        104,
                                        340,
                                        530,
                                        485
                                    ],
                                    "type": "text",
                                    "content": "In this chapter we consider our first learning methods for estimating value functions and discovering optimal policies. Unlike the previous chapter, here we do not assume complete knowledge of the environment. Monte Carlo methods require only experience- sample sequences of states, actions, and rewards from actual or simulated interaction with an environment. Learning from actual experience is striking because it requires no prior knowledge of the environment's dynamics, yet can still attain optimal behavior. Learning from simulated experience is also powerful. Although a model is required, the model need only generate sample transitions, not the complete probability distributions of all possible transitions that is required for dynamic programming (DP). In surprisingly many cases it is easy to generate experience sampled according to the desired probability distributions, but infeasible to obtain the distributions in explicit form."
                                }
                            ]
                        }
                    ],
                    "index": 2
                },
                {
                    "bbox": [
                        104,
                        487,
                        530,
                        619
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                104,
                                487,
                                530,
                                619
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        104,
                                        487,
                                        530,
                                        619
                                    ],
                                    "type": "text",
                                    "content": "Monte Carlo methods are ways of solving the reinforcement learning problem based on averaging sample returns. To ensure that well- defined returns are available, here we define Monte Carlo methods only for episodic tasks. That is, we assume experience is divided into episodes, and that all episodes eventually terminate no matter what actions are selected. Only on the completion of an episode are value estimates and policies changed. Monte Carlo methods can thus be incremental in an episode- by- episode sense, but not in a step- by- step (online) sense. The term \"Monte Carlo\" is often used more broadly for any estimation method whose operation involves a significant random component. Here we use it specifically for methods based on averaging complete returns (as opposed to methods that learn from partial returns, considered in the next chapter)."
                                }
                            ]
                        }
                    ],
                    "index": 3
                },
                {
                    "bbox": [
                        104,
                        621,
                        530,
                        726
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                104,
                                621,
                                530,
                                726
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        104,
                                        621,
                                        530,
                                        726
                                    ],
                                    "type": "text",
                                    "content": "Monte Carlo methods sample and average returns for each state- action pair much like the bandit methods we explored in Chapter 2 sample and average rewards for each action. The main difference is that now there are multiple states, each acting like a different bandit problem (like an associative- search or contextual bandit) and the different bandit problems are interrelated. That is, the return after taking an action in one state depends on the actions taken in later states in the same episode. Because all the action selections are undergoing learning, the problem becomes nonstationary from the point of view of the earlier state."
                                }
                            ]
                        }
                    ],
                    "index": 4
                }
            ],
            "discarded_blocks": [],
            "page_size": [
                595,
                842
            ],
            "page_idx": 0
        },
        {
            "para_blocks": [
                {
                    "bbox": [
                        64,
                        141,
                        489,
                        247
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                64,
                                141,
                                489,
                                247
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        64,
                                        141,
                                        489,
                                        247
                                    ],
                                    "type": "text",
                                    "content": "To handle the nonstationarity, we adapt the idea of general policy iteration (GPI) developed in Chapter 4 for DP. Whereas there we computed value functions from knowledge of the MDP, here we learn value functions from sample returns with the MDP. The value functions and corresponding policies still interact to attain optimality in essentially the same way (GPI). As in the DP chapter, first we consider the prediction problem (the computation of "
                                },
                                {
                                    "bbox": [
                                        64,
                                        141,
                                        489,
                                        247
                                    ],
                                    "type": "inline_equation",
                                    "content": "v_{\\pi}"
                                },
                                {
                                    "bbox": [
                                        64,
                                        141,
                                        489,
                                        247
                                    ],
                                    "type": "text",
                                    "content": " and "
                                },
                                {
                                    "bbox": [
                                        64,
                                        141,
                                        489,
                                        247
                                    ],
                                    "type": "inline_equation",
                                    "content": "q_{\\pi}"
                                },
                                {
                                    "bbox": [
                                        64,
                                        141,
                                        489,
                                        247
                                    ],
                                    "type": "text",
                                    "content": " for a fixed arbitrary policy "
                                },
                                {
                                    "bbox": [
                                        64,
                                        141,
                                        489,
                                        247
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\pi"
                                },
                                {
                                    "bbox": [
                                        64,
                                        141,
                                        489,
                                        247
                                    ],
                                    "type": "text",
                                    "content": ") then policy improvement, and, finally, the control problem and its solution by GPI. Each of these ideas taken from DP is extended to the Monte Carlo case in which only sample experience is available."
                                }
                            ]
                        }
                    ],
                    "index": 0
                },
                {
                    "bbox": [
                        64,
                        267,
                        292,
                        286
                    ],
                    "type": "title",
                    "lines": [
                        {
                            "bbox": [
                                64,
                                267,
                                292,
                                286
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        64,
                                        267,
                                        292,
                                        286
                                    ],
                                    "type": "text",
                                    "content": "5.1 Monte Carlo Prediction"
                                }
                            ]
                        }
                    ],
                    "index": 1,
                    "level": 1
                },
                {
                    "bbox": [
                        64,
                        297,
                        489,
                        376
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                64,
                                297,
                                489,
                                376
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        64,
                                        297,
                                        489,
                                        376
                                    ],
                                    "type": "text",
                                    "content": "We begin by considering Monte Carlo methods for learning the state- value function for a given policy. Recall that the value of a state is the expected return—expected cumulative future discounted reward—starting from that state. An obvious way to estimate it from experience, then, is simply to average the returns observed after visits to that state. As more returns are observed, the average should converge to the expected value. This idea underlies all Monte Carlo methods."
                                }
                            ]
                        }
                    ],
                    "index": 2
                },
                {
                    "bbox": [
                        64,
                        378,
                        489,
                        537
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                64,
                                378,
                                489,
                                537
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        64,
                                        378,
                                        489,
                                        537
                                    ],
                                    "type": "text",
                                    "content": "In particular, suppose we wish to estimate "
                                },
                                {
                                    "bbox": [
                                        64,
                                        378,
                                        489,
                                        537
                                    ],
                                    "type": "inline_equation",
                                    "content": "v_{\\pi}(s)"
                                },
                                {
                                    "bbox": [
                                        64,
                                        378,
                                        489,
                                        537
                                    ],
                                    "type": "text",
                                    "content": ", the value of a state "
                                },
                                {
                                    "bbox": [
                                        64,
                                        378,
                                        489,
                                        537
                                    ],
                                    "type": "inline_equation",
                                    "content": "s"
                                },
                                {
                                    "bbox": [
                                        64,
                                        378,
                                        489,
                                        537
                                    ],
                                    "type": "text",
                                    "content": " under policy "
                                },
                                {
                                    "bbox": [
                                        64,
                                        378,
                                        489,
                                        537
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\pi"
                                },
                                {
                                    "bbox": [
                                        64,
                                        378,
                                        489,
                                        537
                                    ],
                                    "type": "text",
                                    "content": ", given a set of episodes obtained by following "
                                },
                                {
                                    "bbox": [
                                        64,
                                        378,
                                        489,
                                        537
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\pi"
                                },
                                {
                                    "bbox": [
                                        64,
                                        378,
                                        489,
                                        537
                                    ],
                                    "type": "text",
                                    "content": " and passing through "
                                },
                                {
                                    "bbox": [
                                        64,
                                        378,
                                        489,
                                        537
                                    ],
                                    "type": "inline_equation",
                                    "content": "s"
                                },
                                {
                                    "bbox": [
                                        64,
                                        378,
                                        489,
                                        537
                                    ],
                                    "type": "text",
                                    "content": ". Each occurrence of state "
                                },
                                {
                                    "bbox": [
                                        64,
                                        378,
                                        489,
                                        537
                                    ],
                                    "type": "inline_equation",
                                    "content": "s"
                                },
                                {
                                    "bbox": [
                                        64,
                                        378,
                                        489,
                                        537
                                    ],
                                    "type": "text",
                                    "content": " in an episode is called a visit to "
                                },
                                {
                                    "bbox": [
                                        64,
                                        378,
                                        489,
                                        537
                                    ],
                                    "type": "inline_equation",
                                    "content": "s"
                                },
                                {
                                    "bbox": [
                                        64,
                                        378,
                                        489,
                                        537
                                    ],
                                    "type": "text",
                                    "content": ". Of course, "
                                },
                                {
                                    "bbox": [
                                        64,
                                        378,
                                        489,
                                        537
                                    ],
                                    "type": "inline_equation",
                                    "content": "s"
                                },
                                {
                                    "bbox": [
                                        64,
                                        378,
                                        489,
                                        537
                                    ],
                                    "type": "text",
                                    "content": " may be visited multiple times in the same episode; let us call the first time it is visited in an episode the first visit to "
                                },
                                {
                                    "bbox": [
                                        64,
                                        378,
                                        489,
                                        537
                                    ],
                                    "type": "inline_equation",
                                    "content": "s"
                                },
                                {
                                    "bbox": [
                                        64,
                                        378,
                                        489,
                                        537
                                    ],
                                    "type": "text",
                                    "content": ". The first- visit MC method estimates "
                                },
                                {
                                    "bbox": [
                                        64,
                                        378,
                                        489,
                                        537
                                    ],
                                    "type": "inline_equation",
                                    "content": "v_{\\pi}(s)"
                                },
                                {
                                    "bbox": [
                                        64,
                                        378,
                                        489,
                                        537
                                    ],
                                    "type": "text",
                                    "content": " as the average of the returns following first visits to "
                                },
                                {
                                    "bbox": [
                                        64,
                                        378,
                                        489,
                                        537
                                    ],
                                    "type": "inline_equation",
                                    "content": "s"
                                },
                                {
                                    "bbox": [
                                        64,
                                        378,
                                        489,
                                        537
                                    ],
                                    "type": "text",
                                    "content": ", whereas the every- visit MC method averages the returns following all visits to "
                                },
                                {
                                    "bbox": [
                                        64,
                                        378,
                                        489,
                                        537
                                    ],
                                    "type": "inline_equation",
                                    "content": "s"
                                },
                                {
                                    "bbox": [
                                        64,
                                        378,
                                        489,
                                        537
                                    ],
                                    "type": "text",
                                    "content": ". These two Monte Carlo (MC) methods are very similar but have slightly different theoretical properties. First- visit MC has been most widely studied, dating back to the 1940s, and is the one we focus on in this chapter. Every- visit MC extends more naturally to function approximation and eligibility traces, as discussed in Chapters 9 and 12. First- visit MC is shown in procedural form in the box. Every- visit MC would be the same except without the check for "
                                },
                                {
                                    "bbox": [
                                        64,
                                        378,
                                        489,
                                        537
                                    ],
                                    "type": "inline_equation",
                                    "content": "S_{t}"
                                },
                                {
                                    "bbox": [
                                        64,
                                        378,
                                        489,
                                        537
                                    ],
                                    "type": "text",
                                    "content": " having occurred earlier in the episode."
                                }
                            ]
                        }
                    ],
                    "index": 3
                },
                {
                    "bbox": [
                        77,
                        552,
                        325,
                        564
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                77,
                                552,
                                325,
                                564
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        77,
                                        552,
                                        325,
                                        564
                                    ],
                                    "type": "text",
                                    "content": "First- visit MC prediction, for estimating "
                                },
                                {
                                    "bbox": [
                                        77,
                                        552,
                                        325,
                                        564
                                    ],
                                    "type": "inline_equation",
                                    "content": "V \\approx v_{\\pi}"
                                }
                            ]
                        }
                    ],
                    "index": 4
                },
                {
                    "bbox": [
                        77,
                        575,
                        229,
                        586
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                77,
                                575,
                                229,
                                586
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        77,
                                        575,
                                        229,
                                        586
                                    ],
                                    "type": "text",
                                    "content": "Input: a policy "
                                },
                                {
                                    "bbox": [
                                        77,
                                        575,
                                        229,
                                        586
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\pi"
                                },
                                {
                                    "bbox": [
                                        77,
                                        575,
                                        229,
                                        586
                                    ],
                                    "type": "text",
                                    "content": " to be evaluated"
                                }
                            ]
                        }
                    ],
                    "index": 5
                },
                {
                    "bbox": [
                        77,
                        589,
                        121,
                        599
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                77,
                                589,
                                121,
                                599
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        77,
                                        589,
                                        121,
                                        599
                                    ],
                                    "type": "text",
                                    "content": "Initialize:"
                                }
                            ]
                        }
                    ],
                    "index": 6
                },
                {
                    "bbox": [
                        95,
                        601,
                        248,
                        612
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                95,
                                601,
                                248,
                                612
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        95,
                                        601,
                                        248,
                                        612
                                    ],
                                    "type": "inline_equation",
                                    "content": "V(s) \\in \\mathbb{R}"
                                },
                                {
                                    "bbox": [
                                        95,
                                        601,
                                        248,
                                        612
                                    ],
                                    "type": "text",
                                    "content": ", arbitrarily, for all "
                                },
                                {
                                    "bbox": [
                                        95,
                                        601,
                                        248,
                                        612
                                    ],
                                    "type": "inline_equation",
                                    "content": "s \\in \\mathbb{S}"
                                }
                            ]
                        }
                    ],
                    "index": 7
                },
                {
                    "bbox": [
                        95,
                        612,
                        281,
                        624
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                95,
                                612,
                                281,
                                624
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        95,
                                        612,
                                        281,
                                        624
                                    ],
                                    "type": "text",
                                    "content": "Returns "
                                },
                                {
                                    "bbox": [
                                        95,
                                        612,
                                        281,
                                        624
                                    ],
                                    "type": "inline_equation",
                                    "content": "(s) \\leftarrow"
                                },
                                {
                                    "bbox": [
                                        95,
                                        612,
                                        281,
                                        624
                                    ],
                                    "type": "text",
                                    "content": " an empty list, for all "
                                },
                                {
                                    "bbox": [
                                        95,
                                        612,
                                        281,
                                        624
                                    ],
                                    "type": "inline_equation",
                                    "content": "s \\in \\mathbb{S}"
                                }
                            ]
                        }
                    ],
                    "index": 8
                },
                {
                    "bbox": [
                        77,
                        631,
                        221,
                        643
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                77,
                                631,
                                221,
                                643
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        77,
                                        631,
                                        221,
                                        643
                                    ],
                                    "type": "text",
                                    "content": "Loop forever (for each episode):"
                                }
                            ]
                        }
                    ],
                    "index": 9
                },
                {
                    "bbox": [
                        94,
                        644,
                        435,
                        666
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                94,
                                644,
                                435,
                                666
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        94,
                                        644,
                                        435,
                                        666
                                    ],
                                    "type": "text",
                                    "content": "Generate an episode following "
                                },
                                {
                                    "bbox": [
                                        94,
                                        644,
                                        435,
                                        666
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\pi"
                                },
                                {
                                    "bbox": [
                                        94,
                                        644,
                                        435,
                                        666
                                    ],
                                    "type": "text",
                                    "content": ": "
                                },
                                {
                                    "bbox": [
                                        94,
                                        644,
                                        435,
                                        666
                                    ],
                                    "type": "inline_equation",
                                    "content": "S_{0}, A_{0}, R_{1}, S_{1}, A_{1}, R_{2}, \\ldots , S_{T - 1}, A_{T - 1}, R_{T}"
                                },
                                {
                                    "bbox": [
                                        94,
                                        644,
                                        435,
                                        666
                                    ],
                                    "type": "inline_equation",
                                    "content": "G \\leftarrow 0"
                                }
                            ]
                        }
                    ],
                    "index": 10
                },
                {
                    "bbox": [
                        95,
                        668,
                        329,
                        680
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                95,
                                668,
                                329,
                                680
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        95,
                                        668,
                                        329,
                                        680
                                    ],
                                    "type": "text",
                                    "content": "Loop for each step of episode, "
                                },
                                {
                                    "bbox": [
                                        95,
                                        668,
                                        329,
                                        680
                                    ],
                                    "type": "inline_equation",
                                    "content": "t = T - 1, T - 2, \\ldots , 0"
                                },
                                {
                                    "bbox": [
                                        95,
                                        668,
                                        329,
                                        680
                                    ],
                                    "type": "text",
                                    "content": ":"
                                }
                            ]
                        }
                    ],
                    "index": 11
                },
                {
                    "bbox": [
                        114,
                        681,
                        189,
                        692
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                114,
                                681,
                                189,
                                692
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        114,
                                        681,
                                        189,
                                        692
                                    ],
                                    "type": "inline_equation",
                                    "content": "G \\leftarrow \\gamma G + R_{t + 1}"
                                }
                            ]
                        }
                    ],
                    "index": 12
                },
                {
                    "bbox": [
                        114,
                        692,
                        281,
                        705
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                114,
                                692,
                                281,
                                705
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        114,
                                        692,
                                        281,
                                        705
                                    ],
                                    "type": "text",
                                    "content": "Unless "
                                },
                                {
                                    "bbox": [
                                        114,
                                        692,
                                        281,
                                        705
                                    ],
                                    "type": "inline_equation",
                                    "content": "S_{t}"
                                },
                                {
                                    "bbox": [
                                        114,
                                        692,
                                        281,
                                        705
                                    ],
                                    "type": "text",
                                    "content": " appears in "
                                },
                                {
                                    "bbox": [
                                        114,
                                        692,
                                        281,
                                        705
                                    ],
                                    "type": "inline_equation",
                                    "content": "S_{0}, S_{1}, \\ldots , S_{t - 1}"
                                },
                                {
                                    "bbox": [
                                        114,
                                        692,
                                        281,
                                        705
                                    ],
                                    "type": "text",
                                    "content": ":"
                                }
                            ]
                        }
                    ],
                    "index": 13
                },
                {
                    "bbox": [
                        129,
                        705,
                        270,
                        716
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                129,
                                705,
                                270,
                                716
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        129,
                                        705,
                                        270,
                                        716
                                    ],
                                    "type": "text",
                                    "content": "Append "
                                },
                                {
                                    "bbox": [
                                        129,
                                        705,
                                        270,
                                        716
                                    ],
                                    "type": "inline_equation",
                                    "content": "G"
                                },
                                {
                                    "bbox": [
                                        129,
                                        705,
                                        270,
                                        716
                                    ],
                                    "type": "text",
                                    "content": " to "
                                },
                                {
                                    "bbox": [
                                        129,
                                        705,
                                        270,
                                        716
                                    ],
                                    "type": "inline_equation",
                                    "content": "Returns(S_{t})"
                                }
                            ]
                        }
                    ],
                    "index": 14
                },
                {
                    "bbox": [
                        129,
                        717,
                        270,
                        730
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                129,
                                717,
                                270,
                                730
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        129,
                                        717,
                                        270,
                                        730
                                    ],
                                    "type": "inline_equation",
                                    "content": "V(S_{t}) \\leftarrow"
                                },
                                {
                                    "bbox": [
                                        129,
                                        717,
                                        270,
                                        730
                                    ],
                                    "type": "text",
                                    "content": " average(Returns(St))"
                                }
                            ]
                        }
                    ],
                    "index": 15
                }
            ],
            "discarded_blocks": [],
            "page_size": [
                595,
                842
            ],
            "page_idx": 1
        },
        {
            "para_blocks": [
                {
                    "bbox": [
                        104,
                        141,
                        530,
                        246
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                104,
                                141,
                                530,
                                246
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        104,
                                        141,
                                        530,
                                        246
                                    ],
                                    "type": "text",
                                    "content": "Both first- visit MC and every- visit MC converge to "
                                },
                                {
                                    "bbox": [
                                        104,
                                        141,
                                        530,
                                        246
                                    ],
                                    "type": "inline_equation",
                                    "content": "v_{\\pi}(s)"
                                },
                                {
                                    "bbox": [
                                        104,
                                        141,
                                        530,
                                        246
                                    ],
                                    "type": "text",
                                    "content": " as the number of visits (or first visits) to "
                                },
                                {
                                    "bbox": [
                                        104,
                                        141,
                                        530,
                                        246
                                    ],
                                    "type": "inline_equation",
                                    "content": "s"
                                },
                                {
                                    "bbox": [
                                        104,
                                        141,
                                        530,
                                        246
                                    ],
                                    "type": "text",
                                    "content": " goes to infinity. This is easy to see for the case of first- visit MC. In this case each return is an independent, identically distributed estimate of "
                                },
                                {
                                    "bbox": [
                                        104,
                                        141,
                                        530,
                                        246
                                    ],
                                    "type": "inline_equation",
                                    "content": "v_{\\pi}(s)"
                                },
                                {
                                    "bbox": [
                                        104,
                                        141,
                                        530,
                                        246
                                    ],
                                    "type": "text",
                                    "content": " with finite variance. By the law of large numbers the sequence of averages of these estimates converges to their expected value. Each average is itself an unbiased estimate, and the standard deviation of its error falls as "
                                },
                                {
                                    "bbox": [
                                        104,
                                        141,
                                        530,
                                        246
                                    ],
                                    "type": "inline_equation",
                                    "content": "1 / \\sqrt{n}"
                                },
                                {
                                    "bbox": [
                                        104,
                                        141,
                                        530,
                                        246
                                    ],
                                    "type": "text",
                                    "content": ", where "
                                },
                                {
                                    "bbox": [
                                        104,
                                        141,
                                        530,
                                        246
                                    ],
                                    "type": "inline_equation",
                                    "content": "n"
                                },
                                {
                                    "bbox": [
                                        104,
                                        141,
                                        530,
                                        246
                                    ],
                                    "type": "text",
                                    "content": " is the number of returns averaged. Every- visit MC is less straightforward, but its estimates also converge quadratically to "
                                },
                                {
                                    "bbox": [
                                        104,
                                        141,
                                        530,
                                        246
                                    ],
                                    "type": "inline_equation",
                                    "content": "v_{\\pi}(s)"
                                },
                                {
                                    "bbox": [
                                        104,
                                        141,
                                        530,
                                        246
                                    ],
                                    "type": "text",
                                    "content": " (Singh and Sutton, 1996)."
                                }
                            ]
                        }
                    ],
                    "index": 0
                },
                {
                    "bbox": [
                        114,
                        248,
                        468,
                        261
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                114,
                                248,
                                468,
                                261
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        114,
                                        248,
                                        468,
                                        261
                                    ],
                                    "type": "text",
                                    "content": "The use of Monte Carlo methods is best illustrated through an example."
                                }
                            ]
                        }
                    ],
                    "index": 1
                },
                {
                    "bbox": [
                        104,
                        266,
                        530,
                        437
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                104,
                                266,
                                530,
                                437
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        104,
                                        266,
                                        530,
                                        437
                                    ],
                                    "type": "text",
                                    "content": "Example 5.1: Blackjack The object of the popular casino card game of blackjack is to obtain cards the sum of whose numerical values is as great as possible without exceeding 21. All face cards count as 10, and an ace can count either as 1 or as 11. We consider the version in which each player competes independently against the dealer. The game begins with two cards dealt to both dealer and player. One of the dealer's cards is face up and the other is face down. If the player has 21 immediately (an ace and a 10- card), it is called a natural. He then wins unless the dealer also has a natural, in which case the game is a draw. If the player does not have a natural, then he can request additional cards, one by one (hits), until he either stops (sticks) or exceeds 21 (goes bust). If he goes bust, he loses; if he sticks, then it becomes the dealer's turn. The dealer hits or sticks according to a fixed strategy without choice: he sticks on any sum of 17 or greater, and hits otherwise. If the dealer goes bust, then the player wins; otherwise, the outcome—win, lose, or draw—is determined by whose final sum is closer to 21."
                                }
                            ]
                        }
                    ],
                    "index": 2
                },
                {
                    "bbox": [
                        104,
                        439,
                        530,
                        611
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                104,
                                439,
                                530,
                                611
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        104,
                                        439,
                                        530,
                                        611
                                    ],
                                    "type": "text",
                                    "content": "Playing blackjack is naturally formulated as an episodic finite MDP. Each game of blackjack is an episode. Rewards of "
                                },
                                {
                                    "bbox": [
                                        104,
                                        439,
                                        530,
                                        611
                                    ],
                                    "type": "inline_equation",
                                    "content": "+1"
                                },
                                {
                                    "bbox": [
                                        104,
                                        439,
                                        530,
                                        611
                                    ],
                                    "type": "text",
                                    "content": ", "
                                },
                                {
                                    "bbox": [
                                        104,
                                        439,
                                        530,
                                        611
                                    ],
                                    "type": "inline_equation",
                                    "content": "- 1"
                                },
                                {
                                    "bbox": [
                                        104,
                                        439,
                                        530,
                                        611
                                    ],
                                    "type": "text",
                                    "content": ", and 0 are given for winning, losing, and drawing, respectively. All rewards within a game are zero, and we do not discount "
                                },
                                {
                                    "bbox": [
                                        104,
                                        439,
                                        530,
                                        611
                                    ],
                                    "type": "inline_equation",
                                    "content": "(\\gamma = 1)"
                                },
                                {
                                    "bbox": [
                                        104,
                                        439,
                                        530,
                                        611
                                    ],
                                    "type": "text",
                                    "content": "; therefore these terminal rewards are also the returns. The player's actions are to hit or to stick. The states depend on the player's cards and the dealer's showing card. We assume that cards are dealt from an infinite deck (i.e., with replacement) so that there is no advantage to keeping track of the cards already dealt. If the player holds an ace that he could count as 11 without going bust, then the ace is said to be usable. In this case it is always counted as 11 because counting it as 1 would make the sum 11 or less, in which case there is no decision to be made because, obviously, the player should always hit. Thus, the player makes decisions on the basis of three variables: his current sum (12- 21), the dealer's one showing card (ace- 10), and whether or not he holds a usable ace. This makes for a total of 200 states."
                                }
                            ]
                        }
                    ],
                    "index": 3
                },
                {
                    "bbox": [
                        104,
                        612,
                        530,
                        705
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                104,
                                612,
                                530,
                                705
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        104,
                                        612,
                                        530,
                                        705
                                    ],
                                    "type": "text",
                                    "content": "Consider the policy that sticks if the player's sum is 20 or 21, and otherwise hits. To find the state- value function for this policy by a Monte Carlo approach, one simulates many blackjack games using the policy and averages the returns following each state. In this way, we obtained the estimates of the state- value function shown in Figure 5.1. The estimates for states with a usable ace are less certain and less regular because these states are less common. In any event, after 500,000 games the value function is very well approximated."
                                }
                            ]
                        }
                    ],
                    "index": 4
                }
            ],
            "discarded_blocks": [],
            "page_size": [
                595,
                842
            ],
            "page_idx": 2
        },
        {
            "para_blocks": [
                {
                    "type": "image",
                    "bbox": [
                        108,
                        138,
                        439,
                        362
                    ],
                    "blocks": [
                        {
                            "bbox": [
                                108,
                                138,
                                439,
                                362
                            ],
                            "lines": [
                                {
                                    "bbox": [
                                        108,
                                        138,
                                        439,
                                        362
                                    ],
                                    "spans": [
                                        {
                                            "bbox": [
                                                108,
                                                138,
                                                439,
                                                362
                                            ],
                                            "type": "image",
                                            "image_path": "dfc05b497807079cba861d8e2c2ee46b2f10f810f3c505765da182e7d15dd59b.jpg"
                                        }
                                    ]
                                }
                            ],
                            "index": 0,
                            "type": "image_body"
                        },
                        {
                            "bbox": [
                                64,
                                371,
                                490,
                                396
                            ],
                            "lines": [
                                {
                                    "bbox": [
                                        64,
                                        371,
                                        490,
                                        396
                                    ],
                                    "spans": [
                                        {
                                            "bbox": [
                                                64,
                                                371,
                                                490,
                                                396
                                            ],
                                            "type": "text",
                                            "content": "Figure 5.1: Approximate state-value functions for the blackjack policy that sticks only on 20 or 21, computed by Monte Carlo policy evaluation."
                                        }
                                    ]
                                }
                            ],
                            "index": 1,
                            "type": "image_caption"
                        }
                    ],
                    "index": 0
                },
                {
                    "bbox": [
                        64,
                        423,
                        489,
                        476
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                64,
                                423,
                                489,
                                476
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        64,
                                        423,
                                        489,
                                        476
                                    ],
                                    "type": "text",
                                    "content": "Exercise 5.1 Consider the diagrams on the right in Figure 5.1. Why does the estimated value function jump up for the last two rows in the rear? Why does it drop off for the whole last row on the left? Why are the frontmost values higher in the upper diagrams than in the lower?"
                                }
                            ]
                        }
                    ],
                    "index": 2
                },
                {
                    "bbox": [
                        64,
                        481,
                        489,
                        508
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                64,
                                481,
                                489,
                                508
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        64,
                                        481,
                                        489,
                                        508
                                    ],
                                    "type": "text",
                                    "content": "Exercise 5.2 Suppose every- visit MC was used instead of first- visit MC on the blackjack task. Would you expect the results to be very different? Why or why not?"
                                }
                            ]
                        }
                    ],
                    "index": 3
                },
                {
                    "bbox": [
                        64,
                        525,
                        489,
                        671
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                64,
                                525,
                                489,
                                671
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        64,
                                        525,
                                        489,
                                        671
                                    ],
                                    "type": "text",
                                    "content": "Although we have complete knowledge of the environment in the blackjack task, it would not be easy to apply DP methods to compute the value function. DP methods require the distribution of next events—in particular, they require the environments dynamics as given by the four- argument function "
                                },
                                {
                                    "bbox": [
                                        64,
                                        525,
                                        489,
                                        671
                                    ],
                                    "type": "inline_equation",
                                    "content": "p"
                                },
                                {
                                    "bbox": [
                                        64,
                                        525,
                                        489,
                                        671
                                    ],
                                    "type": "text",
                                    "content": "—and it is not easy to determine this for blackjack. For example, suppose the player's sum is 14 and he chooses to stick. What is his probability of terminating with a reward of "
                                },
                                {
                                    "bbox": [
                                        64,
                                        525,
                                        489,
                                        671
                                    ],
                                    "type": "inline_equation",
                                    "content": "+1"
                                },
                                {
                                    "bbox": [
                                        64,
                                        525,
                                        489,
                                        671
                                    ],
                                    "type": "text",
                                    "content": " as a function of the dealer's showing card? All of the probabilities must be computed before DP can be applied, and such computations are often complex and error- prone. In contrast, generating the sample games required by Monte Carlo methods is easy. This is the case surprisingly often; the ability of Monte Carlo methods to work with sample episodes alone can be a significant advantage even when one has complete knowledge of the environment's dynamics."
                                }
                            ]
                        }
                    ],
                    "index": 4
                },
                {
                    "bbox": [
                        64,
                        672,
                        489,
                        739
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                64,
                                672,
                                489,
                                739
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        64,
                                        672,
                                        489,
                                        739
                                    ],
                                    "type": "text",
                                    "content": "Can we generalize the idea of backup diagrams to Monte Carlo algorithms? The general idea of a backup diagram is to show at the top the root node to be updated and to show below all the transitions and leaf nodes whose rewards and estimated values contribute to the update. For Monte Carlo estimation of "
                                },
                                {
                                    "bbox": [
                                        64,
                                        672,
                                        489,
                                        739
                                    ],
                                    "type": "inline_equation",
                                    "content": "v_{\\pi}"
                                },
                                {
                                    "bbox": [
                                        64,
                                        672,
                                        489,
                                        739
                                    ],
                                    "type": "text",
                                    "content": ", the root is a state node, and below it is the entire trajectory of transitions along a particular single episode, ending"
                                }
                            ]
                        }
                    ],
                    "index": 5
                }
            ],
            "discarded_blocks": [],
            "page_size": [
                595,
                842
            ],
            "page_idx": 3
        },
        {
            "para_blocks": [
                {
                    "bbox": [
                        104,
                        141,
                        498,
                        220
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                104,
                                141,
                                498,
                                220
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        104,
                                        141,
                                        498,
                                        220
                                    ],
                                    "type": "text",
                                    "content": "at the terminal state, as shown to the right. Whereas the DP diagram (page 59) shows all possible transitions, the Monte Carlo diagram shows only those sampled on the one episode. Whereas the DP diagram includes only one- step transitions, the Monte Carlo diagram goes all the way to the end of the episode. These differences in the diagrams accurately reflect the fundamental differences between the algorithms."
                                }
                            ]
                        }
                    ],
                    "index": 0
                },
                {
                    "bbox": [
                        104,
                        222,
                        496,
                        274
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                104,
                                222,
                                496,
                                274
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        104,
                                        222,
                                        496,
                                        274
                                    ],
                                    "type": "text",
                                    "content": "An important fact about Monte Carlo methods is that the estimates for each state are independent. The estimate for one state does not build upon the estimate of any other state, as is the case in DP. In other words, Monte Carlo methods do not bootstrap as we defined it in the previous chapter."
                                }
                            ]
                        }
                    ],
                    "index": 1
                },
                {
                    "bbox": [
                        104,
                        276,
                        530,
                        368
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                104,
                                276,
                                530,
                                368
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        104,
                                        276,
                                        530,
                                        368
                                    ],
                                    "type": "text",
                                    "content": "In particular, note that the computational expense of estimating the value of a single state is independent of the number of states. This can make Monte Carlo methods particularly attractive when one requires the value of only one or a subset of states. One can generate many sample episodes starting from the states of interest, averaging returns from only these states, ignoring all others. This is a third advantage Monte Carlo methods can have over DP methods (after the ability to learn from actual experience and from simulated experience)."
                                }
                            ]
                        }
                    ],
                    "index": 2
                },
                {
                    "bbox": [
                        104,
                        380,
                        333,
                        579
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                104,
                                380,
                                333,
                                579
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        104,
                                        380,
                                        333,
                                        579
                                    ],
                                    "type": "text",
                                    "content": "Example 5.2: Soap Bubble Suppose a wire frame forming a closed loop is dunked in soapy water to form a soap surface or bubble conforming at its edges to the wire frame. If the geometry of the wire frame is irregular but known, how can you compute the shape of the surface? The shape has the property that the total force on each point exerted by neighboring points is zero (or else the shape would change). This means that the surface's height at any point is the average of its heights at points in a small circle around that point. In addition, the surface must meet at its boundaries with the wire frame. The usual approach to problems of this kind is to put a grid over the area covered by"
                                }
                            ]
                        }
                    ],
                    "index": 3
                },
                {
                    "type": "image",
                    "bbox": [
                        343,
                        385,
                        528,
                        511
                    ],
                    "blocks": [
                        {
                            "bbox": [
                                343,
                                385,
                                528,
                                511
                            ],
                            "lines": [
                                {
                                    "bbox": [
                                        343,
                                        385,
                                        528,
                                        511
                                    ],
                                    "spans": [
                                        {
                                            "bbox": [
                                                343,
                                                385,
                                                528,
                                                511
                                            ],
                                            "type": "image",
                                            "image_path": "a37bc86d74816dd3dbe11da50a957ef9bdf285513890ae35fe469492254a043e.jpg"
                                        }
                                    ]
                                }
                            ],
                            "index": 4,
                            "type": "image_body"
                        },
                        {
                            "bbox": [
                                379,
                                516,
                                492,
                                528
                            ],
                            "lines": [
                                {
                                    "bbox": [
                                        379,
                                        516,
                                        492,
                                        528
                                    ],
                                    "spans": [
                                        {
                                            "bbox": [
                                                379,
                                                516,
                                                492,
                                                528
                                            ],
                                            "type": "text",
                                            "content": "A bubble on a wire loop."
                                        }
                                    ]
                                }
                            ],
                            "index": 5,
                            "type": "image_caption"
                        }
                    ],
                    "index": 4
                },
                {
                    "bbox": [
                        340,
                        532,
                        529,
                        559
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                340,
                                532,
                                529,
                                559
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        340,
                                        532,
                                        529,
                                        559
                                    ],
                                    "type": "text",
                                    "content": "From Hersh and Griego (1969). Reproduced with permission. © 1969 Scientific American, a division of Nature America, Inc. All rights reserved."
                                }
                            ]
                        }
                    ],
                    "index": 6
                },
                {
                    "bbox": [
                        104,
                        580,
                        529,
                        645
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                104,
                                580,
                                529,
                                645
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        104,
                                        580,
                                        529,
                                        645
                                    ],
                                    "type": "text",
                                    "content": "the surface and solve for its height at the grid points by an iterative computation. Grid points at the boundary are forced to the wire frame, and all others are adjusted toward the average of the heights of their four nearest neighbors. This process then iterates, much like DP's iterative policy evaluation, and ultimately converges to a close approximation to the desired surface."
                                }
                            ]
                        }
                    ],
                    "index": 7
                },
                {
                    "bbox": [
                        104,
                        647,
                        529,
                        740
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                104,
                                647,
                                529,
                                740
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        104,
                                        647,
                                        529,
                                        740
                                    ],
                                    "type": "text",
                                    "content": "This is similar to the kind of problem for which Monte Carlo methods were originally designed. Instead of the iterative computation described above, imagine standing on the surface and taking a random walk, stepping randomly from grid point to neighboring grid point, with equal probability, until you reach the boundary. It turns out that the expected value of the height at the boundary is a close approximation to the height of the desired surface at the starting point (in fact, it is exactly the value computed by the iterative method described above). Thus, one can closely approximate the height of the"
                                }
                            ]
                        }
                    ],
                    "index": 8
                }
            ],
            "discarded_blocks": [],
            "page_size": [
                595,
                842
            ],
            "page_idx": 4
        },
        {
            "para_blocks": [
                {
                    "bbox": [
                        64,
                        141,
                        489,
                        193
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                64,
                                141,
                                489,
                                193
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        64,
                                        141,
                                        489,
                                        193
                                    ],
                                    "type": "text",
                                    "content": "surface at a point by simply averaging the boundary heights of many walks started at the point. If one is interested in only the value at one point, or any fixed small set of points, then this Monte Carlo method can be far more efficient than the iterative method based on local consistency."
                                }
                            ]
                        }
                    ],
                    "index": 0
                },
                {
                    "bbox": [
                        64,
                        215,
                        432,
                        233
                    ],
                    "type": "title",
                    "lines": [
                        {
                            "bbox": [
                                64,
                                215,
                                432,
                                233
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        64,
                                        215,
                                        432,
                                        233
                                    ],
                                    "type": "text",
                                    "content": "5.2 Monte Carlo Estimation of Action Values"
                                }
                            ]
                        }
                    ],
                    "index": 1,
                    "level": 1
                },
                {
                    "bbox": [
                        64,
                        244,
                        489,
                        351
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                64,
                                244,
                                489,
                                351
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        64,
                                        244,
                                        489,
                                        351
                                    ],
                                    "type": "text",
                                    "content": "If a model is not available, then it is particularly useful to estimate action values (the values of state- action pairs) rather than state values. With a model, state values alone are sufficient to determine a policy; one simply looks ahead one step and chooses whichever action leads to the best combination of reward and next state, as we did in the chapter on DP. Without a model, however, state values alone are not sufficient. One must explicitly estimate the value of each action in order for the values to be useful in suggesting a policy. Thus, one of our primary goals for Monte Carlo methods is to estimate "
                                },
                                {
                                    "bbox": [
                                        64,
                                        244,
                                        489,
                                        351
                                    ],
                                    "type": "inline_equation",
                                    "content": "q_{*}"
                                },
                                {
                                    "bbox": [
                                        64,
                                        244,
                                        489,
                                        351
                                    ],
                                    "type": "text",
                                    "content": ". To achieve this, we first consider the policy evaluation problem for action values."
                                }
                            ]
                        }
                    ],
                    "index": 2
                },
                {
                    "bbox": [
                        64,
                        352,
                        490,
                        497
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                64,
                                352,
                                490,
                                497
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        64,
                                        352,
                                        490,
                                        497
                                    ],
                                    "type": "text",
                                    "content": "The policy evaluation problem for action values is to estimate "
                                },
                                {
                                    "bbox": [
                                        64,
                                        352,
                                        490,
                                        497
                                    ],
                                    "type": "inline_equation",
                                    "content": "q_{\\pi}(s,a)"
                                },
                                {
                                    "bbox": [
                                        64,
                                        352,
                                        490,
                                        497
                                    ],
                                    "type": "text",
                                    "content": ", the expected return when starting in state "
                                },
                                {
                                    "bbox": [
                                        64,
                                        352,
                                        490,
                                        497
                                    ],
                                    "type": "inline_equation",
                                    "content": "s"
                                },
                                {
                                    "bbox": [
                                        64,
                                        352,
                                        490,
                                        497
                                    ],
                                    "type": "text",
                                    "content": ", taking action "
                                },
                                {
                                    "bbox": [
                                        64,
                                        352,
                                        490,
                                        497
                                    ],
                                    "type": "inline_equation",
                                    "content": "a"
                                },
                                {
                                    "bbox": [
                                        64,
                                        352,
                                        490,
                                        497
                                    ],
                                    "type": "text",
                                    "content": ", and thereafter following policy "
                                },
                                {
                                    "bbox": [
                                        64,
                                        352,
                                        490,
                                        497
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\pi"
                                },
                                {
                                    "bbox": [
                                        64,
                                        352,
                                        490,
                                        497
                                    ],
                                    "type": "text",
                                    "content": ". The Monte Carlo methods for this are essentially the same as just presented for state values, except now we talk about visits to a state- action pair rather than to a state. A state- action pair "
                                },
                                {
                                    "bbox": [
                                        64,
                                        352,
                                        490,
                                        497
                                    ],
                                    "type": "inline_equation",
                                    "content": "s,a"
                                },
                                {
                                    "bbox": [
                                        64,
                                        352,
                                        490,
                                        497
                                    ],
                                    "type": "text",
                                    "content": " is said to be visited in an episode if ever the state "
                                },
                                {
                                    "bbox": [
                                        64,
                                        352,
                                        490,
                                        497
                                    ],
                                    "type": "inline_equation",
                                    "content": "s"
                                },
                                {
                                    "bbox": [
                                        64,
                                        352,
                                        490,
                                        497
                                    ],
                                    "type": "text",
                                    "content": " is visited and action "
                                },
                                {
                                    "bbox": [
                                        64,
                                        352,
                                        490,
                                        497
                                    ],
                                    "type": "inline_equation",
                                    "content": "a"
                                },
                                {
                                    "bbox": [
                                        64,
                                        352,
                                        490,
                                        497
                                    ],
                                    "type": "text",
                                    "content": " is taken in it. The every- visit MC method estimates the value of a state- action pair as the average of the returns that have followed all the visits to it. The first- visit MC method averages the returns following the first time in each episode that the state was visited and the action was selected. These methods converge quadratically, as before, to the true expected values as the number of visits to each state- action pair approaches infinity."
                                }
                            ]
                        }
                    ],
                    "index": 3
                },
                {
                    "bbox": [
                        64,
                        499,
                        489,
                        591
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                64,
                                499,
                                489,
                                591
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        64,
                                        499,
                                        489,
                                        591
                                    ],
                                    "type": "text",
                                    "content": "The only complication is that many state- action pairs may never be visited. If "
                                },
                                {
                                    "bbox": [
                                        64,
                                        499,
                                        489,
                                        591
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\pi"
                                },
                                {
                                    "bbox": [
                                        64,
                                        499,
                                        489,
                                        591
                                    ],
                                    "type": "text",
                                    "content": " is a deterministic policy, then in following "
                                },
                                {
                                    "bbox": [
                                        64,
                                        499,
                                        489,
                                        591
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\pi"
                                },
                                {
                                    "bbox": [
                                        64,
                                        499,
                                        489,
                                        591
                                    ],
                                    "type": "text",
                                    "content": " one will observe returns only for one of the actions from each state. With no returns to average, the Monte Carlo estimates of the other actions will not improve with experience. This is a serious problem because the purpose of learning action values is to help in choosing among the actions available in each state. To compare alternatives we need to estimate the value of all the actions from each state, not just the one we currently favor."
                                }
                            ]
                        }
                    ],
                    "index": 4
                },
                {
                    "bbox": [
                        64,
                        593,
                        489,
                        686
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                64,
                                593,
                                489,
                                686
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        64,
                                        593,
                                        489,
                                        686
                                    ],
                                    "type": "text",
                                    "content": "This is the general problem of maintaining exploration, as discussed in the context of the "
                                },
                                {
                                    "bbox": [
                                        64,
                                        593,
                                        489,
                                        686
                                    ],
                                    "type": "inline_equation",
                                    "content": "k"
                                },
                                {
                                    "bbox": [
                                        64,
                                        593,
                                        489,
                                        686
                                    ],
                                    "type": "text",
                                    "content": "- armed bandit problem in Chapter 2. For policy evaluation to work for action values, we must assure continual exploration. One way to do this is by specifying that the episodes start in a state- action pair, and that every pair has a nonzero probability of being selected as the start. This guarantees that all state- action pairs will be visited an infinite number of times in the limit of an infinite number of episodes. We call this the assumption of exploring starts."
                                }
                            ]
                        }
                    ],
                    "index": 5
                },
                {
                    "bbox": [
                        64,
                        687,
                        489,
                        740
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                64,
                                687,
                                489,
                                740
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        64,
                                        687,
                                        489,
                                        740
                                    ],
                                    "type": "text",
                                    "content": "The assumption of exploring starts is sometimes useful, but of course it cannot be relied upon in general, particularly when learning directly from actual interaction with an environment. In that case the starting conditions are unlikely to be so helpful. The most common alternative approach to assuring that all state- action pairs are encountered is"
                                }
                            ]
                        }
                    ],
                    "index": 6
                }
            ],
            "discarded_blocks": [],
            "page_size": [
                595,
                842
            ],
            "page_idx": 5
        },
        {
            "para_blocks": [
                {
                    "bbox": [
                        104,
                        140,
                        530,
                        193
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                104,
                                140,
                                530,
                                193
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        104,
                                        140,
                                        530,
                                        193
                                    ],
                                    "type": "text",
                                    "content": "to consider only policies that are stochastic with a nonzero probability of selecting all actions in each state. We discuss two important variants of this approach in later sections. For now, we retain the assumption of exploring starts and complete the presentation of a full Monte Carlo control method."
                                }
                            ]
                        }
                    ],
                    "index": 0
                },
                {
                    "bbox": [
                        104,
                        197,
                        477,
                        212
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                104,
                                197,
                                477,
                                212
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        104,
                                        197,
                                        477,
                                        212
                                    ],
                                    "type": "text",
                                    "content": "Exercise 5.3 What is the backup diagram for Monte Carlo estimation of "
                                },
                                {
                                    "bbox": [
                                        104,
                                        197,
                                        477,
                                        212
                                    ],
                                    "type": "inline_equation",
                                    "content": "q_{\\pi}"
                                },
                                {
                                    "bbox": [
                                        104,
                                        197,
                                        477,
                                        212
                                    ],
                                    "type": "text",
                                    "content": "?"
                                }
                            ]
                        }
                    ],
                    "index": 1
                },
                {
                    "bbox": [
                        104,
                        232,
                        311,
                        250
                    ],
                    "type": "title",
                    "lines": [
                        {
                            "bbox": [
                                104,
                                232,
                                311,
                                250
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        104,
                                        232,
                                        311,
                                        250
                                    ],
                                    "type": "text",
                                    "content": "5.3 Monte Carlo Control"
                                }
                            ]
                        }
                    ],
                    "index": 2,
                    "level": 1
                },
                {
                    "bbox": [
                        104,
                        261,
                        529,
                        302
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                104,
                                261,
                                529,
                                302
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        104,
                                        261,
                                        529,
                                        302
                                    ],
                                    "type": "text",
                                    "content": "We are now ready to consider how Monte Carlo estimation can be used in control, that is, to approximate optimal policies. The overall idea is to proceed according to the same pattern as in the DP chapter, that is, according to the idea of generalized policy iteration"
                                }
                            ]
                        }
                    ],
                    "index": 3
                },
                {
                    "bbox": [
                        104,
                        302,
                        417,
                        421
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                104,
                                302,
                                417,
                                421
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        104,
                                        302,
                                        417,
                                        421
                                    ],
                                    "type": "text",
                                    "content": "(GPI). In GPI one maintains both an approximate policy and an approximate value function. The value function is repeatedly altered to more closely approximate the value function for the current policy, and the policy is repeatedly improved with respect to the current value function, as suggested by the diagram to the right. These two kinds of changes work against each other to some extent, as each creates a moving target for the other, but together they cause both policy and value function to approach optimality."
                                }
                            ]
                        }
                    ],
                    "index": 4
                },
                {
                    "type": "image",
                    "bbox": [
                        428,
                        305,
                        528,
                        407
                    ],
                    "blocks": [
                        {
                            "bbox": [
                                428,
                                305,
                                528,
                                407
                            ],
                            "lines": [
                                {
                                    "bbox": [
                                        428,
                                        305,
                                        528,
                                        407
                                    ],
                                    "spans": [
                                        {
                                            "bbox": [
                                                428,
                                                305,
                                                528,
                                                407
                                            ],
                                            "type": "image",
                                            "image_path": "92ca42966b0d81c00898918f92a16539b2adc02c37a9c6fa185f1a77e53c3977.jpg"
                                        }
                                    ]
                                }
                            ],
                            "index": 5,
                            "type": "image_body"
                        }
                    ],
                    "index": 5
                },
                {
                    "bbox": [
                        104,
                        421,
                        529,
                        475
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                104,
                                421,
                                529,
                                475
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        104,
                                        421,
                                        529,
                                        475
                                    ],
                                    "type": "text",
                                    "content": "To begin, let us consider a Monte Carlo version of classical policy iteration. In this method, we perform alternating complete steps of policy evaluation and policy improvement, beginning with an arbitrary policy "
                                },
                                {
                                    "bbox": [
                                        104,
                                        421,
                                        529,
                                        475
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\pi_{0}"
                                },
                                {
                                    "bbox": [
                                        104,
                                        421,
                                        529,
                                        475
                                    ],
                                    "type": "text",
                                    "content": " and ending with the optimal policy and optimal action- value function:"
                                }
                            ]
                        }
                    ],
                    "index": 6
                },
                {
                    "bbox": [
                        132,
                        487,
                        399,
                        502
                    ],
                    "type": "interline_equation",
                    "lines": [
                        {
                            "bbox": [
                                132,
                                487,
                                399,
                                502
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        132,
                                        487,
                                        399,
                                        502
                                    ],
                                    "type": "interline_equation",
                                    "content": "\\pi_{0}\\xrightarrow{\\mathrm{~E~}}q_{\\pi_{0}}\\xrightarrow{\\mathrm{~I~}}\\pi_{1}\\xrightarrow{\\mathrm{~E~}}q_{\\pi_{1}}\\xrightarrow{\\mathrm{~I~}}\\pi_{2}\\xrightarrow{\\mathrm{~E~}}\\cdots\\xrightarrow{\\mathrm{~I~}}\\pi_{*}\\xrightarrow{\\mathrm{~E~}}q_{*},",
                                    "image_path": "eb01f77e525c5176cdc0ffa4e5f53dcbd89385052979a57f13b31478f34e501e.jpg"
                                }
                            ]
                        }
                    ],
                    "index": 7
                },
                {
                    "bbox": [
                        104,
                        512,
                        530,
                        607
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                104,
                                512,
                                530,
                                607
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        104,
                                        512,
                                        530,
                                        607
                                    ],
                                    "type": "text",
                                    "content": "where "
                                },
                                {
                                    "bbox": [
                                        104,
                                        512,
                                        530,
                                        607
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\xrightarrow{\\mathrm{~E~}}"
                                },
                                {
                                    "bbox": [
                                        104,
                                        512,
                                        530,
                                        607
                                    ],
                                    "type": "text",
                                    "content": " denotes a complete policy evaluation and "
                                },
                                {
                                    "bbox": [
                                        104,
                                        512,
                                        530,
                                        607
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\xrightarrow{\\mathrm{~I~}}"
                                },
                                {
                                    "bbox": [
                                        104,
                                        512,
                                        530,
                                        607
                                    ],
                                    "type": "text",
                                    "content": " denotes a complete policy improvement. Policy evaluation is done exactly as described in the preceding section. Many episodes are experienced, with the approximate action- value function approaching the true function asymptotically. For the moment, let us assume that we do indeed observe an infinite number of episodes and that, in addition, the episodes are generated with exploring starts. Under these assumptions, the Monte Carlo methods will compute each "
                                },
                                {
                                    "bbox": [
                                        104,
                                        512,
                                        530,
                                        607
                                    ],
                                    "type": "inline_equation",
                                    "content": "q_{\\pi_{k}}"
                                },
                                {
                                    "bbox": [
                                        104,
                                        512,
                                        530,
                                        607
                                    ],
                                    "type": "text",
                                    "content": " exactly, for arbitrary "
                                },
                                {
                                    "bbox": [
                                        104,
                                        512,
                                        530,
                                        607
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\pi_{k}"
                                },
                                {
                                    "bbox": [
                                        104,
                                        512,
                                        530,
                                        607
                                    ],
                                    "type": "text",
                                    "content": "."
                                }
                            ]
                        }
                    ],
                    "index": 8
                },
                {
                    "bbox": [
                        104,
                        608,
                        529,
                        674
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                104,
                                608,
                                529,
                                674
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        104,
                                        608,
                                        529,
                                        674
                                    ],
                                    "type": "text",
                                    "content": "Policy improvement is done by making the policy greedy with respect to the current value function. In this case we have an action- value function, and therefore no model is needed to construct the greedy policy. For any action- value function "
                                },
                                {
                                    "bbox": [
                                        104,
                                        608,
                                        529,
                                        674
                                    ],
                                    "type": "inline_equation",
                                    "content": "q"
                                },
                                {
                                    "bbox": [
                                        104,
                                        608,
                                        529,
                                        674
                                    ],
                                    "type": "text",
                                    "content": ", the corresponding greedy policy is the one that, for each "
                                },
                                {
                                    "bbox": [
                                        104,
                                        608,
                                        529,
                                        674
                                    ],
                                    "type": "inline_equation",
                                    "content": "s \\in \\mathbb{S}"
                                },
                                {
                                    "bbox": [
                                        104,
                                        608,
                                        529,
                                        674
                                    ],
                                    "type": "text",
                                    "content": ", deterministically chooses an action with maximal action- value:"
                                }
                            ]
                        }
                    ],
                    "index": 9
                },
                {
                    "bbox": [
                        131,
                        685,
                        528,
                        703
                    ],
                    "type": "interline_equation",
                    "lines": [
                        {
                            "bbox": [
                                131,
                                685,
                                528,
                                703
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        131,
                                        685,
                                        528,
                                        703
                                    ],
                                    "type": "interline_equation",
                                    "content": "\\pi (s) \\doteq \\arg \\max_{q} q(s, a). \\tag{5.1}",
                                    "image_path": "f08e1c6a807f7f772e1e8cec8bb6ec40dc9de2a5afad63d16032248f6e00523d.jpg"
                                }
                            ]
                        }
                    ],
                    "index": 10
                },
                {
                    "bbox": [
                        102,
                        713,
                        528,
                        740
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                102,
                                713,
                                528,
                                740
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        102,
                                        713,
                                        528,
                                        740
                                    ],
                                    "type": "text",
                                    "content": "Policy improvement then can be done by constructing each "
                                },
                                {
                                    "bbox": [
                                        102,
                                        713,
                                        528,
                                        740
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\pi_{k + 1}"
                                },
                                {
                                    "bbox": [
                                        102,
                                        713,
                                        528,
                                        740
                                    ],
                                    "type": "text",
                                    "content": " as the greedy policy with respect to "
                                },
                                {
                                    "bbox": [
                                        102,
                                        713,
                                        528,
                                        740
                                    ],
                                    "type": "inline_equation",
                                    "content": "q_{\\pi_{k}}"
                                },
                                {
                                    "bbox": [
                                        102,
                                        713,
                                        528,
                                        740
                                    ],
                                    "type": "text",
                                    "content": ". The policy improvement theorem (Section 4.2) then applies to "
                                },
                                {
                                    "bbox": [
                                        102,
                                        713,
                                        528,
                                        740
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\pi_{k}"
                                }
                            ]
                        }
                    ],
                    "index": 11
                }
            ],
            "discarded_blocks": [],
            "page_size": [
                595,
                842
            ],
            "page_idx": 6
        },
        {
            "para_blocks": [
                {
                    "bbox": [
                        63,
                        141,
                        218,
                        154
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                63,
                                141,
                                218,
                                154
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        63,
                                        141,
                                        218,
                                        154
                                    ],
                                    "type": "text",
                                    "content": "and "
                                },
                                {
                                    "bbox": [
                                        63,
                                        141,
                                        218,
                                        154
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\pi_{k + 1}"
                                },
                                {
                                    "bbox": [
                                        63,
                                        141,
                                        218,
                                        154
                                    ],
                                    "type": "text",
                                    "content": " because, for all "
                                },
                                {
                                    "bbox": [
                                        63,
                                        141,
                                        218,
                                        154
                                    ],
                                    "type": "inline_equation",
                                    "content": "s \\in \\mathbb{S}"
                                },
                                {
                                    "bbox": [
                                        63,
                                        141,
                                        218,
                                        154
                                    ],
                                    "type": "text",
                                    "content": ","
                                }
                            ]
                        }
                    ],
                    "index": 0
                },
                {
                    "bbox": [
                        91,
                        164,
                        308,
                        240
                    ],
                    "type": "interline_equation",
                    "lines": [
                        {
                            "bbox": [
                                91,
                                164,
                                308,
                                240
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        91,
                                        164,
                                        308,
                                        240
                                    ],
                                    "type": "interline_equation",
                                    "content": "\\begin{array}{l c l}{{q_{\\pi_{k}}(s,\\pi_{k+1}(s))}}&{{=}}&{{q_{\\pi_{k}}(s,\\arg\\max _{a}q_{\\pi_{k}}(s,a))}}\\\\ {{}}&{{=}}&{{\\max _{a}q_{\\pi_{k}}(s,a)}}\\\\ {{}}&{{\\geq}}&{{q_{\\pi_{k}}(s,\\pi_{k}(s))}}\\\\ {{}}&{{\\geq}}&{{v_{\\pi_{k}}(s).}}\\end{array}",
                                    "image_path": "6c65b730f88143a5c472550b95ce7051e69f81cc9a1e12818e0711f0c3e8503e.jpg"
                                }
                            ]
                        }
                    ],
                    "index": 1
                },
                {
                    "bbox": [
                        64,
                        246,
                        490,
                        314
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                64,
                                246,
                                490,
                                314
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        64,
                                        246,
                                        490,
                                        314
                                    ],
                                    "type": "text",
                                    "content": "As we discussed in the previous chapter, the theorem assures us that each "
                                },
                                {
                                    "bbox": [
                                        64,
                                        246,
                                        490,
                                        314
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\pi_{k + 1}"
                                },
                                {
                                    "bbox": [
                                        64,
                                        246,
                                        490,
                                        314
                                    ],
                                    "type": "text",
                                    "content": " is uniformly better than "
                                },
                                {
                                    "bbox": [
                                        64,
                                        246,
                                        490,
                                        314
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\pi_{k}"
                                },
                                {
                                    "bbox": [
                                        64,
                                        246,
                                        490,
                                        314
                                    ],
                                    "type": "text",
                                    "content": ", or just as good as "
                                },
                                {
                                    "bbox": [
                                        64,
                                        246,
                                        490,
                                        314
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\pi_{k}"
                                },
                                {
                                    "bbox": [
                                        64,
                                        246,
                                        490,
                                        314
                                    ],
                                    "type": "text",
                                    "content": ", in which case they are both optimal policies. This in turn assures us that the overall process converges to the optimal policy and optimal value function. In this way Monte Carlo methods can be used to find optimal policies given only sample episodes and no other knowledge of the environment's dynamics."
                                }
                            ]
                        }
                    ],
                    "index": 2
                },
                {
                    "bbox": [
                        64,
                        314,
                        490,
                        380
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                64,
                                314,
                                490,
                                380
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        64,
                                        314,
                                        490,
                                        380
                                    ],
                                    "type": "text",
                                    "content": "We made two unlikely assumptions above in order to easily obtain this guarantee of convergence for the Monte Carlo method. One was that the episodes have exploring starts, and the other was that policy evaluation could be done with an infinite number of episodes. To obtain a practical algorithm we will have to remove both assumptions. We postpone consideration of the first assumption until later in this chapter."
                                }
                            ]
                        }
                    ],
                    "index": 3
                },
                {
                    "bbox": [
                        64,
                        382,
                        490,
                        527
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                64,
                                382,
                                490,
                                527
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        64,
                                        382,
                                        490,
                                        527
                                    ],
                                    "type": "text",
                                    "content": "For now we focus on the assumption that policy evaluation operates on an infinite number of episodes. This assumption is relatively easy to remove. In fact, the same issue arises even in classical DP methods such as iterative policy evaluation, which also converge only asymptotically to the true value function. In both DP and Monte Carlo cases there are two ways to solve the problem. One is to hold firm to the idea of approximating "
                                },
                                {
                                    "bbox": [
                                        64,
                                        382,
                                        490,
                                        527
                                    ],
                                    "type": "inline_equation",
                                    "content": "q_{\\pi_{k}}"
                                },
                                {
                                    "bbox": [
                                        64,
                                        382,
                                        490,
                                        527
                                    ],
                                    "type": "text",
                                    "content": " in each policy evaluation. Measurements and assumptions are made to obtain bounds on the magnitude and probability of error in the estimates, and then sufficient steps are taken during each policy evaluation to assure that these bounds are sufficiently small. This approach can probably be made completely satisfactory in the sense of guaranteeing correct convergence up to some level of approximation. However, it is also likely to require far too many episodes to be useful in practice on any but the smallest problems."
                                }
                            ]
                        }
                    ],
                    "index": 4
                },
                {
                    "bbox": [
                        64,
                        529,
                        490,
                        649
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                64,
                                529,
                                490,
                                649
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        64,
                                        529,
                                        490,
                                        649
                                    ],
                                    "type": "text",
                                    "content": "There is a second approach to avoiding the infinite number of episodes nominally required for policy evaluation, in which we give up trying to complete policy evaluation before returning to policy improvement. On each evaluation step we move the value function toward "
                                },
                                {
                                    "bbox": [
                                        64,
                                        529,
                                        490,
                                        649
                                    ],
                                    "type": "inline_equation",
                                    "content": "q_{\\pi_{k}}"
                                },
                                {
                                    "bbox": [
                                        64,
                                        529,
                                        490,
                                        649
                                    ],
                                    "type": "text",
                                    "content": ", but we do not expect to actually get close except over many steps. We used this idea when we first introduced the idea of GPI in Section 4.6. One extreme form of the idea is value iteration, in which only one iteration of iterative policy evaluation is performed between each step of policy improvement. The in- place version of value iteration is even more extreme; there we alternate between improvement and evaluation steps for single states."
                                }
                            ]
                        }
                    ],
                    "index": 5
                },
                {
                    "bbox": [
                        64,
                        650,
                        489,
                        730
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                64,
                                650,
                                489,
                                730
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        64,
                                        650,
                                        489,
                                        730
                                    ],
                                    "type": "text",
                                    "content": "For Monte Carlo policy iteration it is natural to alternate between evaluation and improvement on an episode- by- episode basis. After each episode, the observed returns are used for policy evaluation, and then the policy is improved at all the states visited in the episode. A complete simple algorithm along these lines, which we call Monte Carlo ES, for Monte Carlo with Exploring Starts, is given in pseudocode in the box on the next page."
                                }
                            ]
                        }
                    ],
                    "index": 6
                }
            ],
            "discarded_blocks": [],
            "page_size": [
                595,
                842
            ],
            "page_idx": 7
        },
        {
            "para_blocks": [
                {
                    "bbox": [
                        117,
                        140,
                        438,
                        154
                    ],
                    "type": "title",
                    "lines": [
                        {
                            "bbox": [
                                117,
                                140,
                                438,
                                154
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        117,
                                        140,
                                        438,
                                        154
                                    ],
                                    "type": "text",
                                    "content": "Monte Carlo ES (Exploring Starts), for estimating "
                                },
                                {
                                    "bbox": [
                                        117,
                                        140,
                                        438,
                                        154
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\pi \\approx \\pi_{*}"
                                }
                            ]
                        }
                    ],
                    "index": 0,
                    "level": 1
                },
                {
                    "bbox": [
                        118,
                        165,
                        164,
                        175
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                118,
                                165,
                                164,
                                175
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        118,
                                        165,
                                        164,
                                        175
                                    ],
                                    "type": "text",
                                    "content": "Initialize:"
                                }
                            ]
                        }
                    ],
                    "index": 1
                },
                {
                    "bbox": [
                        136,
                        178,
                        320,
                        190
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                136,
                                178,
                                320,
                                190
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        136,
                                        178,
                                        320,
                                        190
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\pi (s) \\in \\mathcal{A}(s)"
                                },
                                {
                                    "bbox": [
                                        136,
                                        178,
                                        320,
                                        190
                                    ],
                                    "type": "text",
                                    "content": " (arbitrarily), for all "
                                },
                                {
                                    "bbox": [
                                        136,
                                        178,
                                        320,
                                        190
                                    ],
                                    "type": "inline_equation",
                                    "content": "s \\in \\mathcal{S}"
                                }
                            ]
                        }
                    ],
                    "index": 2
                },
                {
                    "bbox": [
                        136,
                        191,
                        374,
                        202
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                136,
                                191,
                                374,
                                202
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        136,
                                        191,
                                        374,
                                        202
                                    ],
                                    "type": "inline_equation",
                                    "content": "Q(s, a) \\in \\mathbb{R}"
                                },
                                {
                                    "bbox": [
                                        136,
                                        191,
                                        374,
                                        202
                                    ],
                                    "type": "text",
                                    "content": " (arbitrarily), for all "
                                },
                                {
                                    "bbox": [
                                        136,
                                        191,
                                        374,
                                        202
                                    ],
                                    "type": "inline_equation",
                                    "content": "s \\in \\mathcal{S}"
                                },
                                {
                                    "bbox": [
                                        136,
                                        191,
                                        374,
                                        202
                                    ],
                                    "type": "text",
                                    "content": ", "
                                },
                                {
                                    "bbox": [
                                        136,
                                        191,
                                        374,
                                        202
                                    ],
                                    "type": "inline_equation",
                                    "content": "a \\in \\mathcal{A}(s)"
                                }
                            ]
                        }
                    ],
                    "index": 3
                },
                {
                    "bbox": [
                        136,
                        204,
                        381,
                        217
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                136,
                                204,
                                381,
                                217
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        136,
                                        204,
                                        381,
                                        217
                                    ],
                                    "type": "inline_equation",
                                    "content": "Returns(s, a) \\leftarrow"
                                },
                                {
                                    "bbox": [
                                        136,
                                        204,
                                        381,
                                        217
                                    ],
                                    "type": "text",
                                    "content": " empty list, for all "
                                },
                                {
                                    "bbox": [
                                        136,
                                        204,
                                        381,
                                        217
                                    ],
                                    "type": "inline_equation",
                                    "content": "s \\in \\mathcal{S}"
                                },
                                {
                                    "bbox": [
                                        136,
                                        204,
                                        381,
                                        217
                                    ],
                                    "type": "text",
                                    "content": ", "
                                },
                                {
                                    "bbox": [
                                        136,
                                        204,
                                        381,
                                        217
                                    ],
                                    "type": "inline_equation",
                                    "content": "a \\in \\mathcal{A}(s)"
                                }
                            ]
                        }
                    ],
                    "index": 4
                },
                {
                    "bbox": [
                        117,
                        224,
                        273,
                        236
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                117,
                                224,
                                273,
                                236
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        117,
                                        224,
                                        273,
                                        236
                                    ],
                                    "type": "text",
                                    "content": "Loop forever (for each episode):"
                                }
                            ]
                        }
                    ],
                    "index": 5
                },
                {
                    "bbox": [
                        136,
                        237,
                        514,
                        263
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                136,
                                237,
                                514,
                                263
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        136,
                                        237,
                                        514,
                                        263
                                    ],
                                    "type": "text",
                                    "content": "Choose "
                                },
                                {
                                    "bbox": [
                                        136,
                                        237,
                                        514,
                                        263
                                    ],
                                    "type": "inline_equation",
                                    "content": "S_{0} \\in \\mathcal{S}"
                                },
                                {
                                    "bbox": [
                                        136,
                                        237,
                                        514,
                                        263
                                    ],
                                    "type": "text",
                                    "content": ", "
                                },
                                {
                                    "bbox": [
                                        136,
                                        237,
                                        514,
                                        263
                                    ],
                                    "type": "inline_equation",
                                    "content": "A_{0} \\in \\mathcal{A}(S_{0})"
                                },
                                {
                                    "bbox": [
                                        136,
                                        237,
                                        514,
                                        263
                                    ],
                                    "type": "text",
                                    "content": " randomly such that all pairs have probability "
                                },
                                {
                                    "bbox": [
                                        136,
                                        237,
                                        514,
                                        263
                                    ],
                                    "type": "inline_equation",
                                    "content": "> 0"
                                },
                                {
                                    "bbox": [
                                        136,
                                        237,
                                        514,
                                        263
                                    ],
                                    "type": "text",
                                    "content": " Generate an episode from "
                                },
                                {
                                    "bbox": [
                                        136,
                                        237,
                                        514,
                                        263
                                    ],
                                    "type": "inline_equation",
                                    "content": "S_{0}"
                                },
                                {
                                    "bbox": [
                                        136,
                                        237,
                                        514,
                                        263
                                    ],
                                    "type": "text",
                                    "content": ", "
                                },
                                {
                                    "bbox": [
                                        136,
                                        237,
                                        514,
                                        263
                                    ],
                                    "type": "inline_equation",
                                    "content": "A_{0}"
                                },
                                {
                                    "bbox": [
                                        136,
                                        237,
                                        514,
                                        263
                                    ],
                                    "type": "text",
                                    "content": ", following "
                                },
                                {
                                    "bbox": [
                                        136,
                                        237,
                                        514,
                                        263
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\pi \\colon S_{0}, A_{0}, R_{1}, \\ldots , S_{T - 1}, A_{T - 1}, R_{T}"
                                }
                            ]
                        }
                    ],
                    "index": 6
                },
                {
                    "bbox": [
                        136,
                        264,
                        170,
                        275
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                136,
                                264,
                                170,
                                275
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        136,
                                        264,
                                        170,
                                        275
                                    ],
                                    "type": "inline_equation",
                                    "content": "G \\leftarrow 0"
                                }
                            ]
                        }
                    ],
                    "index": 7
                },
                {
                    "bbox": [
                        136,
                        277,
                        389,
                        289
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                136,
                                277,
                                389,
                                289
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        136,
                                        277,
                                        389,
                                        289
                                    ],
                                    "type": "text",
                                    "content": "Loop for each step of episode, "
                                },
                                {
                                    "bbox": [
                                        136,
                                        277,
                                        389,
                                        289
                                    ],
                                    "type": "inline_equation",
                                    "content": "t = T - 1, T - 2, \\ldots , 0"
                                },
                                {
                                    "bbox": [
                                        136,
                                        277,
                                        389,
                                        289
                                    ],
                                    "type": "text",
                                    "content": ":"
                                }
                            ]
                        }
                    ],
                    "index": 8
                },
                {
                    "bbox": [
                        155,
                        291,
                        235,
                        303
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                155,
                                291,
                                235,
                                303
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        155,
                                        291,
                                        235,
                                        303
                                    ],
                                    "type": "inline_equation",
                                    "content": "G \\leftarrow \\gamma G + R_{t + 1}"
                                }
                            ]
                        }
                    ],
                    "index": 9
                },
                {
                    "bbox": [
                        155,
                        304,
                        458,
                        317
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                155,
                                304,
                                458,
                                317
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        155,
                                        304,
                                        458,
                                        317
                                    ],
                                    "type": "text",
                                    "content": "Unless the pair "
                                },
                                {
                                    "bbox": [
                                        155,
                                        304,
                                        458,
                                        317
                                    ],
                                    "type": "inline_equation",
                                    "content": "S_{t}, A_{t}"
                                },
                                {
                                    "bbox": [
                                        155,
                                        304,
                                        458,
                                        317
                                    ],
                                    "type": "text",
                                    "content": " appears in "
                                },
                                {
                                    "bbox": [
                                        155,
                                        304,
                                        458,
                                        317
                                    ],
                                    "type": "inline_equation",
                                    "content": "S_{0}, A_{0}, S_{1}, A_{1}, \\ldots , S_{t - 1}, A_{t - 1}"
                                },
                                {
                                    "bbox": [
                                        155,
                                        304,
                                        458,
                                        317
                                    ],
                                    "type": "text",
                                    "content": ":"
                                }
                            ]
                        }
                    ],
                    "index": 10
                },
                {
                    "bbox": [
                        174,
                        317,
                        319,
                        330
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                174,
                                317,
                                319,
                                330
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        174,
                                        317,
                                        319,
                                        330
                                    ],
                                    "type": "text",
                                    "content": "Append "
                                },
                                {
                                    "bbox": [
                                        174,
                                        317,
                                        319,
                                        330
                                    ],
                                    "type": "inline_equation",
                                    "content": "G"
                                },
                                {
                                    "bbox": [
                                        174,
                                        317,
                                        319,
                                        330
                                    ],
                                    "type": "text",
                                    "content": " to "
                                },
                                {
                                    "bbox": [
                                        174,
                                        317,
                                        319,
                                        330
                                    ],
                                    "type": "inline_equation",
                                    "content": "Returns(S_{t}, A_{t})"
                                }
                            ]
                        }
                    ],
                    "index": 11
                },
                {
                    "bbox": [
                        173,
                        330,
                        359,
                        343
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                173,
                                330,
                                359,
                                343
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        173,
                                        330,
                                        359,
                                        343
                                    ],
                                    "type": "text",
                                    "content": "\\(Q(S_{t}, A_{t}) \\leftarrow\\) average(Returns(S_{t}, A_{t}))\\)"
                                }
                            ]
                        }
                    ],
                    "index": 12
                },
                {
                    "bbox": [
                        173,
                        343,
                        301,
                        357
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                173,
                                343,
                                301,
                                357
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        173,
                                        343,
                                        301,
                                        357
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\pi (S_{t}) \\leftarrow \\arg \\max_{a} Q(S_{t}, a)"
                                }
                            ]
                        }
                    ],
                    "index": 13
                },
                {
                    "bbox": [
                        104,
                        390,
                        530,
                        457
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                104,
                                390,
                                530,
                                457
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        104,
                                        390,
                                        530,
                                        457
                                    ],
                                    "type": "text",
                                    "content": "Exercise 5.4 The pseudocode for Monte Carlo ES is inefficient because, for each state- action pair, it maintains a list of all returns and repeatedly calculates their mean. It would be more efficient to use techniques similar to those explained in Section 2.4 to maintain just the mean and a count (for each state- action pair) and update them incrementally. Describe how the pseudocode would be altered to achieve this."
                                }
                            ]
                        }
                    ],
                    "index": 14
                },
                {
                    "bbox": [
                        104,
                        462,
                        529,
                        581
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                104,
                                462,
                                529,
                                581
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        104,
                                        462,
                                        529,
                                        581
                                    ],
                                    "type": "text",
                                    "content": "In Monte Carlo ES, all the returns for each state- action pair are accumulated and averaged, irrespective of what policy was in force when they were observed. It is easy to see that Monte Carlo ES cannot converge to any suboptimal policy. If it did, then the value function would eventually converge to the value function for that policy, and that in turn would cause the policy to change. Stability is achieved only when both the policy and the value function are optimal. Convergence to this optimal fixed point seems inevitable as the changes to the action- value function decrease over time, but has not yet been formally proved. In our opinion, this is one of the most fundamental open theoretical questions in reinforcement learning (for a partial solution, see Tsitsiklis, 2002)."
                                }
                            ]
                        }
                    ],
                    "index": 15
                },
                {
                    "bbox": [
                        104,
                        588,
                        529,
                        747
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                104,
                                588,
                                529,
                                747
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        104,
                                        588,
                                        529,
                                        747
                                    ],
                                    "type": "text",
                                    "content": "Example 5.3: Solving Blackjack It is straightforward to apply Monte Carlo ES to blackjack. Because the episodes are all simulated games, it is easy to arrange for exploring starts that include all possibilities. In this case one simply picks the dealer's cards, the player's sum, and whether or not the player has a usable ace, all at random with equal probability. As the initial policy we use the policy evaluated in the previous blackjack example, that which sticks only on 20 or 21. The initial action- value function can be zero for all state- action pairs. Figure 5.2 shows the optimal policy for blackjack found by Monte Carlo ES. This policy is the same as the \"basic\" strategy of Thorp (1966) with the sole exception of the leftmost notch in the policy for a usable ace, which is not present in Thorp's strategy. We are uncertain of the reason for this discrepancy, but confident that what is shown here is indeed the optimal policy for the version of blackjack we have described."
                                }
                            ]
                        }
                    ],
                    "index": 16
                }
            ],
            "discarded_blocks": [],
            "page_size": [
                595,
                842
            ],
            "page_idx": 8
        },
        {
            "para_blocks": [
                {
                    "type": "image",
                    "bbox": [
                        120,
                        150,
                        426,
                        367
                    ],
                    "blocks": [
                        {
                            "bbox": [
                                120,
                                150,
                                426,
                                367
                            ],
                            "lines": [
                                {
                                    "bbox": [
                                        120,
                                        150,
                                        426,
                                        367
                                    ],
                                    "spans": [
                                        {
                                            "bbox": [
                                                120,
                                                150,
                                                426,
                                                367
                                            ],
                                            "type": "image",
                                            "image_path": "3022951429ec1afd8953aab27c248974331075f7d56bab1c90a528cd9cd69c2f.jpg"
                                        }
                                    ]
                                }
                            ],
                            "index": 0,
                            "type": "image_body"
                        },
                        {
                            "bbox": [
                                64,
                                379,
                                490,
                                415
                            ],
                            "lines": [
                                {
                                    "bbox": [
                                        64,
                                        379,
                                        490,
                                        415
                                    ],
                                    "spans": [
                                        {
                                            "bbox": [
                                                64,
                                                379,
                                                490,
                                                415
                                            ],
                                            "type": "text",
                                            "content": "Figure 5.2: The optimal policy and state-value function for blackjack, found by Monte Carlo ES. The state-value function shown was computed from the action-value function found by Monte Carlo ES."
                                        }
                                    ]
                                }
                            ],
                            "index": 1,
                            "type": "image_caption"
                        }
                    ],
                    "index": 0
                },
                {
                    "bbox": [
                        64,
                        435,
                        473,
                        452
                    ],
                    "type": "title",
                    "lines": [
                        {
                            "bbox": [
                                64,
                                435,
                                473,
                                452
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        64,
                                        435,
                                        473,
                                        452
                                    ],
                                    "type": "text",
                                    "content": "5.4 Monte Carlo Control without Exploring Starts"
                                }
                            ]
                        }
                    ],
                    "index": 2,
                    "level": 1
                },
                {
                    "bbox": [
                        64,
                        468,
                        489,
                        589
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                64,
                                468,
                                489,
                                589
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        64,
                                        468,
                                        489,
                                        589
                                    ],
                                    "type": "text",
                                    "content": "How can we avoid the unlikely assumption of exploring starts? The only general way to ensure that all actions are selected infinitely often is for the agent to continue to select them. There are two approaches to ensuring this, resulting in what we call on- policy methods and off- policy methods. On- policy methods attempt to evaluate or improve the policy that is used to make decisions, whereas off- policy methods evaluate or improve a policy different from that used to generate the data. The Monte Carlo ES method developed above is an example of an on- policy method. In this section we show how an on- policy Monte Carlo control method can be designed that does not use the unrealistic assumption of exploring starts. Off- policy methods are considered in the next section."
                                }
                            ]
                        }
                    ],
                    "index": 3
                },
                {
                    "bbox": [
                        64,
                        590,
                        490,
                        740
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                64,
                                590,
                                490,
                                740
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        64,
                                        590,
                                        490,
                                        740
                                    ],
                                    "type": "text",
                                    "content": "In on- policy control methods the policy is generally soft, meaning that "
                                },
                                {
                                    "bbox": [
                                        64,
                                        590,
                                        490,
                                        740
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\pi (a|s) > 0"
                                },
                                {
                                    "bbox": [
                                        64,
                                        590,
                                        490,
                                        740
                                    ],
                                    "type": "text",
                                    "content": " for all "
                                },
                                {
                                    "bbox": [
                                        64,
                                        590,
                                        490,
                                        740
                                    ],
                                    "type": "inline_equation",
                                    "content": "s\\in \\mathcal{S}"
                                },
                                {
                                    "bbox": [
                                        64,
                                        590,
                                        490,
                                        740
                                    ],
                                    "type": "text",
                                    "content": " and all "
                                },
                                {
                                    "bbox": [
                                        64,
                                        590,
                                        490,
                                        740
                                    ],
                                    "type": "inline_equation",
                                    "content": "a\\in A(s)"
                                },
                                {
                                    "bbox": [
                                        64,
                                        590,
                                        490,
                                        740
                                    ],
                                    "type": "text",
                                    "content": " , but gradually shifted closer and closer to a deterministic optimal policy. Many of the methods discussed in Chapter 2 provide mechanisms for this. The on- policy method we present in this section uses "
                                },
                                {
                                    "bbox": [
                                        64,
                                        590,
                                        490,
                                        740
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\epsilon"
                                },
                                {
                                    "bbox": [
                                        64,
                                        590,
                                        490,
                                        740
                                    ],
                                    "type": "text",
                                    "content": " - greedy policies, meaning that most of the time they choose an action that has maximal estimated action value, but with probability "
                                },
                                {
                                    "bbox": [
                                        64,
                                        590,
                                        490,
                                        740
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\epsilon"
                                },
                                {
                                    "bbox": [
                                        64,
                                        590,
                                        490,
                                        740
                                    ],
                                    "type": "text",
                                    "content": " they instead select an action at random. That is, all nongreedy actions are given the minimal probability of selection, "
                                },
                                {
                                    "bbox": [
                                        64,
                                        590,
                                        490,
                                        740
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\frac{\\epsilon}{|\\mathcal{A}(s)|}"
                                },
                                {
                                    "bbox": [
                                        64,
                                        590,
                                        490,
                                        740
                                    ],
                                    "type": "text",
                                    "content": " , and the remaining bulk of the probability, "
                                },
                                {
                                    "bbox": [
                                        64,
                                        590,
                                        490,
                                        740
                                    ],
                                    "type": "inline_equation",
                                    "content": "1 - \\epsilon +\\frac{\\epsilon}{|\\mathcal{A}(s)|}"
                                },
                                {
                                    "bbox": [
                                        64,
                                        590,
                                        490,
                                        740
                                    ],
                                    "type": "text",
                                    "content": " , is given to the greedy action. The "
                                },
                                {
                                    "bbox": [
                                        64,
                                        590,
                                        490,
                                        740
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\epsilon"
                                },
                                {
                                    "bbox": [
                                        64,
                                        590,
                                        490,
                                        740
                                    ],
                                    "type": "text",
                                    "content": " greedy policies are examples of "
                                },
                                {
                                    "bbox": [
                                        64,
                                        590,
                                        490,
                                        740
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\epsilon"
                                },
                                {
                                    "bbox": [
                                        64,
                                        590,
                                        490,
                                        740
                                    ],
                                    "type": "text",
                                    "content": " soft policies, defined as policies for which "
                                },
                                {
                                    "bbox": [
                                        64,
                                        590,
                                        490,
                                        740
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\pi (a|s)\\geq \\frac{\\epsilon}{|\\mathcal{A}(s)|}"
                                },
                                {
                                    "bbox": [
                                        64,
                                        590,
                                        490,
                                        740
                                    ],
                                    "type": "text",
                                    "content": " for all states and actions, for some "
                                },
                                {
                                    "bbox": [
                                        64,
                                        590,
                                        490,
                                        740
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\epsilon >0"
                                },
                                {
                                    "bbox": [
                                        64,
                                        590,
                                        490,
                                        740
                                    ],
                                    "type": "text",
                                    "content": " . Among "
                                },
                                {
                                    "bbox": [
                                        64,
                                        590,
                                        490,
                                        740
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\epsilon"
                                },
                                {
                                    "bbox": [
                                        64,
                                        590,
                                        490,
                                        740
                                    ],
                                    "type": "text",
                                    "content": " soft policies, "
                                },
                                {
                                    "bbox": [
                                        64,
                                        590,
                                        490,
                                        740
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\epsilon"
                                },
                                {
                                    "bbox": [
                                        64,
                                        590,
                                        490,
                                        740
                                    ],
                                    "type": "text",
                                    "content": " greedy policies are in some sense those that are closest to greedy."
                                }
                            ]
                        }
                    ],
                    "index": 4
                }
            ],
            "discarded_blocks": [],
            "page_size": [
                595,
                842
            ],
            "page_idx": 9
        },
        {
            "para_blocks": [
                {
                    "bbox": [
                        104,
                        140,
                        530,
                        261
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                104,
                                140,
                                530,
                                261
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        104,
                                        140,
                                        530,
                                        261
                                    ],
                                    "type": "text",
                                    "content": "The overall idea of on- policy Monte Carlo control is still that of GPI. As in Monte Carlo ES, we use first- visit MC methods to estimate the action- value function for the current policy. Without the assumption of exploring starts, however, we cannot simply improve the policy by making it greedy with respect to the current value function, because that would prevent further exploration of nongreedy actions. Fortunately, GPI does not require that the policy be taken all the way to a greedy policy, only that it be moved toward a greedy policy. In our on- policy method we will move it only to an "
                                },
                                {
                                    "bbox": [
                                        104,
                                        140,
                                        530,
                                        261
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\epsilon"
                                },
                                {
                                    "bbox": [
                                        104,
                                        140,
                                        530,
                                        261
                                    ],
                                    "type": "text",
                                    "content": "- greedy policy. For any "
                                },
                                {
                                    "bbox": [
                                        104,
                                        140,
                                        530,
                                        261
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\epsilon"
                                },
                                {
                                    "bbox": [
                                        104,
                                        140,
                                        530,
                                        261
                                    ],
                                    "type": "text",
                                    "content": "- soft policy, "
                                },
                                {
                                    "bbox": [
                                        104,
                                        140,
                                        530,
                                        261
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\pi"
                                },
                                {
                                    "bbox": [
                                        104,
                                        140,
                                        530,
                                        261
                                    ],
                                    "type": "text",
                                    "content": ", any "
                                },
                                {
                                    "bbox": [
                                        104,
                                        140,
                                        530,
                                        261
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\epsilon"
                                },
                                {
                                    "bbox": [
                                        104,
                                        140,
                                        530,
                                        261
                                    ],
                                    "type": "text",
                                    "content": "- greedy policy with respect to "
                                },
                                {
                                    "bbox": [
                                        104,
                                        140,
                                        530,
                                        261
                                    ],
                                    "type": "inline_equation",
                                    "content": "q_{\\pi}"
                                },
                                {
                                    "bbox": [
                                        104,
                                        140,
                                        530,
                                        261
                                    ],
                                    "type": "text",
                                    "content": " is guaranteed to be better than or equal to "
                                },
                                {
                                    "bbox": [
                                        104,
                                        140,
                                        530,
                                        261
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\pi"
                                },
                                {
                                    "bbox": [
                                        104,
                                        140,
                                        530,
                                        261
                                    ],
                                    "type": "text",
                                    "content": ". The complete algorithm is given in the box below."
                                }
                            ]
                        }
                    ],
                    "index": 0
                },
                {
                    "bbox": [
                        117,
                        274,
                        502,
                        289
                    ],
                    "type": "title",
                    "lines": [
                        {
                            "bbox": [
                                117,
                                274,
                                502,
                                289
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        117,
                                        274,
                                        502,
                                        289
                                    ],
                                    "type": "text",
                                    "content": "On-policy first-visit MC control (for "
                                },
                                {
                                    "bbox": [
                                        117,
                                        274,
                                        502,
                                        289
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\epsilon"
                                },
                                {
                                    "bbox": [
                                        117,
                                        274,
                                        502,
                                        289
                                    ],
                                    "type": "text",
                                    "content": "-soft policies), estimates "
                                },
                                {
                                    "bbox": [
                                        117,
                                        274,
                                        502,
                                        289
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\pi \\approx \\pi_{*}"
                                }
                            ]
                        }
                    ],
                    "index": 1,
                    "level": 1
                },
                {
                    "bbox": [
                        118,
                        298,
                        285,
                        312
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                118,
                                298,
                                285,
                                312
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        118,
                                        298,
                                        285,
                                        312
                                    ],
                                    "type": "text",
                                    "content": "Algorithm parameter: small "
                                },
                                {
                                    "bbox": [
                                        118,
                                        298,
                                        285,
                                        312
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\epsilon > 0"
                                }
                            ]
                        }
                    ],
                    "index": 2
                },
                {
                    "bbox": [
                        118,
                        314,
                        165,
                        326
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                118,
                                314,
                                165,
                                326
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        118,
                                        314,
                                        165,
                                        326
                                    ],
                                    "type": "text",
                                    "content": "Initialize:"
                                }
                            ]
                        }
                    ],
                    "index": 3
                },
                {
                    "bbox": [
                        132,
                        328,
                        280,
                        341
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                132,
                                328,
                                280,
                                341
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        132,
                                        328,
                                        280,
                                        341
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\pi \\leftarrow"
                                },
                                {
                                    "bbox": [
                                        132,
                                        328,
                                        280,
                                        341
                                    ],
                                    "type": "text",
                                    "content": " an arbitrary "
                                },
                                {
                                    "bbox": [
                                        132,
                                        328,
                                        280,
                                        341
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\epsilon"
                                },
                                {
                                    "bbox": [
                                        132,
                                        328,
                                        280,
                                        341
                                    ],
                                    "type": "text",
                                    "content": "- soft policy"
                                }
                            ]
                        }
                    ],
                    "index": 4
                },
                {
                    "bbox": [
                        132,
                        341,
                        361,
                        354
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                132,
                                341,
                                361,
                                354
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        132,
                                        341,
                                        361,
                                        354
                                    ],
                                    "type": "inline_equation",
                                    "content": "Q(s, a) \\in \\mathbb{R}"
                                },
                                {
                                    "bbox": [
                                        132,
                                        341,
                                        361,
                                        354
                                    ],
                                    "type": "text",
                                    "content": " (arbitrarily), for all "
                                },
                                {
                                    "bbox": [
                                        132,
                                        341,
                                        361,
                                        354
                                    ],
                                    "type": "inline_equation",
                                    "content": "s \\in \\mathbb{S}"
                                },
                                {
                                    "bbox": [
                                        132,
                                        341,
                                        361,
                                        354
                                    ],
                                    "type": "text",
                                    "content": ", "
                                },
                                {
                                    "bbox": [
                                        132,
                                        341,
                                        361,
                                        354
                                    ],
                                    "type": "inline_equation",
                                    "content": "a \\in \\mathcal{A}(s)"
                                }
                            ]
                        }
                    ],
                    "index": 5
                },
                {
                    "bbox": [
                        132,
                        355,
                        379,
                        367
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                132,
                                355,
                                379,
                                367
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        132,
                                        355,
                                        379,
                                        367
                                    ],
                                    "type": "inline_equation",
                                    "content": "Returns(s, a) \\leftarrow"
                                },
                                {
                                    "bbox": [
                                        132,
                                        355,
                                        379,
                                        367
                                    ],
                                    "type": "text",
                                    "content": " empty list, for all "
                                },
                                {
                                    "bbox": [
                                        132,
                                        355,
                                        379,
                                        367
                                    ],
                                    "type": "inline_equation",
                                    "content": "s \\in \\mathbb{S}"
                                },
                                {
                                    "bbox": [
                                        132,
                                        355,
                                        379,
                                        367
                                    ],
                                    "type": "text",
                                    "content": ", "
                                },
                                {
                                    "bbox": [
                                        132,
                                        355,
                                        379,
                                        367
                                    ],
                                    "type": "inline_equation",
                                    "content": "a \\in \\mathcal{A}(s)"
                                }
                            ]
                        }
                    ],
                    "index": 6
                },
                {
                    "bbox": [
                        118,
                        373,
                        283,
                        386
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                118,
                                373,
                                283,
                                386
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        118,
                                        373,
                                        283,
                                        386
                                    ],
                                    "type": "text",
                                    "content": "Repeat forever (for each episode):"
                                }
                            ]
                        }
                    ],
                    "index": 7
                },
                {
                    "bbox": [
                        132,
                        388,
                        447,
                        400
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                132,
                                388,
                                447,
                                400
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        132,
                                        388,
                                        447,
                                        400
                                    ],
                                    "type": "text",
                                    "content": "Generate an episode following "
                                },
                                {
                                    "bbox": [
                                        132,
                                        388,
                                        447,
                                        400
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\pi"
                                },
                                {
                                    "bbox": [
                                        132,
                                        388,
                                        447,
                                        400
                                    ],
                                    "type": "text",
                                    "content": ": "
                                },
                                {
                                    "bbox": [
                                        132,
                                        388,
                                        447,
                                        400
                                    ],
                                    "type": "inline_equation",
                                    "content": "S_{0}, A_{0}, R_{1}, \\ldots , S_{T - 1}, A_{T - 1}, R_{T}"
                                }
                            ]
                        }
                    ],
                    "index": 8
                },
                {
                    "bbox": [
                        132,
                        401,
                        166,
                        412
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                132,
                                401,
                                166,
                                412
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        132,
                                        401,
                                        166,
                                        412
                                    ],
                                    "type": "inline_equation",
                                    "content": "G \\leftarrow 0"
                                }
                            ]
                        }
                    ],
                    "index": 9
                },
                {
                    "bbox": [
                        132,
                        415,
                        386,
                        427
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                132,
                                415,
                                386,
                                427
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        132,
                                        415,
                                        386,
                                        427
                                    ],
                                    "type": "text",
                                    "content": "Loop for each step of episode, "
                                },
                                {
                                    "bbox": [
                                        132,
                                        415,
                                        386,
                                        427
                                    ],
                                    "type": "inline_equation",
                                    "content": "t = T - 1, T - 2, \\ldots , 0"
                                }
                            ]
                        }
                    ],
                    "index": 10
                },
                {
                    "bbox": [
                        148,
                        428,
                        221,
                        440
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                148,
                                428,
                                221,
                                440
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        148,
                                        428,
                                        221,
                                        440
                                    ],
                                    "type": "inline_equation",
                                    "content": "G \\leftarrow \\gamma G + R_{t + 1}"
                                }
                            ]
                        }
                    ],
                    "index": 11
                },
                {
                    "bbox": [
                        148,
                        441,
                        451,
                        453
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                148,
                                441,
                                451,
                                453
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        148,
                                        441,
                                        451,
                                        453
                                    ],
                                    "type": "text",
                                    "content": "Unless the pair "
                                },
                                {
                                    "bbox": [
                                        148,
                                        441,
                                        451,
                                        453
                                    ],
                                    "type": "inline_equation",
                                    "content": "S_{t}, A_{t}"
                                },
                                {
                                    "bbox": [
                                        148,
                                        441,
                                        451,
                                        453
                                    ],
                                    "type": "text",
                                    "content": " appears in "
                                },
                                {
                                    "bbox": [
                                        148,
                                        441,
                                        451,
                                        453
                                    ],
                                    "type": "inline_equation",
                                    "content": "S_{0}, A_{0}, S_{1}, A_{1} \\ldots , S_{t - 1}, A_{t - 1}"
                                },
                                {
                                    "bbox": [
                                        148,
                                        441,
                                        451,
                                        453
                                    ],
                                    "type": "text",
                                    "content": ":"
                                }
                            ]
                        }
                    ],
                    "index": 12
                },
                {
                    "bbox": [
                        162,
                        454,
                        347,
                        466
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                162,
                                454,
                                347,
                                466
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        162,
                                        454,
                                        347,
                                        466
                                    ],
                                    "type": "text",
                                    "content": "Append "
                                },
                                {
                                    "bbox": [
                                        162,
                                        454,
                                        347,
                                        466
                                    ],
                                    "type": "inline_equation",
                                    "content": "G"
                                },
                                {
                                    "bbox": [
                                        162,
                                        454,
                                        347,
                                        466
                                    ],
                                    "type": "text",
                                    "content": " to "
                                },
                                {
                                    "bbox": [
                                        162,
                                        454,
                                        347,
                                        466
                                    ],
                                    "type": "inline_equation",
                                    "content": "Returns(S_{t}, A_{t})"
                                }
                            ]
                        }
                    ],
                    "index": 13
                },
                {
                    "bbox": [
                        163,
                        467,
                        347,
                        480
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                163,
                                467,
                                347,
                                480
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        163,
                                        467,
                                        347,
                                        480
                                    ],
                                    "type": "inline_equation",
                                    "content": "Q(S_{t}, A_{t}) \\leftarrow"
                                },
                                {
                                    "bbox": [
                                        163,
                                        467,
                                        347,
                                        480
                                    ],
                                    "type": "text",
                                    "content": " average "
                                },
                                {
                                    "bbox": [
                                        163,
                                        467,
                                        347,
                                        480
                                    ],
                                    "type": "inline_equation",
                                    "content": "Returns(S_{t}, A_{t})"
                                }
                            ]
                        }
                    ],
                    "index": 14
                },
                {
                    "bbox": [
                        163,
                        481,
                        522,
                        494
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                163,
                                481,
                                522,
                                494
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        163,
                                        481,
                                        522,
                                        494
                                    ],
                                    "type": "inline_equation",
                                    "content": "A^{*} \\leftarrow \\arg \\max_{a} Q(S_{t}, a)"
                                },
                                {
                                    "bbox": [
                                        163,
                                        481,
                                        522,
                                        494
                                    ],
                                    "type": "text",
                                    "content": " (with ties broken arbitrarily)"
                                }
                            ]
                        }
                    ],
                    "index": 15
                },
                {
                    "bbox": [
                        163,
                        495,
                        251,
                        506
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                163,
                                495,
                                251,
                                506
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        163,
                                        495,
                                        251,
                                        506
                                    ],
                                    "type": "text",
                                    "content": "For all "
                                },
                                {
                                    "bbox": [
                                        163,
                                        495,
                                        251,
                                        506
                                    ],
                                    "type": "inline_equation",
                                    "content": "a \\in \\mathcal{A}(S_{t})"
                                }
                            ]
                        }
                    ],
                    "index": 16
                },
                {
                    "bbox": [
                        191,
                        507,
                        396,
                        536
                    ],
                    "type": "interline_equation",
                    "lines": [
                        {
                            "bbox": [
                                191,
                                507,
                                396,
                                536
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        191,
                                        507,
                                        396,
                                        536
                                    ],
                                    "type": "interline_equation",
                                    "content": "\\pi (a|S_{t}) \\leftarrow \\left\\{ \\begin{array}{ll} 1 - \\epsilon + \\epsilon / |\\mathcal{A}(S_{t})| & \\text{if} a = A^{*} \\\\ \\epsilon / |\\mathcal{A}(S_{t})| & \\text{if} a \\neq A^{*} \\end{array} \\right.",
                                    "image_path": "98cbc80dc3ca277ddf8256001b303428d926cbad040a9b077dcb6a8c34800c5f.jpg"
                                }
                            ]
                        }
                    ],
                    "index": 17
                },
                {
                    "bbox": [
                        104,
                        555,
                        530,
                        596
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                104,
                                555,
                                530,
                                596
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        104,
                                        555,
                                        530,
                                        596
                                    ],
                                    "type": "text",
                                    "content": "That any "
                                },
                                {
                                    "bbox": [
                                        104,
                                        555,
                                        530,
                                        596
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\epsilon"
                                },
                                {
                                    "bbox": [
                                        104,
                                        555,
                                        530,
                                        596
                                    ],
                                    "type": "text",
                                    "content": "- greedy policy with respect to "
                                },
                                {
                                    "bbox": [
                                        104,
                                        555,
                                        530,
                                        596
                                    ],
                                    "type": "inline_equation",
                                    "content": "q_{\\pi}"
                                },
                                {
                                    "bbox": [
                                        104,
                                        555,
                                        530,
                                        596
                                    ],
                                    "type": "text",
                                    "content": " is an improvement over any "
                                },
                                {
                                    "bbox": [
                                        104,
                                        555,
                                        530,
                                        596
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\epsilon"
                                },
                                {
                                    "bbox": [
                                        104,
                                        555,
                                        530,
                                        596
                                    ],
                                    "type": "text",
                                    "content": "- soft policy "
                                },
                                {
                                    "bbox": [
                                        104,
                                        555,
                                        530,
                                        596
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\pi"
                                },
                                {
                                    "bbox": [
                                        104,
                                        555,
                                        530,
                                        596
                                    ],
                                    "type": "text",
                                    "content": " is assured by the policy improvement theorem. Let "
                                },
                                {
                                    "bbox": [
                                        104,
                                        555,
                                        530,
                                        596
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\pi '"
                                },
                                {
                                    "bbox": [
                                        104,
                                        555,
                                        530,
                                        596
                                    ],
                                    "type": "text",
                                    "content": " be the "
                                },
                                {
                                    "bbox": [
                                        104,
                                        555,
                                        530,
                                        596
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\epsilon"
                                },
                                {
                                    "bbox": [
                                        104,
                                        555,
                                        530,
                                        596
                                    ],
                                    "type": "text",
                                    "content": "- greedy policy. The conditions of the policy improvement theorem apply because for any "
                                },
                                {
                                    "bbox": [
                                        104,
                                        555,
                                        530,
                                        596
                                    ],
                                    "type": "inline_equation",
                                    "content": "s \\in \\mathbb{S}"
                                },
                                {
                                    "bbox": [
                                        104,
                                        555,
                                        530,
                                        596
                                    ],
                                    "type": "text",
                                    "content": ":"
                                }
                            ]
                        }
                    ],
                    "index": 18
                },
                {
                    "bbox": [
                        130,
                        603,
                        528,
                        701
                    ],
                    "type": "interline_equation",
                    "lines": [
                        {
                            "bbox": [
                                130,
                                603,
                                528,
                                701
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        130,
                                        603,
                                        528,
                                        701
                                    ],
                                    "type": "interline_equation",
                                    "content": "\\begin{array}{r c l}{q_{\\pi}(s,\\pi^{\\prime}(s))} & = & {\\sum_{a}\\pi^{\\prime}(a|s)q_{\\pi}(s,a)}\\\\ & = & {\\frac{\\epsilon}{|\\mathcal{A}(s)|}\\sum_{a}q_{\\pi}(s,a) + (1 - \\epsilon)\\max_{a}q_{\\pi}(s,a)}\\\\ & \\geq & {\\frac{\\epsilon}{|\\mathcal{A}(s)|}\\sum_{a}q_{\\pi}(s,a) + (1 - \\epsilon)\\sum_{a}\\frac{\\pi(a|s) - \\frac{\\epsilon}{|\\mathcal{A}(s)|}}{1 - \\epsilon} q_{\\pi}(s,a)} \\end{array} \\tag{5.2}",
                                    "image_path": "8fa3c83a9126dbe83b2d24a09a240e6d2012c58f82cd4918be1771019ca2c3bb.jpg"
                                }
                            ]
                        }
                    ],
                    "index": 19
                }
            ],
            "discarded_blocks": [],
            "page_size": [
                595,
                842
            ],
            "page_idx": 10
        },
        {
            "para_blocks": [
                {
                    "bbox": [
                        63,
                        140,
                        490,
                        168
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                63,
                                140,
                                490,
                                168
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        63,
                                        140,
                                        490,
                                        168
                                    ],
                                    "type": "text",
                                    "content": "(the sum is a weighted average with nonnegative weights summing to 1, and as such it must be less than or equal to the largest number averaged)"
                                }
                            ]
                        }
                    ],
                    "index": 0
                },
                {
                    "bbox": [
                        149,
                        175,
                        468,
                        223
                    ],
                    "type": "interline_equation",
                    "lines": [
                        {
                            "bbox": [
                                149,
                                175,
                                468,
                                223
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        149,
                                        175,
                                        468,
                                        223
                                    ],
                                    "type": "interline_equation",
                                    "content": "\\begin{array}{l}{{=\\frac{\\epsilon}{|\\mathcal{A}(s)|}\\sum_{a}q_{\\pi}(s,a)~-~\\frac{\\epsilon}{|\\mathcal{A}(s)|}\\sum_{a}q_{\\pi}(s,a)~+~\\sum_{a}\\pi(a|s)q_{\\pi}(s,a)}}\\\\ {{~=~v_{\\pi}(s)~.}}\\end{array}",
                                    "image_path": "f67c7fd1b1ffc23b4fb87db852ff7a3e9ed244c8901f634ed1084ce22af2850d.jpg"
                                }
                            ]
                        }
                    ],
                    "index": 1
                },
                {
                    "bbox": [
                        64,
                        229,
                        490,
                        270
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                64,
                                229,
                                490,
                                270
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        64,
                                        229,
                                        490,
                                        270
                                    ],
                                    "type": "text",
                                    "content": "Thus, by the policy improvement theorem, "
                                },
                                {
                                    "bbox": [
                                        64,
                                        229,
                                        490,
                                        270
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\pi^{\\prime}\\geq \\pi"
                                },
                                {
                                    "bbox": [
                                        64,
                                        229,
                                        490,
                                        270
                                    ],
                                    "type": "text",
                                    "content": " (i.e., "
                                },
                                {
                                    "bbox": [
                                        64,
                                        229,
                                        490,
                                        270
                                    ],
                                    "type": "inline_equation",
                                    "content": "v_{\\pi^{\\prime}}(s)\\geq v_{\\pi}(s)"
                                },
                                {
                                    "bbox": [
                                        64,
                                        229,
                                        490,
                                        270
                                    ],
                                    "type": "text",
                                    "content": " , for all "
                                },
                                {
                                    "bbox": [
                                        64,
                                        229,
                                        490,
                                        270
                                    ],
                                    "type": "inline_equation",
                                    "content": "s\\in S"
                                },
                                {
                                    "bbox": [
                                        64,
                                        229,
                                        490,
                                        270
                                    ],
                                    "type": "text",
                                    "content": " ). We now prove that equality can hold only when both "
                                },
                                {
                                    "bbox": [
                                        64,
                                        229,
                                        490,
                                        270
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\pi^{\\prime}"
                                },
                                {
                                    "bbox": [
                                        64,
                                        229,
                                        490,
                                        270
                                    ],
                                    "type": "text",
                                    "content": " and "
                                },
                                {
                                    "bbox": [
                                        64,
                                        229,
                                        490,
                                        270
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\pi"
                                },
                                {
                                    "bbox": [
                                        64,
                                        229,
                                        490,
                                        270
                                    ],
                                    "type": "text",
                                    "content": " are optimal among the "
                                },
                                {
                                    "bbox": [
                                        64,
                                        229,
                                        490,
                                        270
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\epsilon"
                                },
                                {
                                    "bbox": [
                                        64,
                                        229,
                                        490,
                                        270
                                    ],
                                    "type": "text",
                                    "content": " - soft policies, that is, when they are better than or equal to all other "
                                },
                                {
                                    "bbox": [
                                        64,
                                        229,
                                        490,
                                        270
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\epsilon"
                                },
                                {
                                    "bbox": [
                                        64,
                                        229,
                                        490,
                                        270
                                    ],
                                    "type": "text",
                                    "content": " - soft policies."
                                }
                            ]
                        }
                    ],
                    "index": 2
                },
                {
                    "bbox": [
                        64,
                        271,
                        490,
                        417
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                64,
                                271,
                                490,
                                417
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        64,
                                        271,
                                        490,
                                        417
                                    ],
                                    "type": "text",
                                    "content": "Consider a new environment that is just like the original environment, except with the requirement that policies be "
                                },
                                {
                                    "bbox": [
                                        64,
                                        271,
                                        490,
                                        417
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\epsilon"
                                },
                                {
                                    "bbox": [
                                        64,
                                        271,
                                        490,
                                        417
                                    ],
                                    "type": "text",
                                    "content": " - soft \"moved inside\" the environment. The new environment has the same action and state set as the original and behaves as follows. If in state "
                                },
                                {
                                    "bbox": [
                                        64,
                                        271,
                                        490,
                                        417
                                    ],
                                    "type": "inline_equation",
                                    "content": "s"
                                },
                                {
                                    "bbox": [
                                        64,
                                        271,
                                        490,
                                        417
                                    ],
                                    "type": "text",
                                    "content": " and taking action "
                                },
                                {
                                    "bbox": [
                                        64,
                                        271,
                                        490,
                                        417
                                    ],
                                    "type": "inline_equation",
                                    "content": "a"
                                },
                                {
                                    "bbox": [
                                        64,
                                        271,
                                        490,
                                        417
                                    ],
                                    "type": "text",
                                    "content": " , then with probability "
                                },
                                {
                                    "bbox": [
                                        64,
                                        271,
                                        490,
                                        417
                                    ],
                                    "type": "inline_equation",
                                    "content": "1 - \\epsilon"
                                },
                                {
                                    "bbox": [
                                        64,
                                        271,
                                        490,
                                        417
                                    ],
                                    "type": "text",
                                    "content": " the new environment behaves exactly like the old environment. With probability "
                                },
                                {
                                    "bbox": [
                                        64,
                                        271,
                                        490,
                                        417
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\epsilon"
                                },
                                {
                                    "bbox": [
                                        64,
                                        271,
                                        490,
                                        417
                                    ],
                                    "type": "text",
                                    "content": " it repicks the action at random, with equal probabilities, and then behaves like the old environment with the new, random action. The best one can do in this new environment with general policies is the same as the best one could do in the original environment with "
                                },
                                {
                                    "bbox": [
                                        64,
                                        271,
                                        490,
                                        417
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\epsilon"
                                },
                                {
                                    "bbox": [
                                        64,
                                        271,
                                        490,
                                        417
                                    ],
                                    "type": "text",
                                    "content": " - soft policies. Let "
                                },
                                {
                                    "bbox": [
                                        64,
                                        271,
                                        490,
                                        417
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\widetilde{v}_{*}"
                                },
                                {
                                    "bbox": [
                                        64,
                                        271,
                                        490,
                                        417
                                    ],
                                    "type": "text",
                                    "content": " and "
                                },
                                {
                                    "bbox": [
                                        64,
                                        271,
                                        490,
                                        417
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\widetilde{q}_{*}"
                                },
                                {
                                    "bbox": [
                                        64,
                                        271,
                                        490,
                                        417
                                    ],
                                    "type": "text",
                                    "content": " denote the optimal value functions for the new environment. Then a policy "
                                },
                                {
                                    "bbox": [
                                        64,
                                        271,
                                        490,
                                        417
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\pi"
                                },
                                {
                                    "bbox": [
                                        64,
                                        271,
                                        490,
                                        417
                                    ],
                                    "type": "text",
                                    "content": " is optimal among "
                                },
                                {
                                    "bbox": [
                                        64,
                                        271,
                                        490,
                                        417
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\epsilon"
                                },
                                {
                                    "bbox": [
                                        64,
                                        271,
                                        490,
                                        417
                                    ],
                                    "type": "text",
                                    "content": " - soft policies if and only if "
                                },
                                {
                                    "bbox": [
                                        64,
                                        271,
                                        490,
                                        417
                                    ],
                                    "type": "inline_equation",
                                    "content": "v_{\\pi} = \\widetilde{v}_{*}"
                                },
                                {
                                    "bbox": [
                                        64,
                                        271,
                                        490,
                                        417
                                    ],
                                    "type": "text",
                                    "content": " . We know that "
                                },
                                {
                                    "bbox": [
                                        64,
                                        271,
                                        490,
                                        417
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\widetilde{v}_{*}"
                                },
                                {
                                    "bbox": [
                                        64,
                                        271,
                                        490,
                                        417
                                    ],
                                    "type": "text",
                                    "content": " is the unique solution to the Bellman optimality equation (3.19) with altered transition probabilities:"
                                }
                            ]
                        }
                    ],
                    "index": 3
                },
                {
                    "bbox": [
                        91,
                        425,
                        449,
                        524
                    ],
                    "type": "interline_equation",
                    "lines": [
                        {
                            "bbox": [
                                91,
                                425,
                                449,
                                524
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        91,
                                        425,
                                        449,
                                        524
                                    ],
                                    "type": "interline_equation",
                                    "content": "\\begin{array}{l}{\\widetilde{v}_{*}(s) = \\max_{a}\\sum_{s^{\\prime},r}\\Big[(1 - \\epsilon)p(s^{\\prime},r|s,a) + \\sum_{a^{\\prime}}\\frac{\\epsilon}{|\\mathcal{A}(s)|} p(s^{\\prime},r|s,a^{\\prime})\\Big]\\Big[r + \\gamma \\widetilde{v}_{*}(s^{\\prime})\\Big]}\\\\ {= (1 - \\epsilon)\\max_{a}\\sum_{s^{\\prime},r}p(s^{\\prime},r|s,a)\\Big[r + \\gamma \\widetilde{v}_{*}(s^{\\prime})\\Big]}\\\\ {+ \\frac{\\epsilon}{|\\mathcal{A}(s)|}\\sum_{a}\\sum_{s^{\\prime},r}p(s^{\\prime},r|s,a)\\Big[r + \\gamma \\widetilde{v}_{*}(s^{\\prime})\\Big].} \\end{array}",
                                    "image_path": "49810830e2f08454c3a59758c710c4401c0ca975a98955cbc2306648309ad054.jpg"
                                }
                            ]
                        }
                    ],
                    "index": 4
                },
                {
                    "bbox": [
                        63,
                        529,
                        491,
                        556
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                63,
                                529,
                                491,
                                556
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        63,
                                        529,
                                        491,
                                        556
                                    ],
                                    "type": "text",
                                    "content": "When equality holds and the "
                                },
                                {
                                    "bbox": [
                                        63,
                                        529,
                                        491,
                                        556
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\epsilon"
                                },
                                {
                                    "bbox": [
                                        63,
                                        529,
                                        491,
                                        556
                                    ],
                                    "type": "text",
                                    "content": " - soft policy "
                                },
                                {
                                    "bbox": [
                                        63,
                                        529,
                                        491,
                                        556
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\pi"
                                },
                                {
                                    "bbox": [
                                        63,
                                        529,
                                        491,
                                        556
                                    ],
                                    "type": "text",
                                    "content": " is no longer improved, then we also know, from (5.2), that"
                                }
                            ]
                        }
                    ],
                    "index": 5
                },
                {
                    "bbox": [
                        91,
                        560,
                        374,
                        656
                    ],
                    "type": "interline_equation",
                    "lines": [
                        {
                            "bbox": [
                                91,
                                560,
                                374,
                                656
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        91,
                                        560,
                                        374,
                                        656
                                    ],
                                    "type": "interline_equation",
                                    "content": "\\begin{array}{r c l}{{v_{\\pi}(s)}}&{{=}}&{{(1-\\epsilon)\\max _{a}q_{\\pi}(s,a)+\\frac{\\epsilon}{|\\mathcal{A}(s)|}\\sum_{a}q_{\\pi}(s,a)}}\\\\ {{}}&{{=}}&{{(1-\\epsilon)\\max _{a}\\sum_{s^{\\prime},r}p(s^{\\prime},r|s,a)\\Big[r+\\gamma v_{\\pi}(s^{\\prime})\\Big]}}\\\\ {{}}&{{+}}&{{\\frac{\\epsilon}{|\\mathcal{A}(s)|}\\sum_{a}\\sum_{s^{\\prime},r}p(s^{\\prime},r|s,a)\\Big[r+\\gamma v_{\\pi}(s^{\\prime})\\Big].}}\\end{array}",
                                    "image_path": "7c37105c65cc92d34705d638ce3504d0af9be9b69d6c7d7c8407c5296f3910bf.jpg"
                                }
                            ]
                        }
                    ],
                    "index": 6
                },
                {
                    "bbox": [
                        64,
                        661,
                        488,
                        688
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                64,
                                661,
                                488,
                                688
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        64,
                                        661,
                                        488,
                                        688
                                    ],
                                    "type": "text",
                                    "content": "However, this equation is the same as the previous one, except for the substitution of "
                                },
                                {
                                    "bbox": [
                                        64,
                                        661,
                                        488,
                                        688
                                    ],
                                    "type": "inline_equation",
                                    "content": "v_{\\pi}"
                                },
                                {
                                    "bbox": [
                                        64,
                                        661,
                                        488,
                                        688
                                    ],
                                    "type": "text",
                                    "content": " for "
                                },
                                {
                                    "bbox": [
                                        64,
                                        661,
                                        488,
                                        688
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\widetilde{v}_{*}"
                                },
                                {
                                    "bbox": [
                                        64,
                                        661,
                                        488,
                                        688
                                    ],
                                    "type": "text",
                                    "content": " . Because "
                                },
                                {
                                    "bbox": [
                                        64,
                                        661,
                                        488,
                                        688
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\widetilde{v}_{*}"
                                },
                                {
                                    "bbox": [
                                        64,
                                        661,
                                        488,
                                        688
                                    ],
                                    "type": "text",
                                    "content": " is the unique solution, it must be that "
                                },
                                {
                                    "bbox": [
                                        64,
                                        661,
                                        488,
                                        688
                                    ],
                                    "type": "inline_equation",
                                    "content": "v_{\\pi} = \\widetilde{v}_{*}"
                                }
                            ]
                        }
                    ],
                    "index": 7
                },
                {
                    "bbox": [
                        64,
                        689,
                        490,
                        742
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                64,
                                689,
                                490,
                                742
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        64,
                                        689,
                                        490,
                                        742
                                    ],
                                    "type": "text",
                                    "content": "In essence, we have shown in the last few pages that policy iteration works for "
                                },
                                {
                                    "bbox": [
                                        64,
                                        689,
                                        490,
                                        742
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\epsilon"
                                },
                                {
                                    "bbox": [
                                        64,
                                        689,
                                        490,
                                        742
                                    ],
                                    "type": "text",
                                    "content": " - soft policies. Using the natural notion of greedy policy for "
                                },
                                {
                                    "bbox": [
                                        64,
                                        689,
                                        490,
                                        742
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\epsilon"
                                },
                                {
                                    "bbox": [
                                        64,
                                        689,
                                        490,
                                        742
                                    ],
                                    "type": "text",
                                    "content": " - soft policies, one is assured of improvement on every step, except when the best policy has been found among the "
                                },
                                {
                                    "bbox": [
                                        64,
                                        689,
                                        490,
                                        742
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\epsilon"
                                },
                                {
                                    "bbox": [
                                        64,
                                        689,
                                        490,
                                        742
                                    ],
                                    "type": "text",
                                    "content": " - soft policies. This analysis is independent of how the action- value functions are determined"
                                }
                            ]
                        }
                    ],
                    "index": 8
                }
            ],
            "discarded_blocks": [],
            "page_size": [
                595,
                842
            ],
            "page_idx": 11
        },
        {
            "para_blocks": [
                {
                    "bbox": [
                        104,
                        141,
                        530,
                        193
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                104,
                                141,
                                530,
                                193
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        104,
                                        141,
                                        530,
                                        193
                                    ],
                                    "type": "text",
                                    "content": "at each stage, but it does assume that they are computed exactly. This brings us to roughly the same point as in the previous section. Now we only achieve the best policy among the "
                                },
                                {
                                    "bbox": [
                                        104,
                                        141,
                                        530,
                                        193
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\epsilon"
                                },
                                {
                                    "bbox": [
                                        104,
                                        141,
                                        530,
                                        193
                                    ],
                                    "type": "text",
                                    "content": "- soft policies, but on the other hand, we have eliminated the assumption of exploring starts."
                                }
                            ]
                        }
                    ],
                    "index": 0
                },
                {
                    "bbox": [
                        104,
                        215,
                        514,
                        234
                    ],
                    "type": "title",
                    "lines": [
                        {
                            "bbox": [
                                104,
                                215,
                                514,
                                234
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        104,
                                        215,
                                        514,
                                        234
                                    ],
                                    "type": "text",
                                    "content": "5.5 Off-policy Prediction via Importance Sampling"
                                }
                            ]
                        }
                    ],
                    "index": 1,
                    "level": 1
                },
                {
                    "bbox": [
                        104,
                        245,
                        530,
                        391
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                104,
                                245,
                                530,
                                391
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        104,
                                        245,
                                        530,
                                        391
                                    ],
                                    "type": "text",
                                    "content": "All learning control methods face a dilemma: They seek to learn action values conditional on subsequent optimal behavior, but they need to behave non- optimally in order to explore all actions (to find the optimal actions). How can they learn about the optimal policy while behaving according to an exploratory policy? The on- policy approach in the preceding section is actually a compromise—it learns action values not for the optimal policy, but for a near- optimal policy that still explores. A more straightforward approach is to use two policies, one that is learned about and that becomes the optimal policy, and one that is more exploratory and is used to generate behavior. The policy being learned about is called the target policy, and the policy used to generate behavior is called the behavior policy. In this case we say that learning is from data \"off\" the target policy, and the overall process is termed off- policy learning."
                                }
                            ]
                        }
                    ],
                    "index": 2
                },
                {
                    "bbox": [
                        104,
                        393,
                        530,
                        538
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                104,
                                393,
                                530,
                                538
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        104,
                                        393,
                                        530,
                                        538
                                    ],
                                    "type": "text",
                                    "content": "Throughout the rest of this book we consider both on- policy and off- policy methods. On- policy methods are generally simpler and are considered first. Off- policy methods require additional concepts and notation, and because the data is due to a different policy, off- policy methods are often of greater variance and are slower to converge. On the other hand, off- policy methods are more powerful and general. They include on- policy methods as the special case in which the target and behavior policies are the same. Off- policy methods also have a variety of additional uses in applications. For example, they can often be applied to learn from data generated by a conventional non- learning controller, or from a human expert. Off- policy learning is also seen by some as key to learning multi- step predictive models of the world's dynamics (see Section 17.2; Sutton, 2009; Sutton et al., 2011)."
                                }
                            ]
                        }
                    ],
                    "index": 3
                },
                {
                    "bbox": [
                        104,
                        540,
                        530,
                        606
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                104,
                                540,
                                530,
                                606
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        104,
                                        540,
                                        530,
                                        606
                                    ],
                                    "type": "text",
                                    "content": "In this section we begin the study of off- policy methods by considering the prediction problem, in which both target and behavior policies are fixed. That is, suppose we wish to estimate "
                                },
                                {
                                    "bbox": [
                                        104,
                                        540,
                                        530,
                                        606
                                    ],
                                    "type": "inline_equation",
                                    "content": "v_{\\pi}"
                                },
                                {
                                    "bbox": [
                                        104,
                                        540,
                                        530,
                                        606
                                    ],
                                    "type": "text",
                                    "content": " or "
                                },
                                {
                                    "bbox": [
                                        104,
                                        540,
                                        530,
                                        606
                                    ],
                                    "type": "inline_equation",
                                    "content": "q_{\\pi}"
                                },
                                {
                                    "bbox": [
                                        104,
                                        540,
                                        530,
                                        606
                                    ],
                                    "type": "text",
                                    "content": ", but all we have are episodes following another policy "
                                },
                                {
                                    "bbox": [
                                        104,
                                        540,
                                        530,
                                        606
                                    ],
                                    "type": "inline_equation",
                                    "content": "b"
                                },
                                {
                                    "bbox": [
                                        104,
                                        540,
                                        530,
                                        606
                                    ],
                                    "type": "text",
                                    "content": ", where "
                                },
                                {
                                    "bbox": [
                                        104,
                                        540,
                                        530,
                                        606
                                    ],
                                    "type": "inline_equation",
                                    "content": "b \\neq \\pi"
                                },
                                {
                                    "bbox": [
                                        104,
                                        540,
                                        530,
                                        606
                                    ],
                                    "type": "text",
                                    "content": ". In this case, "
                                },
                                {
                                    "bbox": [
                                        104,
                                        540,
                                        530,
                                        606
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\pi"
                                },
                                {
                                    "bbox": [
                                        104,
                                        540,
                                        530,
                                        606
                                    ],
                                    "type": "text",
                                    "content": " is the target policy, "
                                },
                                {
                                    "bbox": [
                                        104,
                                        540,
                                        530,
                                        606
                                    ],
                                    "type": "inline_equation",
                                    "content": "b"
                                },
                                {
                                    "bbox": [
                                        104,
                                        540,
                                        530,
                                        606
                                    ],
                                    "type": "text",
                                    "content": " is the behavior policy, and both policies are considered fixed and given."
                                }
                            ]
                        }
                    ],
                    "index": 4
                },
                {
                    "bbox": [
                        104,
                        607,
                        530,
                        740
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                104,
                                607,
                                530,
                                740
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        104,
                                        607,
                                        530,
                                        740
                                    ],
                                    "type": "text",
                                    "content": "In order to use episodes from "
                                },
                                {
                                    "bbox": [
                                        104,
                                        607,
                                        530,
                                        740
                                    ],
                                    "type": "inline_equation",
                                    "content": "b"
                                },
                                {
                                    "bbox": [
                                        104,
                                        607,
                                        530,
                                        740
                                    ],
                                    "type": "text",
                                    "content": " to estimate values for "
                                },
                                {
                                    "bbox": [
                                        104,
                                        607,
                                        530,
                                        740
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\pi"
                                },
                                {
                                    "bbox": [
                                        104,
                                        607,
                                        530,
                                        740
                                    ],
                                    "type": "text",
                                    "content": ", we require that every action taken under "
                                },
                                {
                                    "bbox": [
                                        104,
                                        607,
                                        530,
                                        740
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\pi"
                                },
                                {
                                    "bbox": [
                                        104,
                                        607,
                                        530,
                                        740
                                    ],
                                    "type": "text",
                                    "content": " is also taken, at least occasionally, under "
                                },
                                {
                                    "bbox": [
                                        104,
                                        607,
                                        530,
                                        740
                                    ],
                                    "type": "inline_equation",
                                    "content": "b"
                                },
                                {
                                    "bbox": [
                                        104,
                                        607,
                                        530,
                                        740
                                    ],
                                    "type": "text",
                                    "content": ". That is, we require that "
                                },
                                {
                                    "bbox": [
                                        104,
                                        607,
                                        530,
                                        740
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\pi (a|s) > 0"
                                },
                                {
                                    "bbox": [
                                        104,
                                        607,
                                        530,
                                        740
                                    ],
                                    "type": "text",
                                    "content": " implies "
                                },
                                {
                                    "bbox": [
                                        104,
                                        607,
                                        530,
                                        740
                                    ],
                                    "type": "inline_equation",
                                    "content": "b(a|s) > 0"
                                },
                                {
                                    "bbox": [
                                        104,
                                        607,
                                        530,
                                        740
                                    ],
                                    "type": "text",
                                    "content": ". This is called the assumption of coverage. It follows from coverage that "
                                },
                                {
                                    "bbox": [
                                        104,
                                        607,
                                        530,
                                        740
                                    ],
                                    "type": "inline_equation",
                                    "content": "b"
                                },
                                {
                                    "bbox": [
                                        104,
                                        607,
                                        530,
                                        740
                                    ],
                                    "type": "text",
                                    "content": " must be stochastic in states where it is not identical to "
                                },
                                {
                                    "bbox": [
                                        104,
                                        607,
                                        530,
                                        740
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\pi"
                                },
                                {
                                    "bbox": [
                                        104,
                                        607,
                                        530,
                                        740
                                    ],
                                    "type": "text",
                                    "content": ". The target policy "
                                },
                                {
                                    "bbox": [
                                        104,
                                        607,
                                        530,
                                        740
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\pi"
                                },
                                {
                                    "bbox": [
                                        104,
                                        607,
                                        530,
                                        740
                                    ],
                                    "type": "text",
                                    "content": ", on the other hand, may be deterministic, and, in fact, this is a case of particular interest in control applications. In control, the target policy is typically the deterministic greedy policy with respect to the current estimate of the action- value function. This policy becomes a deterministic optimal policy while the behavior policy remains stochastic and more exploratory, for example, an "
                                },
                                {
                                    "bbox": [
                                        104,
                                        607,
                                        530,
                                        740
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\epsilon"
                                },
                                {
                                    "bbox": [
                                        104,
                                        607,
                                        530,
                                        740
                                    ],
                                    "type": "text",
                                    "content": "- greedy policy. In this section, however, we consider the prediction problem, in which "
                                },
                                {
                                    "bbox": [
                                        104,
                                        607,
                                        530,
                                        740
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\pi"
                                },
                                {
                                    "bbox": [
                                        104,
                                        607,
                                        530,
                                        740
                                    ],
                                    "type": "text",
                                    "content": " is unchanging and given."
                                }
                            ]
                        }
                    ],
                    "index": 5
                }
            ],
            "discarded_blocks": [],
            "page_size": [
                595,
                842
            ],
            "page_idx": 12
        },
        {
            "para_blocks": [
                {
                    "bbox": [
                        64,
                        140,
                        490,
                        222
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                64,
                                140,
                                490,
                                222
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        64,
                                        140,
                                        490,
                                        222
                                    ],
                                    "type": "text",
                                    "content": "Almost all off- policy methods utilize importance sampling, a general technique for estimating expected values under one distribution given samples from another. We apply importance sampling to off- policy learning by weighting returns according to the relative probability of their trajectories occurring under the target and behavior policies, called the importance- sampling ratio. Given a starting state "
                                },
                                {
                                    "bbox": [
                                        64,
                                        140,
                                        490,
                                        222
                                    ],
                                    "type": "inline_equation",
                                    "content": "S_{t}"
                                },
                                {
                                    "bbox": [
                                        64,
                                        140,
                                        490,
                                        222
                                    ],
                                    "type": "text",
                                    "content": ", the probability of the subsequent state- action trajectory, "
                                },
                                {
                                    "bbox": [
                                        64,
                                        140,
                                        490,
                                        222
                                    ],
                                    "type": "inline_equation",
                                    "content": "A_{t}, S_{t + 1}, A_{t + 1}, \\ldots , S_{T}"
                                },
                                {
                                    "bbox": [
                                        64,
                                        140,
                                        490,
                                        222
                                    ],
                                    "type": "text",
                                    "content": ", occurring under any policy "
                                },
                                {
                                    "bbox": [
                                        64,
                                        140,
                                        490,
                                        222
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\pi"
                                },
                                {
                                    "bbox": [
                                        64,
                                        140,
                                        490,
                                        222
                                    ],
                                    "type": "text",
                                    "content": " is"
                                }
                            ]
                        }
                    ],
                    "index": 0
                },
                {
                    "bbox": [
                        90,
                        227,
                        410,
                        300
                    ],
                    "type": "interline_equation",
                    "lines": [
                        {
                            "bbox": [
                                90,
                                227,
                                410,
                                300
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        90,
                                        227,
                                        410,
                                        300
                                    ],
                                    "type": "interline_equation",
                                    "content": "\\begin{array}{r l} & {\\operatorname *{Pr}\\{A_{t},S_{t + 1},A_{t + 1},\\dots ,S_{T}\\mid S_{t},A_{t:T - 1}\\sim \\pi \\}}\\\\ & {\\quad = \\pi (A_{t}|S_{t})p(S_{t + 1}|S_{t},A_{t})\\pi (A_{t + 1}|S_{t + 1})\\dots p(S_{T}|S_{T - 1},A_{T - 1})}\\\\ & {\\quad = \\prod_{k = t}^{T - 1}\\pi (A_{k}|S_{k})p(S_{k + 1}|S_{k},A_{k}),} \\end{array}",
                                    "image_path": "c24ee0dcb033edd929568d3c0b85c10de46e08ecdcd38b0e1e26337ac07a1f56.jpg"
                                }
                            ]
                        }
                    ],
                    "index": 1
                },
                {
                    "bbox": [
                        64,
                        304,
                        490,
                        345
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                64,
                                304,
                                490,
                                345
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        64,
                                        304,
                                        490,
                                        345
                                    ],
                                    "type": "text",
                                    "content": "where "
                                },
                                {
                                    "bbox": [
                                        64,
                                        304,
                                        490,
                                        345
                                    ],
                                    "type": "inline_equation",
                                    "content": "p"
                                },
                                {
                                    "bbox": [
                                        64,
                                        304,
                                        490,
                                        345
                                    ],
                                    "type": "text",
                                    "content": " here is the state- transition probability function defined by (3.4). Thus, the relative probability of the trajectory under the target and behavior policies (the importance- sampling ratio) is"
                                }
                            ]
                        }
                    ],
                    "index": 2
                },
                {
                    "bbox": [
                        91,
                        351,
                        489,
                        388
                    ],
                    "type": "interline_equation",
                    "lines": [
                        {
                            "bbox": [
                                91,
                                351,
                                489,
                                388
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        91,
                                        351,
                                        489,
                                        388
                                    ],
                                    "type": "interline_equation",
                                    "content": "\\rho_{t:T - 1}\\doteq \\frac{\\prod_{k = t}^{T - 1}\\pi(A_k|S_k)p(S_{k + 1}|S_k,A_k)}{\\prod_{k = t}^{T - 1}b(A_k|S_k)p(S_{k + 1}|S_k,A_k)} = \\prod_{k = t}^{T - 1}\\frac{\\pi(A_k|S_k)}{b(A_k|S_k)}. \\tag{5.3}",
                                    "image_path": "cdb82d683cf48724e8f208efad448226377c01099f98cde6b09de5d5480f58c1.jpg"
                                }
                            ]
                        }
                    ],
                    "index": 3
                },
                {
                    "bbox": [
                        64,
                        394,
                        490,
                        447
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                64,
                                394,
                                490,
                                447
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        64,
                                        394,
                                        490,
                                        447
                                    ],
                                    "type": "text",
                                    "content": "Although the trajectory probabilities depend on the MDP's transition probabilities, which are generally unknown, they appear identically in both the numerator and denominator, and thus cancel. The importance sampling ratio ends up depending only on the two policies and the sequence, not on the MDP."
                                }
                            ]
                        }
                    ],
                    "index": 4
                },
                {
                    "bbox": [
                        64,
                        448,
                        490,
                        514
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                64,
                                448,
                                490,
                                514
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        64,
                                        448,
                                        490,
                                        514
                                    ],
                                    "type": "text",
                                    "content": "Recall that we wish to estimate the expected returns (values) under the target policy, but all we have are returns "
                                },
                                {
                                    "bbox": [
                                        64,
                                        448,
                                        490,
                                        514
                                    ],
                                    "type": "inline_equation",
                                    "content": "G_{t}"
                                },
                                {
                                    "bbox": [
                                        64,
                                        448,
                                        490,
                                        514
                                    ],
                                    "type": "text",
                                    "content": " due to the behavior policy. These returns have the wrong expectation "
                                },
                                {
                                    "bbox": [
                                        64,
                                        448,
                                        490,
                                        514
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\mathbb{E}[G_t|S_t = s] = v_b(s)"
                                },
                                {
                                    "bbox": [
                                        64,
                                        448,
                                        490,
                                        514
                                    ],
                                    "type": "text",
                                    "content": " and so cannot be averaged to obtain "
                                },
                                {
                                    "bbox": [
                                        64,
                                        448,
                                        490,
                                        514
                                    ],
                                    "type": "inline_equation",
                                    "content": "v_{\\pi}"
                                },
                                {
                                    "bbox": [
                                        64,
                                        448,
                                        490,
                                        514
                                    ],
                                    "type": "text",
                                    "content": ". This is where importance sampling comes in. The ratio "
                                },
                                {
                                    "bbox": [
                                        64,
                                        448,
                                        490,
                                        514
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\rho_{t:T - 1}"
                                },
                                {
                                    "bbox": [
                                        64,
                                        448,
                                        490,
                                        514
                                    ],
                                    "type": "text",
                                    "content": " transforms the returns to have the right expected value:"
                                }
                            ]
                        }
                    ],
                    "index": 5
                },
                {
                    "bbox": [
                        91,
                        522,
                        489,
                        536
                    ],
                    "type": "interline_equation",
                    "lines": [
                        {
                            "bbox": [
                                91,
                                522,
                                489,
                                536
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        91,
                                        522,
                                        489,
                                        536
                                    ],
                                    "type": "interline_equation",
                                    "content": "\\mathbb{E}[\\rho_{t:T - 1}G_t\\mid S_t = s] = v_{\\pi}(s). \\tag{5.4}",
                                    "image_path": "aa0e2c42f4336710be0955f4ee96cf6cd80144145f17114ce80337f29450028e.jpg"
                                }
                            ]
                        }
                    ],
                    "index": 6
                },
                {
                    "bbox": [
                        64,
                        544,
                        490,
                        707
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                64,
                                544,
                                490,
                                707
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        64,
                                        544,
                                        490,
                                        707
                                    ],
                                    "type": "text",
                                    "content": "Now we are ready to give a Monte Carlo algorithm that averages returns from a batch of observed episodes following policy "
                                },
                                {
                                    "bbox": [
                                        64,
                                        544,
                                        490,
                                        707
                                    ],
                                    "type": "inline_equation",
                                    "content": "b"
                                },
                                {
                                    "bbox": [
                                        64,
                                        544,
                                        490,
                                        707
                                    ],
                                    "type": "text",
                                    "content": " to estimate "
                                },
                                {
                                    "bbox": [
                                        64,
                                        544,
                                        490,
                                        707
                                    ],
                                    "type": "inline_equation",
                                    "content": "v_{\\pi}(s)"
                                },
                                {
                                    "bbox": [
                                        64,
                                        544,
                                        490,
                                        707
                                    ],
                                    "type": "text",
                                    "content": ". It is convenient here to number time steps in a way that increases across episode boundaries. That is, if the first episode of the batch ends in a terminal state at time 100, then the next episode begins at time "
                                },
                                {
                                    "bbox": [
                                        64,
                                        544,
                                        490,
                                        707
                                    ],
                                    "type": "inline_equation",
                                    "content": "t = 101"
                                },
                                {
                                    "bbox": [
                                        64,
                                        544,
                                        490,
                                        707
                                    ],
                                    "type": "text",
                                    "content": ". This enables us to use time- step numbers to refer to particular steps in particular episodes. In particular, we can define the set of all time steps in which state "
                                },
                                {
                                    "bbox": [
                                        64,
                                        544,
                                        490,
                                        707
                                    ],
                                    "type": "inline_equation",
                                    "content": "s"
                                },
                                {
                                    "bbox": [
                                        64,
                                        544,
                                        490,
                                        707
                                    ],
                                    "type": "text",
                                    "content": " is visited, denoted "
                                },
                                {
                                    "bbox": [
                                        64,
                                        544,
                                        490,
                                        707
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\mathcal{T}(s)"
                                },
                                {
                                    "bbox": [
                                        64,
                                        544,
                                        490,
                                        707
                                    ],
                                    "type": "text",
                                    "content": ". This is for an every- visit method; for a first- visit method, "
                                },
                                {
                                    "bbox": [
                                        64,
                                        544,
                                        490,
                                        707
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\mathcal{T}(s)"
                                },
                                {
                                    "bbox": [
                                        64,
                                        544,
                                        490,
                                        707
                                    ],
                                    "type": "text",
                                    "content": " would only include time steps that were first visits to "
                                },
                                {
                                    "bbox": [
                                        64,
                                        544,
                                        490,
                                        707
                                    ],
                                    "type": "inline_equation",
                                    "content": "s"
                                },
                                {
                                    "bbox": [
                                        64,
                                        544,
                                        490,
                                        707
                                    ],
                                    "type": "text",
                                    "content": " within their episodes. Also, let "
                                },
                                {
                                    "bbox": [
                                        64,
                                        544,
                                        490,
                                        707
                                    ],
                                    "type": "inline_equation",
                                    "content": "T(t)"
                                },
                                {
                                    "bbox": [
                                        64,
                                        544,
                                        490,
                                        707
                                    ],
                                    "type": "text",
                                    "content": " denote the first time of termination following time "
                                },
                                {
                                    "bbox": [
                                        64,
                                        544,
                                        490,
                                        707
                                    ],
                                    "type": "inline_equation",
                                    "content": "t"
                                },
                                {
                                    "bbox": [
                                        64,
                                        544,
                                        490,
                                        707
                                    ],
                                    "type": "text",
                                    "content": ", and "
                                },
                                {
                                    "bbox": [
                                        64,
                                        544,
                                        490,
                                        707
                                    ],
                                    "type": "inline_equation",
                                    "content": "G_{t}"
                                },
                                {
                                    "bbox": [
                                        64,
                                        544,
                                        490,
                                        707
                                    ],
                                    "type": "text",
                                    "content": " denote the return after "
                                },
                                {
                                    "bbox": [
                                        64,
                                        544,
                                        490,
                                        707
                                    ],
                                    "type": "inline_equation",
                                    "content": "t"
                                },
                                {
                                    "bbox": [
                                        64,
                                        544,
                                        490,
                                        707
                                    ],
                                    "type": "text",
                                    "content": " up through "
                                },
                                {
                                    "bbox": [
                                        64,
                                        544,
                                        490,
                                        707
                                    ],
                                    "type": "inline_equation",
                                    "content": "T(t)"
                                },
                                {
                                    "bbox": [
                                        64,
                                        544,
                                        490,
                                        707
                                    ],
                                    "type": "text",
                                    "content": ". Then "
                                },
                                {
                                    "bbox": [
                                        64,
                                        544,
                                        490,
                                        707
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\{G_{t}\\}_{t \\in \\mathcal{T}(s)}"
                                },
                                {
                                    "bbox": [
                                        64,
                                        544,
                                        490,
                                        707
                                    ],
                                    "type": "text",
                                    "content": " are the returns that pertain to state "
                                },
                                {
                                    "bbox": [
                                        64,
                                        544,
                                        490,
                                        707
                                    ],
                                    "type": "inline_equation",
                                    "content": "s"
                                },
                                {
                                    "bbox": [
                                        64,
                                        544,
                                        490,
                                        707
                                    ],
                                    "type": "text",
                                    "content": ", and "
                                },
                                {
                                    "bbox": [
                                        64,
                                        544,
                                        490,
                                        707
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\{\\rho_{t:T(t) - 1}\\}_{t \\in \\mathcal{T}(s)}"
                                },
                                {
                                    "bbox": [
                                        64,
                                        544,
                                        490,
                                        707
                                    ],
                                    "type": "text",
                                    "content": " are the corresponding importance- sampling ratios. To estimate "
                                },
                                {
                                    "bbox": [
                                        64,
                                        544,
                                        490,
                                        707
                                    ],
                                    "type": "inline_equation",
                                    "content": "v_{\\pi}(s)"
                                },
                                {
                                    "bbox": [
                                        64,
                                        544,
                                        490,
                                        707
                                    ],
                                    "type": "text",
                                    "content": ", we simply scale the returns by the ratios and average the results:"
                                }
                            ]
                        }
                    ],
                    "index": 7
                },
                {
                    "bbox": [
                        91,
                        711,
                        489,
                        743
                    ],
                    "type": "interline_equation",
                    "lines": [
                        {
                            "bbox": [
                                91,
                                711,
                                489,
                                743
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        91,
                                        711,
                                        489,
                                        743
                                    ],
                                    "type": "interline_equation",
                                    "content": "V(s)\\doteq \\frac{\\sum_{t\\in\\mathcal{T}(s)}\\rho_{t:T(t) - 1}G_t}{|\\mathcal{T}(s)|}. \\tag{5.5}",
                                    "image_path": "cfbf151b36c2622b11b4c5e467997c2110debe9b73c2995b3a348fe7ab745a48.jpg"
                                }
                            ]
                        }
                    ],
                    "index": 8
                }
            ],
            "discarded_blocks": [],
            "page_size": [
                595,
                842
            ],
            "page_idx": 13
        },
        {
            "para_blocks": [
                {
                    "bbox": [
                        104,
                        141,
                        530,
                        168
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                104,
                                141,
                                530,
                                168
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        104,
                                        141,
                                        530,
                                        168
                                    ],
                                    "type": "text",
                                    "content": "When importance sampling is done as a simple average in this way it is called ordinary importance sampling."
                                }
                            ]
                        }
                    ],
                    "index": 0
                },
                {
                    "bbox": [
                        104,
                        169,
                        530,
                        195
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                104,
                                169,
                                530,
                                195
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        104,
                                        169,
                                        530,
                                        195
                                    ],
                                    "type": "text",
                                    "content": "An important alternative is weighted importance sampling, which uses a weighted average, defined as"
                                }
                            ]
                        }
                    ],
                    "index": 1
                },
                {
                    "bbox": [
                        131,
                        206,
                        528,
                        238
                    ],
                    "type": "interline_equation",
                    "lines": [
                        {
                            "bbox": [
                                131,
                                206,
                                528,
                                238
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        131,
                                        206,
                                        528,
                                        238
                                    ],
                                    "type": "interline_equation",
                                    "content": "V(s)\\doteq \\frac{\\sum_{t\\in T(s)}\\rho_{t:T(t) - 1}G_{t}}{\\sum_{t\\in T(s)}\\rho_{t:T(t) - 1}}, \\tag{5.6}",
                                    "image_path": "fd94cfccd018478440a4f3d1ab0df6f37a6aaeb1706e8bf3dbfdf1af7421c87e.jpg"
                                }
                            ]
                        }
                    ],
                    "index": 2
                },
                {
                    "bbox": [
                        104,
                        248,
                        530,
                        421
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                104,
                                248,
                                530,
                                421
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        104,
                                        248,
                                        530,
                                        421
                                    ],
                                    "type": "text",
                                    "content": "or zero if the denominator is zero. To understand these two varieties of importance sampling, consider the estimates of their first- visit methods after observing a single return from state "
                                },
                                {
                                    "bbox": [
                                        104,
                                        248,
                                        530,
                                        421
                                    ],
                                    "type": "inline_equation",
                                    "content": "s"
                                },
                                {
                                    "bbox": [
                                        104,
                                        248,
                                        530,
                                        421
                                    ],
                                    "type": "text",
                                    "content": ". In the weighted- average estimate, the ratio "
                                },
                                {
                                    "bbox": [
                                        104,
                                        248,
                                        530,
                                        421
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\rho_{t:T(t) - 1}"
                                },
                                {
                                    "bbox": [
                                        104,
                                        248,
                                        530,
                                        421
                                    ],
                                    "type": "text",
                                    "content": " for the single return cancels in the numerator and denominator, so that the estimate is equal to the observed return independent of the ratio (assuming the ratio is nonzero). Given that this return was the only one observed, this is a reasonable estimate, but its expectation is "
                                },
                                {
                                    "bbox": [
                                        104,
                                        248,
                                        530,
                                        421
                                    ],
                                    "type": "inline_equation",
                                    "content": "v_{b}(s)"
                                },
                                {
                                    "bbox": [
                                        104,
                                        248,
                                        530,
                                        421
                                    ],
                                    "type": "text",
                                    "content": " rather than "
                                },
                                {
                                    "bbox": [
                                        104,
                                        248,
                                        530,
                                        421
                                    ],
                                    "type": "inline_equation",
                                    "content": "v_{\\pi}(s)"
                                },
                                {
                                    "bbox": [
                                        104,
                                        248,
                                        530,
                                        421
                                    ],
                                    "type": "text",
                                    "content": ", and in this statistical sense it is biased. In contrast, the first- visit version of the ordinary importance- sampling estimator (5.5) is always "
                                },
                                {
                                    "bbox": [
                                        104,
                                        248,
                                        530,
                                        421
                                    ],
                                    "type": "inline_equation",
                                    "content": "v_{\\pi}(s)"
                                },
                                {
                                    "bbox": [
                                        104,
                                        248,
                                        530,
                                        421
                                    ],
                                    "type": "text",
                                    "content": " in expectation (it is unbiased), but it can be extreme. Suppose the ratio were ten, indicating that the trajectory observed is ten times as likely under the target policy as under the behavior policy. In this case the ordinary importance- sampling estimate would be ten times the observed return. That is, it would be quite far from the observed return even though the episode's trajectory is considered very representative of the target policy."
                                }
                            ]
                        }
                    ],
                    "index": 3
                },
                {
                    "bbox": [
                        104,
                        422,
                        530,
                        581
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                104,
                                422,
                                530,
                                581
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        104,
                                        422,
                                        530,
                                        581
                                    ],
                                    "type": "text",
                                    "content": "Formally, the difference between the first- visit methods of the two kinds of importance sampling is expressed in their biases and variances. Ordinary importance sampling is unbiased whereas weighted importance sampling is biased (though the bias converges asymptotically to zero). On the other hand, the variance of ordinary importance sampling is in general unbounded because the variance of the ratios can be unbounded, whereas in the weighted estimator the largest weight on any single return is one. In fact, assuming bounded returns, the variance of the weighted importance- sampling estimator converges to zero even if the variance of the ratios themselves is infinite (Precup, Sutton, and Dasgupta 2001). In practice, the weighted estimator usually has dramatically lower variance and is strongly preferred. Nevertheless, we will not totally abandon ordinary importance sampling as it is easier to extend to the approximate methods using function approximation that we explore in the second part of this book."
                                }
                            ]
                        }
                    ],
                    "index": 4
                },
                {
                    "bbox": [
                        104,
                        583,
                        530,
                        662
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                104,
                                583,
                                530,
                                662
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        104,
                                        583,
                                        530,
                                        662
                                    ],
                                    "type": "text",
                                    "content": "The every- visit methods for ordinary and weighed importance sampling are both biased, though, again, the bias falls asymptotically to zero as the number of samples increases. In practice, every- visit methods are often preferred because they remove the need to keep track of which states have been visited and because they are much easier to extend to approximations. A complete every- visit MC algorithm for off- policy policy evaluation using weighted importance sampling is given in the next section on page 110."
                                }
                            ]
                        }
                    ],
                    "index": 5
                },
                {
                    "bbox": [
                        104,
                        673,
                        530,
                        740
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                104,
                                673,
                                530,
                                740
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        104,
                                        673,
                                        530,
                                        740
                                    ],
                                    "type": "text",
                                    "content": "Exercise 5.5 Consider an MDP with a single nonterminal state and a single action that transitions back to the nonterminal state with probability "
                                },
                                {
                                    "bbox": [
                                        104,
                                        673,
                                        530,
                                        740
                                    ],
                                    "type": "inline_equation",
                                    "content": "p"
                                },
                                {
                                    "bbox": [
                                        104,
                                        673,
                                        530,
                                        740
                                    ],
                                    "type": "text",
                                    "content": " and transitions to the terminal state with probability "
                                },
                                {
                                    "bbox": [
                                        104,
                                        673,
                                        530,
                                        740
                                    ],
                                    "type": "inline_equation",
                                    "content": "1 - p"
                                },
                                {
                                    "bbox": [
                                        104,
                                        673,
                                        530,
                                        740
                                    ],
                                    "type": "text",
                                    "content": ". Let the reward be "
                                },
                                {
                                    "bbox": [
                                        104,
                                        673,
                                        530,
                                        740
                                    ],
                                    "type": "inline_equation",
                                    "content": "+1"
                                },
                                {
                                    "bbox": [
                                        104,
                                        673,
                                        530,
                                        740
                                    ],
                                    "type": "text",
                                    "content": " on all transitions, and let "
                                },
                                {
                                    "bbox": [
                                        104,
                                        673,
                                        530,
                                        740
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\gamma = 1"
                                },
                                {
                                    "bbox": [
                                        104,
                                        673,
                                        530,
                                        740
                                    ],
                                    "type": "text",
                                    "content": ". Suppose you observe one episode that lasts 10 steps, with a return of 10. What are the first- visit and every- visit estimators of the value of the nonterminal state? "
                                },
                                {
                                    "bbox": [
                                        104,
                                        673,
                                        530,
                                        740
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\square"
                                }
                            ]
                        }
                    ],
                    "index": 6
                }
            ],
            "discarded_blocks": [],
            "page_size": [
                595,
                842
            ],
            "page_idx": 14
        },
        {
            "para_blocks": [
                {
                    "bbox": [
                        64,
                        140,
                        489,
                        393
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                64,
                                140,
                                489,
                                393
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        64,
                                        140,
                                        489,
                                        393
                                    ],
                                    "type": "text",
                                    "content": "Example 5.4: Off- policy Estimation of a Blackjack State Value We applied both ordinary and weighted importance- sampling methods to estimate the value of a single blackjack state (Example 5.1) from off- policy data. Recall that one of the advantages of Monte Carlo methods is that they can be used to evaluate a single state without forming estimates for any other states. In this example, we evaluated the state in which the dealer is showing a deuce, the sum of the player's cards is 13, and the player has a usable ace (that is, the player holds an ace and a deuce, or equivalently three aces). The data was generated by starting in this state then choosing to hit or stick at random with equal probability (the behavior policy). The target policy was to stick only on a sum of 20 or 21, as in Example 5.1. The value of this state under the target policy is approximately "
                                },
                                {
                                    "bbox": [
                                        64,
                                        140,
                                        489,
                                        393
                                    ],
                                    "type": "inline_equation",
                                    "content": "- 0.27726"
                                },
                                {
                                    "bbox": [
                                        64,
                                        140,
                                        489,
                                        393
                                    ],
                                    "type": "text",
                                    "content": " (this was determined by separately generating one- hundred million episodes using the target policy and averaging their returns). Both off- policy methods closely approximated this value after 1000 off- policy episodes using the random policy. To make sure they did this reliably, we performed 100 independent runs, each starting from estimates of zero and learning for 10,000 episodes. Figure 5.3 shows the resultant learning curves—the squared error of the estimates of each method as a function of number of episodes, averaged over the 100 runs. The error approaches zero for both algorithms, but the weighted importance- sampling method has much lower error at the beginning, as is typical in practice."
                                }
                            ]
                        }
                    ],
                    "index": 0
                },
                {
                    "type": "image",
                    "bbox": [
                        91,
                        403,
                        443,
                        573
                    ],
                    "blocks": [
                        {
                            "bbox": [
                                91,
                                403,
                                443,
                                573
                            ],
                            "lines": [
                                {
                                    "bbox": [
                                        91,
                                        403,
                                        443,
                                        573
                                    ],
                                    "spans": [
                                        {
                                            "bbox": [
                                                91,
                                                403,
                                                443,
                                                573
                                            ],
                                            "type": "image",
                                            "image_path": "4050fada12c0a6e21b2064aeb29ad8c9913820905d0b2273f6f8979af202c774.jpg"
                                        }
                                    ]
                                }
                            ],
                            "index": 1,
                            "type": "image_body"
                        },
                        {
                            "bbox": [
                                64,
                                579,
                                489,
                                604
                            ],
                            "lines": [
                                {
                                    "bbox": [
                                        64,
                                        579,
                                        489,
                                        604
                                    ],
                                    "spans": [
                                        {
                                            "bbox": [
                                                64,
                                                579,
                                                489,
                                                604
                                            ],
                                            "type": "text",
                                            "content": "Figure 5.3: Weighted importance sampling produces lower error estimates of the value of a single blackjack state from off-policy episodes."
                                        }
                                    ]
                                }
                            ],
                            "index": 2,
                            "type": "image_caption"
                        }
                    ],
                    "index": 1
                },
                {
                    "bbox": [
                        64,
                        620,
                        489,
                        740
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                64,
                                620,
                                489,
                                740
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        64,
                                        620,
                                        489,
                                        740
                                    ],
                                    "type": "text",
                                    "content": "Example 5.5: Infinite Variance The estimates of ordinary importance sampling will typically have infinite variance, and thus unsatisfactory convergence properties, whenever the scaled returns have infinite variance—and this can easily happen in off- policy learning when trajectories contain loops. A simple example is shown inset in Figure 5.4. There is only one nonterminal state "
                                },
                                {
                                    "bbox": [
                                        64,
                                        620,
                                        489,
                                        740
                                    ],
                                    "type": "inline_equation",
                                    "content": "s"
                                },
                                {
                                    "bbox": [
                                        64,
                                        620,
                                        489,
                                        740
                                    ],
                                    "type": "text",
                                    "content": " and two actions, right and left. The right action causes a deterministic transition to termination, whereas the left action transitions, with probability 0.9, back to "
                                },
                                {
                                    "bbox": [
                                        64,
                                        620,
                                        489,
                                        740
                                    ],
                                    "type": "inline_equation",
                                    "content": "s"
                                },
                                {
                                    "bbox": [
                                        64,
                                        620,
                                        489,
                                        740
                                    ],
                                    "type": "text",
                                    "content": " or, with probability 0.1, on to termination. The rewards are "
                                },
                                {
                                    "bbox": [
                                        64,
                                        620,
                                        489,
                                        740
                                    ],
                                    "type": "inline_equation",
                                    "content": "+1"
                                },
                                {
                                    "bbox": [
                                        64,
                                        620,
                                        489,
                                        740
                                    ],
                                    "type": "text",
                                    "content": " on the latter transition and otherwise zero. Consider the target policy that always selects left. All episodes under this policy consist of some number (possibly zero) of transitions back"
                                }
                            ]
                        }
                    ],
                    "index": 3
                }
            ],
            "discarded_blocks": [],
            "page_size": [
                595,
                842
            ],
            "page_idx": 15
        },
        {
            "para_blocks": [
                {
                    "bbox": [
                        104,
                        141,
                        530,
                        181
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                104,
                                141,
                                530,
                                181
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        104,
                                        141,
                                        530,
                                        181
                                    ],
                                    "type": "text",
                                    "content": "to "
                                },
                                {
                                    "bbox": [
                                        104,
                                        141,
                                        530,
                                        181
                                    ],
                                    "type": "inline_equation",
                                    "content": "s"
                                },
                                {
                                    "bbox": [
                                        104,
                                        141,
                                        530,
                                        181
                                    ],
                                    "type": "text",
                                    "content": " followed by termination with a reward and return of "
                                },
                                {
                                    "bbox": [
                                        104,
                                        141,
                                        530,
                                        181
                                    ],
                                    "type": "inline_equation",
                                    "content": "+1"
                                },
                                {
                                    "bbox": [
                                        104,
                                        141,
                                        530,
                                        181
                                    ],
                                    "type": "text",
                                    "content": ". Thus the value of "
                                },
                                {
                                    "bbox": [
                                        104,
                                        141,
                                        530,
                                        181
                                    ],
                                    "type": "inline_equation",
                                    "content": "s"
                                },
                                {
                                    "bbox": [
                                        104,
                                        141,
                                        530,
                                        181
                                    ],
                                    "type": "text",
                                    "content": " under the target policy is "
                                },
                                {
                                    "bbox": [
                                        104,
                                        141,
                                        530,
                                        181
                                    ],
                                    "type": "inline_equation",
                                    "content": "1 (s = 1)"
                                },
                                {
                                    "bbox": [
                                        104,
                                        141,
                                        530,
                                        181
                                    ],
                                    "type": "text",
                                    "content": ". Suppose we are estimating this value from off- policy data using the behavior policy that selects right and left with equal probability."
                                }
                            ]
                        }
                    ],
                    "index": 0
                },
                {
                    "type": "image",
                    "bbox": [
                        121,
                        199,
                        502,
                        406
                    ],
                    "blocks": [
                        {
                            "bbox": [
                                121,
                                199,
                                502,
                                406
                            ],
                            "lines": [
                                {
                                    "bbox": [
                                        121,
                                        199,
                                        502,
                                        406
                                    ],
                                    "spans": [
                                        {
                                            "bbox": [
                                                121,
                                                199,
                                                502,
                                                406
                                            ],
                                            "type": "image",
                                            "image_path": "8f5c8b8bc7486e4ee61cf5377d183e08762dfd1e61197323d146c39109f1a555.jpg"
                                        }
                                    ]
                                }
                            ],
                            "index": 1,
                            "type": "image_body"
                        },
                        {
                            "bbox": [
                                104,
                                416,
                                530,
                                478
                            ],
                            "lines": [
                                {
                                    "bbox": [
                                        104,
                                        416,
                                        530,
                                        478
                                    ],
                                    "spans": [
                                        {
                                            "bbox": [
                                                104,
                                                416,
                                                530,
                                                478
                                            ],
                                            "type": "text",
                                            "content": "Figure 5.4: Ordinary importance sampling produces surprisingly unstable estimates on the one-state MDP shown inset (Example 5.5). The correct estimate here is "
                                        },
                                        {
                                            "bbox": [
                                                104,
                                                416,
                                                530,
                                                478
                                            ],
                                            "type": "inline_equation",
                                            "content": "1 (\\gamma = 1)"
                                        },
                                        {
                                            "bbox": [
                                                104,
                                                416,
                                                530,
                                                478
                                            ],
                                            "type": "text",
                                            "content": ", and, even though this is the expected value of a sample return (after importance sampling), the variance of the samples is infinite, and the estimates do not converge to this value. These results are for off-policy first-visit MC."
                                        }
                                    ]
                                }
                            ],
                            "index": 2,
                            "type": "image_caption"
                        }
                    ],
                    "index": 1
                },
                {
                    "bbox": [
                        104,
                        499,
                        530,
                        618
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                104,
                                499,
                                530,
                                618
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        104,
                                        499,
                                        530,
                                        618
                                    ],
                                    "type": "text",
                                    "content": "The lower part of Figure 5.4 shows ten independent runs of the first- visit MC algorithm using ordinary importance sampling. Even after millions of episodes, the estimates fail to converge to the correct value of 1. In contrast, the weighted importance- sampling algorithm would give an estimate of exactly 1 forever after the first episode that ended with the left action. All returns not equal to 1 (that is, ending with the right action) would be inconsistent with the target policy and thus would have a "
                                },
                                {
                                    "bbox": [
                                        104,
                                        499,
                                        530,
                                        618
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\rho_{t:T(t) - 1}"
                                },
                                {
                                    "bbox": [
                                        104,
                                        499,
                                        530,
                                        618
                                    ],
                                    "type": "text",
                                    "content": " of zero and contribute neither to the numerator nor denominator of (5.6). The weighted importance- sampling algorithm produces a weighted average of only the returns consistent with the target policy, and all of these would be exactly 1."
                                }
                            ]
                        }
                    ],
                    "index": 3
                },
                {
                    "bbox": [
                        104,
                        619,
                        530,
                        660
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                104,
                                619,
                                530,
                                660
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        104,
                                        619,
                                        530,
                                        660
                                    ],
                                    "type": "text",
                                    "content": "We can verify that the variance of the importance- sampling- scaled returns is infinite in this example by a simple calculation. The variance of any random variable "
                                },
                                {
                                    "bbox": [
                                        104,
                                        619,
                                        530,
                                        660
                                    ],
                                    "type": "inline_equation",
                                    "content": "X"
                                },
                                {
                                    "bbox": [
                                        104,
                                        619,
                                        530,
                                        660
                                    ],
                                    "type": "text",
                                    "content": " is the expected value of the deviation from its mean "
                                },
                                {
                                    "bbox": [
                                        104,
                                        619,
                                        530,
                                        660
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\bar{X}"
                                },
                                {
                                    "bbox": [
                                        104,
                                        619,
                                        530,
                                        660
                                    ],
                                    "type": "text",
                                    "content": ", which can be written"
                                }
                            ]
                        }
                    ],
                    "index": 4
                },
                {
                    "bbox": [
                        132,
                        676,
                        440,
                        698
                    ],
                    "type": "interline_equation",
                    "lines": [
                        {
                            "bbox": [
                                132,
                                676,
                                440,
                                698
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        132,
                                        676,
                                        440,
                                        698
                                    ],
                                    "type": "interline_equation",
                                    "content": "\\operatorname {Var}[X]\\doteq \\mathbb{E}\\Big[\\big(X - \\bar{X}\\big)^2\\Big] = \\mathbb{E}\\big[X^2 -2X\\bar{X} +\\bar{X}^2\\big] = \\mathbb{E}\\big[X^2\\big] - \\bar{X}^2.",
                                    "image_path": "356d183785555be9b6e907873d87f6ba31b479d00f685447dae26bf0c0e29751.jpg"
                                }
                            ]
                        }
                    ],
                    "index": 5
                },
                {
                    "bbox": [
                        104,
                        713,
                        530,
                        740
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                104,
                                713,
                                530,
                                740
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        104,
                                        713,
                                        530,
                                        740
                                    ],
                                    "type": "text",
                                    "content": "Thus, if the mean is finite, as it is in our case, the variance is infinite if and only if the expectation of the square of the random variable is infinite. Thus, we need only show"
                                }
                            ]
                        }
                    ],
                    "index": 6
                }
            ],
            "discarded_blocks": [],
            "page_size": [
                595,
                842
            ],
            "page_idx": 16
        },
        {
            "para_blocks": [
                {
                    "bbox": [
                        63,
                        140,
                        440,
                        154
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                63,
                                140,
                                440,
                                154
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        63,
                                        140,
                                        440,
                                        154
                                    ],
                                    "type": "text",
                                    "content": "that the expected square of the importance- sampling- scaled return is infinite:"
                                }
                            ]
                        }
                    ],
                    "index": 0
                },
                {
                    "bbox": [
                        92,
                        174,
                        220,
                        216
                    ],
                    "type": "interline_equation",
                    "lines": [
                        {
                            "bbox": [
                                92,
                                174,
                                220,
                                216
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        92,
                                        174,
                                        220,
                                        216
                                    ],
                                    "type": "interline_equation",
                                    "content": "\\mathbb{E}\\left[\\left(\\prod_{t = 0}^{T - 1}\\frac{\\pi(A_t|S_t)}{b(A_t|S_t)} G_0\\right)^2\\right].",
                                    "image_path": "a4c5eeccee10604a93802163c6166b6b89ba6937b9651369c4784229a9881b30.jpg"
                                }
                            ]
                        }
                    ],
                    "index": 1
                },
                {
                    "bbox": [
                        63,
                        233,
                        490,
                        367
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                63,
                                233,
                                490,
                                367
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        63,
                                        233,
                                        490,
                                        367
                                    ],
                                    "type": "text",
                                    "content": "To compute this expectation, we break it down into cases based on episode length and termination. First note that, for any episode ending with the right action, the importance sampling ratio is zero, because the target policy would never take this action; these episodes thus contribute nothing to the expectation (the quantity in parenthesis will be zero) and can be ignored. We need only consider episodes that involve some number (possibly zero) of left actions that transition back to the nonterminal state, followed by a left action transitioning to termination. All of these episodes have a return of 1, so the "
                                },
                                {
                                    "bbox": [
                                        63,
                                        233,
                                        490,
                                        367
                                    ],
                                    "type": "inline_equation",
                                    "content": "G_{0}"
                                },
                                {
                                    "bbox": [
                                        63,
                                        233,
                                        490,
                                        367
                                    ],
                                    "type": "text",
                                    "content": " factor can be ignored. To get the expected square we need only consider each length of episode, multiplying the probability of the episode's occurrence by the square of its importance- sampling ratio, and add these up:"
                                }
                            ]
                        }
                    ],
                    "index": 2
                },
                {
                    "bbox": [
                        89,
                        385,
                        297,
                        540
                    ],
                    "type": "interline_equation",
                    "lines": [
                        {
                            "bbox": [
                                89,
                                385,
                                297,
                                540
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        89,
                                        385,
                                        297,
                                        540
                                    ],
                                    "type": "interline_equation",
                                    "content": "\\begin{array}{l}{{=\\frac{1}{2}\\cdot0.1\\left(\\frac{1}{0.5}\\right)^{2}}}\\\\ {{+\\frac{1}{2}\\cdot0.9\\cdot\\frac{1}{2}\\cdot0.1\\left(\\frac{1}{0.5}\\frac{1}{0.5}\\right)^{2}}}\\\\ {{+\\frac{1}{2}\\cdot0.9\\cdot\\frac{1}{2}\\cdot0.9\\cdot\\frac{1}{2}\\cdot0.1\\left(\\frac{1}{0.5}\\frac{1}{0.5}\\frac{1}{0.5}\\right)^{2}}}\\\\ {{+\\cdots}}\\\\ {{=0.1\\sum_{k=0}^{\\infty}0.9^{k}\\cdot2^{k}\\cdot2=0.2\\sum_{k=0}^{\\infty}1.8^{k}=\\infty.}}\\end{array}",
                                    "image_path": "07e88bcea8ecb2f7c6a8ab2ebcfb2e55095724050efd290d4926951335a26920.jpg"
                                }
                            ]
                        }
                    ],
                    "index": 3
                },
                {
                    "bbox": [
                        64,
                        566,
                        490,
                        594
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                64,
                                566,
                                490,
                                594
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        64,
                                        566,
                                        490,
                                        594
                                    ],
                                    "type": "text",
                                    "content": "Exercise 5.6 What is the equation analogous to (5.6) for action values "
                                },
                                {
                                    "bbox": [
                                        64,
                                        566,
                                        490,
                                        594
                                    ],
                                    "type": "inline_equation",
                                    "content": "Q(s,a)"
                                },
                                {
                                    "bbox": [
                                        64,
                                        566,
                                        490,
                                        594
                                    ],
                                    "type": "text",
                                    "content": " instead of state values "
                                },
                                {
                                    "bbox": [
                                        64,
                                        566,
                                        490,
                                        594
                                    ],
                                    "type": "inline_equation",
                                    "content": "V(s)"
                                },
                                {
                                    "bbox": [
                                        64,
                                        566,
                                        490,
                                        594
                                    ],
                                    "type": "text",
                                    "content": ", again given returns generated using "
                                },
                                {
                                    "bbox": [
                                        64,
                                        566,
                                        490,
                                        594
                                    ],
                                    "type": "inline_equation",
                                    "content": "b"
                                },
                                {
                                    "bbox": [
                                        64,
                                        566,
                                        490,
                                        594
                                    ],
                                    "type": "text",
                                    "content": "?"
                                }
                            ]
                        }
                    ],
                    "index": 4
                },
                {
                    "bbox": [
                        64,
                        602,
                        490,
                        656
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                64,
                                602,
                                490,
                                656
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        64,
                                        602,
                                        490,
                                        656
                                    ],
                                    "type": "text",
                                    "content": "Exercise 5.7 In learning curves such as those shown in Figure 5.3 error generally decreases with training, as indeed happened for the ordinary importance- sampling method. But for the weighted importance- sampling method error first increased and then decreased. Why do you think this happened?"
                                }
                            ]
                        }
                    ],
                    "index": 5
                },
                {
                    "bbox": [
                        64,
                        665,
                        490,
                        705
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                64,
                                665,
                                490,
                                705
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        64,
                                        665,
                                        490,
                                        705
                                    ],
                                    "type": "text",
                                    "content": "Exercise 5.8 The results with Example 5.5 and shown in Figure 5.4 used a first- visit MC method. Suppose that instead an every- visit MC method was used on the same problem. Would the variance of the estimator still be infinite? Why or why not?"
                                }
                            ]
                        }
                    ],
                    "index": 6
                }
            ],
            "discarded_blocks": [],
            "page_size": [
                595,
                842
            ],
            "page_idx": 17
        },
        {
            "para_blocks": [
                {
                    "bbox": [
                        104,
                        137,
                        369,
                        154
                    ],
                    "type": "title",
                    "lines": [
                        {
                            "bbox": [
                                104,
                                137,
                                369,
                                154
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        104,
                                        137,
                                        369,
                                        154
                                    ],
                                    "type": "text",
                                    "content": "5.6 Incremental Implementation"
                                }
                            ]
                        }
                    ],
                    "index": 0,
                    "level": 1
                },
                {
                    "bbox": [
                        104,
                        166,
                        531,
                        261
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                104,
                                166,
                                531,
                                261
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        104,
                                        166,
                                        531,
                                        261
                                    ],
                                    "type": "text",
                                    "content": "Monte Carlo prediction methods can be implemented incrementally, on an episode- byepisode basis, using extensions of the techniques described in Chapter 2 (Section 2.4). Whereas in Chapter 2 we averaged rewards, in Monte Carlo methods we average returns. In all other respects exactly the same methods as used in Chapter 2 can be used for onpolicy Monte Carlo methods. For off- policy Monte Carlo methods, we need to separately consider those that use ordinary importance sampling and those that use weighted importance sampling."
                                }
                            ]
                        }
                    ],
                    "index": 1
                },
                {
                    "bbox": [
                        104,
                        261,
                        530,
                        341
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                104,
                                261,
                                530,
                                341
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        104,
                                        261,
                                        530,
                                        341
                                    ],
                                    "type": "text",
                                    "content": "In ordinary importance sampling, the returns are scaled by the importance sampling ratio "
                                },
                                {
                                    "bbox": [
                                        104,
                                        261,
                                        530,
                                        341
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\rho_{t:T(t) - 1}"
                                },
                                {
                                    "bbox": [
                                        104,
                                        261,
                                        530,
                                        341
                                    ],
                                    "type": "text",
                                    "content": " (5.3), then simply averaged, as in (5.5). For these methods we can again use the incremental methods of Chapter 2, but using the scaled returns in place of the rewards of that chapter. This leaves the case of off- policy methods using weighted importance sampling. Here we have to form a weighted average of the returns, and a slightly different incremental algorithm is required."
                                }
                            ]
                        }
                    ],
                    "index": 2
                },
                {
                    "bbox": [
                        104,
                        342,
                        530,
                        381
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                104,
                                342,
                                530,
                                381
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        104,
                                        342,
                                        530,
                                        381
                                    ],
                                    "type": "text",
                                    "content": "Suppose we have a sequence of returns "
                                },
                                {
                                    "bbox": [
                                        104,
                                        342,
                                        530,
                                        381
                                    ],
                                    "type": "inline_equation",
                                    "content": "G_{1},G_{2},\\ldots ,G_{n - 1}"
                                },
                                {
                                    "bbox": [
                                        104,
                                        342,
                                        530,
                                        381
                                    ],
                                    "type": "text",
                                    "content": " , all starting in the same state and each with a corresponding random weight "
                                },
                                {
                                    "bbox": [
                                        104,
                                        342,
                                        530,
                                        381
                                    ],
                                    "type": "inline_equation",
                                    "content": "W_{i}"
                                },
                                {
                                    "bbox": [
                                        104,
                                        342,
                                        530,
                                        381
                                    ],
                                    "type": "text",
                                    "content": " (e.g., "
                                },
                                {
                                    "bbox": [
                                        104,
                                        342,
                                        530,
                                        381
                                    ],
                                    "type": "inline_equation",
                                    "content": "W_{i} = \\rho_{t_{i}:T(t_{i}) - 1})"
                                },
                                {
                                    "bbox": [
                                        104,
                                        342,
                                        530,
                                        381
                                    ],
                                    "type": "text",
                                    "content": " . We wish to form the estimate"
                                }
                            ]
                        }
                    ],
                    "index": 3
                },
                {
                    "bbox": [
                        131,
                        391,
                        528,
                        426
                    ],
                    "type": "interline_equation",
                    "lines": [
                        {
                            "bbox": [
                                131,
                                391,
                                528,
                                426
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        131,
                                        391,
                                        528,
                                        426
                                    ],
                                    "type": "interline_equation",
                                    "content": "V_{n}\\doteq \\frac{\\sum_{k = 1}^{n - 1}W_{k}G_{k}}{\\sum_{k = 1}^{n - 1}W_{k}},\\qquad n\\geq 2, \\tag{5.7}",
                                    "image_path": "8e5021662d462bcb2980959ed5856391e5e83fd733b3a1aae69e2f42acc669b4.jpg"
                                }
                            ]
                        }
                    ],
                    "index": 4
                },
                {
                    "bbox": [
                        104,
                        436,
                        530,
                        477
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                104,
                                436,
                                530,
                                477
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        104,
                                        436,
                                        530,
                                        477
                                    ],
                                    "type": "text",
                                    "content": "and keep it up- to- date as we obtain a single additional return "
                                },
                                {
                                    "bbox": [
                                        104,
                                        436,
                                        530,
                                        477
                                    ],
                                    "type": "inline_equation",
                                    "content": "G_{n}"
                                },
                                {
                                    "bbox": [
                                        104,
                                        436,
                                        530,
                                        477
                                    ],
                                    "type": "text",
                                    "content": " . In addition to keeping track of "
                                },
                                {
                                    "bbox": [
                                        104,
                                        436,
                                        530,
                                        477
                                    ],
                                    "type": "inline_equation",
                                    "content": "V_{n}"
                                },
                                {
                                    "bbox": [
                                        104,
                                        436,
                                        530,
                                        477
                                    ],
                                    "type": "text",
                                    "content": " , we must maintain for each state the cumulative sum "
                                },
                                {
                                    "bbox": [
                                        104,
                                        436,
                                        530,
                                        477
                                    ],
                                    "type": "inline_equation",
                                    "content": "C_{n}"
                                },
                                {
                                    "bbox": [
                                        104,
                                        436,
                                        530,
                                        477
                                    ],
                                    "type": "text",
                                    "content": " of the weights given to the first "
                                },
                                {
                                    "bbox": [
                                        104,
                                        436,
                                        530,
                                        477
                                    ],
                                    "type": "inline_equation",
                                    "content": "n"
                                },
                                {
                                    "bbox": [
                                        104,
                                        436,
                                        530,
                                        477
                                    ],
                                    "type": "text",
                                    "content": " returns. The update rule for "
                                },
                                {
                                    "bbox": [
                                        104,
                                        436,
                                        530,
                                        477
                                    ],
                                    "type": "inline_equation",
                                    "content": "V_{n}"
                                },
                                {
                                    "bbox": [
                                        104,
                                        436,
                                        530,
                                        477
                                    ],
                                    "type": "text",
                                    "content": " is"
                                }
                            ]
                        }
                    ],
                    "index": 5
                },
                {
                    "bbox": [
                        131,
                        488,
                        528,
                        516
                    ],
                    "type": "interline_equation",
                    "lines": [
                        {
                            "bbox": [
                                131,
                                488,
                                528,
                                516
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        131,
                                        488,
                                        528,
                                        516
                                    ],
                                    "type": "interline_equation",
                                    "content": "V_{n + 1}\\doteq V_{n} + \\frac{W_{n}}{C_{n}}\\Big[G_{n} - V_{n}\\Big],\\qquad n\\geq 1, \\tag{5.8}",
                                    "image_path": "909d970589b6010e4d6d8401811c9deaa64e000b9a749b488801305b934d8597.jpg"
                                }
                            ]
                        }
                    ],
                    "index": 6
                },
                {
                    "bbox": [
                        104,
                        528,
                        124,
                        540
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                104,
                                528,
                                124,
                                540
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        104,
                                        528,
                                        124,
                                        540
                                    ],
                                    "type": "text",
                                    "content": "and"
                                }
                            ]
                        }
                    ],
                    "index": 7
                },
                {
                    "bbox": [
                        133,
                        556,
                        230,
                        569
                    ],
                    "type": "interline_equation",
                    "lines": [
                        {
                            "bbox": [
                                133,
                                556,
                                230,
                                569
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        133,
                                        556,
                                        230,
                                        569
                                    ],
                                    "type": "interline_equation",
                                    "content": "C_{n + 1}\\doteq C_{n} + W_{n + 1},",
                                    "image_path": "08952403b1d97625e14be2355ba7c0af242e6616ff03bd1b0c4642a4776da127.jpg"
                                }
                            ]
                        }
                    ],
                    "index": 8
                },
                {
                    "bbox": [
                        104,
                        581,
                        530,
                        676
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                104,
                                581,
                                530,
                                676
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        104,
                                        581,
                                        530,
                                        676
                                    ],
                                    "type": "text",
                                    "content": "where "
                                },
                                {
                                    "bbox": [
                                        104,
                                        581,
                                        530,
                                        676
                                    ],
                                    "type": "inline_equation",
                                    "content": "C_0\\stackrel {\\cdot}{=}0"
                                },
                                {
                                    "bbox": [
                                        104,
                                        581,
                                        530,
                                        676
                                    ],
                                    "type": "text",
                                    "content": " (and "
                                },
                                {
                                    "bbox": [
                                        104,
                                        581,
                                        530,
                                        676
                                    ],
                                    "type": "inline_equation",
                                    "content": "V_{1}"
                                },
                                {
                                    "bbox": [
                                        104,
                                        581,
                                        530,
                                        676
                                    ],
                                    "type": "text",
                                    "content": " is arbitrary and thus need not be specified). The box on the next page contains a complete episode- by- episode incremental algorithm for Monte Carlo policy evaluation. The algorithm is nominally for the off- policy case, using weighted importance sampling, but applies as well to the on- policy case just by choosing the target and behavior policies as the same (in which case ( "
                                },
                                {
                                    "bbox": [
                                        104,
                                        581,
                                        530,
                                        676
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\pi = b"
                                },
                                {
                                    "bbox": [
                                        104,
                                        581,
                                        530,
                                        676
                                    ],
                                    "type": "text",
                                    "content": " ), "
                                },
                                {
                                    "bbox": [
                                        104,
                                        581,
                                        530,
                                        676
                                    ],
                                    "type": "inline_equation",
                                    "content": "W"
                                },
                                {
                                    "bbox": [
                                        104,
                                        581,
                                        530,
                                        676
                                    ],
                                    "type": "text",
                                    "content": " is always 1). The approximation "
                                },
                                {
                                    "bbox": [
                                        104,
                                        581,
                                        530,
                                        676
                                    ],
                                    "type": "inline_equation",
                                    "content": "Q"
                                },
                                {
                                    "bbox": [
                                        104,
                                        581,
                                        530,
                                        676
                                    ],
                                    "type": "text",
                                    "content": " converges to "
                                },
                                {
                                    "bbox": [
                                        104,
                                        581,
                                        530,
                                        676
                                    ],
                                    "type": "inline_equation",
                                    "content": "q_{\\pi}"
                                },
                                {
                                    "bbox": [
                                        104,
                                        581,
                                        530,
                                        676
                                    ],
                                    "type": "text",
                                    "content": " (for all encountered state- action pairs) while actions are selected according to a potentially different policy, "
                                },
                                {
                                    "bbox": [
                                        104,
                                        581,
                                        530,
                                        676
                                    ],
                                    "type": "inline_equation",
                                    "content": "b"
                                },
                                {
                                    "bbox": [
                                        104,
                                        581,
                                        530,
                                        676
                                    ],
                                    "type": "text",
                                    "content": " ."
                                }
                            ]
                        }
                    ],
                    "index": 9
                },
                {
                    "bbox": [
                        104,
                        681,
                        530,
                        708
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                104,
                                681,
                                530,
                                708
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        104,
                                        681,
                                        530,
                                        708
                                    ],
                                    "type": "text",
                                    "content": "Exercise 5.9 Modify the algorithm for first- visit MC policy evaluation (Section 5.1) to use the incremental implementation for sample averages described in Section 2.4."
                                }
                            ]
                        }
                    ],
                    "index": 10
                },
                {
                    "bbox": [
                        104,
                        713,
                        530,
                        740
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                104,
                                713,
                                530,
                                740
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        104,
                                        713,
                                        530,
                                        740
                                    ],
                                    "type": "text",
                                    "content": "Exercise 5.10 Derive the weighted- average update rule (5.8) from (5.7). Follow the pattern of the derivation of the unweighted rule (2.3)."
                                }
                            ]
                        }
                    ],
                    "index": 11
                }
            ],
            "discarded_blocks": [],
            "page_size": [
                595,
                842
            ],
            "page_idx": 18
        },
        {
            "para_blocks": [
                {
                    "bbox": [
                        76,
                        140,
                        448,
                        154
                    ],
                    "type": "title",
                    "lines": [
                        {
                            "bbox": [
                                76,
                                140,
                                448,
                                154
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        76,
                                        140,
                                        448,
                                        154
                                    ],
                                    "type": "text",
                                    "content": "Off-policy MC prediction (policy evaluation) for estimating "
                                },
                                {
                                    "bbox": [
                                        76,
                                        140,
                                        448,
                                        154
                                    ],
                                    "type": "inline_equation",
                                    "content": "Q \\approx q_{\\pi}"
                                }
                            ]
                        }
                    ],
                    "index": 0,
                    "level": 1
                },
                {
                    "bbox": [
                        77,
                        164,
                        248,
                        177
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                77,
                                164,
                                248,
                                177
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        77,
                                        164,
                                        248,
                                        177
                                    ],
                                    "type": "text",
                                    "content": "Input: an arbitrary target policy "
                                },
                                {
                                    "bbox": [
                                        77,
                                        164,
                                        248,
                                        177
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\pi"
                                }
                            ]
                        }
                    ],
                    "index": 1
                },
                {
                    "bbox": [
                        78,
                        178,
                        238,
                        190
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                78,
                                178,
                                238,
                                190
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        78,
                                        178,
                                        238,
                                        190
                                    ],
                                    "type": "text",
                                    "content": "Initialize, for all "
                                },
                                {
                                    "bbox": [
                                        78,
                                        178,
                                        238,
                                        190
                                    ],
                                    "type": "inline_equation",
                                    "content": "s \\in \\mathcal{S}"
                                },
                                {
                                    "bbox": [
                                        78,
                                        178,
                                        238,
                                        190
                                    ],
                                    "type": "text",
                                    "content": ", "
                                },
                                {
                                    "bbox": [
                                        78,
                                        178,
                                        238,
                                        190
                                    ],
                                    "type": "inline_equation",
                                    "content": "a \\in \\mathcal{A}(s)"
                                },
                                {
                                    "bbox": [
                                        78,
                                        178,
                                        238,
                                        190
                                    ],
                                    "type": "text",
                                    "content": ":"
                                }
                            ]
                        }
                    ],
                    "index": 2
                },
                {
                    "bbox": [
                        97,
                        191,
                        214,
                        204
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                97,
                                191,
                                214,
                                204
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        97,
                                        191,
                                        214,
                                        204
                                    ],
                                    "type": "inline_equation",
                                    "content": "Q(s, a) \\in \\mathbb{R}"
                                },
                                {
                                    "bbox": [
                                        97,
                                        191,
                                        214,
                                        204
                                    ],
                                    "type": "text",
                                    "content": " (arbitrarily)"
                                }
                            ]
                        }
                    ],
                    "index": 3
                },
                {
                    "bbox": [
                        97,
                        205,
                        155,
                        218
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                97,
                                205,
                                155,
                                218
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        97,
                                        205,
                                        155,
                                        218
                                    ],
                                    "type": "inline_equation",
                                    "content": "C(s, a) \\leftarrow 0"
                                }
                            ]
                        }
                    ],
                    "index": 4
                },
                {
                    "bbox": [
                        77,
                        224,
                        233,
                        236
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                77,
                                224,
                                233,
                                236
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        77,
                                        224,
                                        233,
                                        236
                                    ],
                                    "type": "text",
                                    "content": "Loop forever (for each episode):"
                                }
                            ]
                        }
                    ],
                    "index": 5
                },
                {
                    "bbox": [
                        96,
                        238,
                        263,
                        250
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                96,
                                238,
                                263,
                                250
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        96,
                                        238,
                                        263,
                                        250
                                    ],
                                    "type": "inline_equation",
                                    "content": "b \\leftarrow"
                                },
                                {
                                    "bbox": [
                                        96,
                                        238,
                                        263,
                                        250
                                    ],
                                    "type": "text",
                                    "content": " any policy with coverage of "
                                },
                                {
                                    "bbox": [
                                        96,
                                        238,
                                        263,
                                        250
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\pi"
                                }
                            ]
                        }
                    ],
                    "index": 6
                },
                {
                    "bbox": [
                        96,
                        251,
                        408,
                        263
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                96,
                                251,
                                408,
                                263
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        96,
                                        251,
                                        408,
                                        263
                                    ],
                                    "type": "text",
                                    "content": "Generate an episode following "
                                },
                                {
                                    "bbox": [
                                        96,
                                        251,
                                        408,
                                        263
                                    ],
                                    "type": "inline_equation",
                                    "content": "b"
                                },
                                {
                                    "bbox": [
                                        96,
                                        251,
                                        408,
                                        263
                                    ],
                                    "type": "text",
                                    "content": ": "
                                },
                                {
                                    "bbox": [
                                        96,
                                        251,
                                        408,
                                        263
                                    ],
                                    "type": "inline_equation",
                                    "content": "S_{0}, A_{0}, R_{1}, \\ldots , S_{T - 1}, A_{T - 1}, R_{T}"
                                }
                            ]
                        }
                    ],
                    "index": 7
                },
                {
                    "bbox": [
                        97,
                        265,
                        129,
                        275
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                97,
                                265,
                                129,
                                275
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        97,
                                        265,
                                        129,
                                        275
                                    ],
                                    "type": "inline_equation",
                                    "content": "G \\leftarrow 0"
                                }
                            ]
                        }
                    ],
                    "index": 8
                },
                {
                    "bbox": [
                        97,
                        277,
                        132,
                        288
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                97,
                                277,
                                132,
                                288
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        97,
                                        277,
                                        132,
                                        288
                                    ],
                                    "type": "inline_equation",
                                    "content": "W \\leftarrow 1"
                                }
                            ]
                        }
                    ],
                    "index": 9
                },
                {
                    "bbox": [
                        96,
                        291,
                        418,
                        303
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                96,
                                291,
                                418,
                                303
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        96,
                                        291,
                                        418,
                                        303
                                    ],
                                    "type": "text",
                                    "content": "Loop for each step of episode, "
                                },
                                {
                                    "bbox": [
                                        96,
                                        291,
                                        418,
                                        303
                                    ],
                                    "type": "inline_equation",
                                    "content": "t = T - 1, T - 2, \\ldots , 0"
                                },
                                {
                                    "bbox": [
                                        96,
                                        291,
                                        418,
                                        303
                                    ],
                                    "type": "text",
                                    "content": ", while "
                                },
                                {
                                    "bbox": [
                                        96,
                                        291,
                                        418,
                                        303
                                    ],
                                    "type": "inline_equation",
                                    "content": "W \\neq 0"
                                },
                                {
                                    "bbox": [
                                        96,
                                        291,
                                        418,
                                        303
                                    ],
                                    "type": "text",
                                    "content": ":"
                                }
                            ]
                        }
                    ],
                    "index": 10
                },
                {
                    "bbox": [
                        115,
                        304,
                        194,
                        316
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                115,
                                304,
                                194,
                                316
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        115,
                                        304,
                                        194,
                                        316
                                    ],
                                    "type": "inline_equation",
                                    "content": "G \\leftarrow \\gamma G + R_{t + 1}"
                                }
                            ]
                        }
                    ],
                    "index": 11
                },
                {
                    "bbox": [
                        115,
                        317,
                        351,
                        330
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                115,
                                317,
                                351,
                                330
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        115,
                                        317,
                                        351,
                                        330
                                    ],
                                    "type": "inline_equation",
                                    "content": "C(S_{t}, A_{t}) \\leftarrow C(S_{t}, A_{t}) + W"
                                }
                            ]
                        }
                    ],
                    "index": 12
                },
                {
                    "bbox": [
                        115,
                        330,
                        351,
                        346
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                115,
                                330,
                                351,
                                346
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        115,
                                        330,
                                        351,
                                        346
                                    ],
                                    "type": "inline_equation",
                                    "content": "Q(S_{t}, A_{t}) \\leftarrow Q(S_{t}, A_{t}) + \\frac{W}{C(S_{t}, A_{t})} [G - Q(S_{t}, A_{t})]"
                                }
                            ]
                        }
                    ],
                    "index": 13
                },
                {
                    "bbox": [
                        115,
                        346,
                        194,
                        361
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                115,
                                346,
                                194,
                                361
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        115,
                                        346,
                                        194,
                                        361
                                    ],
                                    "type": "inline_equation",
                                    "content": "W \\leftarrow W \\frac{\\pi(A_{t} | S_{t})}{b(A_{t} | S_{t})}"
                                }
                            ]
                        }
                    ],
                    "index": 14
                },
                {
                    "bbox": [
                        64,
                        409,
                        354,
                        426
                    ],
                    "type": "title",
                    "lines": [
                        {
                            "bbox": [
                                64,
                                409,
                                354,
                                426
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        64,
                                        409,
                                        354,
                                        426
                                    ],
                                    "type": "text",
                                    "content": "5.7 Off-policy Monte Carlo Control"
                                }
                            ]
                        }
                    ],
                    "index": 15,
                    "level": 1
                },
                {
                    "bbox": [
                        64,
                        446,
                        489,
                        552
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                64,
                                446,
                                489,
                                552
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        64,
                                        446,
                                        489,
                                        552
                                    ],
                                    "type": "text",
                                    "content": "We are now ready to present an example of the second class of learning control methods we consider in this book: off- policy methods. Recall that the distinguishing feature of on- policy methods is that they estimate the value of a policy while using it for control. In off- policy methods these two functions are separated. The policy used to generate behavior, called the behavior policy, may in fact be unrelated to the policy that is evaluated and improved, called the target policy. An advantage of this separation is that the target policy may be deterministic (e.g., greedy), while the behavior policy can continue to sample all possible actions."
                                }
                            ]
                        }
                    ],
                    "index": 16
                },
                {
                    "bbox": [
                        64,
                        554,
                        489,
                        633
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                64,
                                554,
                                489,
                                633
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        64,
                                        554,
                                        489,
                                        633
                                    ],
                                    "type": "text",
                                    "content": "Off- policy Monte Carlo control methods use one of the techniques presented in the preceding two sections. They follow the behavior policy while learning about and improving the target policy. These techniques require that the behavior policy has a nonzero probability of selecting all actions that might be selected by the target policy (coverage). To explore all possibilities, we require that the behavior policy be soft (i.e., that it select all actions in all states with nonzero probability)."
                                }
                            ]
                        }
                    ],
                    "index": 17
                },
                {
                    "bbox": [
                        64,
                        634,
                        489,
                        740
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                64,
                                634,
                                489,
                                740
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        64,
                                        634,
                                        489,
                                        740
                                    ],
                                    "type": "text",
                                    "content": "The box on the next page shows an off- policy Monte Carlo control method, based on GPI and weighted importance sampling, for estimating "
                                },
                                {
                                    "bbox": [
                                        64,
                                        634,
                                        489,
                                        740
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\pi_{*}"
                                },
                                {
                                    "bbox": [
                                        64,
                                        634,
                                        489,
                                        740
                                    ],
                                    "type": "text",
                                    "content": " and "
                                },
                                {
                                    "bbox": [
                                        64,
                                        634,
                                        489,
                                        740
                                    ],
                                    "type": "inline_equation",
                                    "content": "q_{*}"
                                },
                                {
                                    "bbox": [
                                        64,
                                        634,
                                        489,
                                        740
                                    ],
                                    "type": "text",
                                    "content": ". The target policy "
                                },
                                {
                                    "bbox": [
                                        64,
                                        634,
                                        489,
                                        740
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\pi \\approx \\pi_{*}"
                                },
                                {
                                    "bbox": [
                                        64,
                                        634,
                                        489,
                                        740
                                    ],
                                    "type": "text",
                                    "content": " is the greedy policy with respect to "
                                },
                                {
                                    "bbox": [
                                        64,
                                        634,
                                        489,
                                        740
                                    ],
                                    "type": "inline_equation",
                                    "content": "Q"
                                },
                                {
                                    "bbox": [
                                        64,
                                        634,
                                        489,
                                        740
                                    ],
                                    "type": "text",
                                    "content": ", which is an estimate of "
                                },
                                {
                                    "bbox": [
                                        64,
                                        634,
                                        489,
                                        740
                                    ],
                                    "type": "inline_equation",
                                    "content": "q_{\\pi}"
                                },
                                {
                                    "bbox": [
                                        64,
                                        634,
                                        489,
                                        740
                                    ],
                                    "type": "text",
                                    "content": ". The behavior policy "
                                },
                                {
                                    "bbox": [
                                        64,
                                        634,
                                        489,
                                        740
                                    ],
                                    "type": "inline_equation",
                                    "content": "b"
                                },
                                {
                                    "bbox": [
                                        64,
                                        634,
                                        489,
                                        740
                                    ],
                                    "type": "text",
                                    "content": " can be anything, but in order to assure convergence of "
                                },
                                {
                                    "bbox": [
                                        64,
                                        634,
                                        489,
                                        740
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\pi"
                                },
                                {
                                    "bbox": [
                                        64,
                                        634,
                                        489,
                                        740
                                    ],
                                    "type": "text",
                                    "content": " to the optimal policy, an infinite number of returns must be obtained for each pair of state and action. This can be assured by choosing "
                                },
                                {
                                    "bbox": [
                                        64,
                                        634,
                                        489,
                                        740
                                    ],
                                    "type": "inline_equation",
                                    "content": "b"
                                },
                                {
                                    "bbox": [
                                        64,
                                        634,
                                        489,
                                        740
                                    ],
                                    "type": "text",
                                    "content": " to be "
                                },
                                {
                                    "bbox": [
                                        64,
                                        634,
                                        489,
                                        740
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\epsilon"
                                },
                                {
                                    "bbox": [
                                        64,
                                        634,
                                        489,
                                        740
                                    ],
                                    "type": "text",
                                    "content": "- soft. The policy "
                                },
                                {
                                    "bbox": [
                                        64,
                                        634,
                                        489,
                                        740
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\pi"
                                },
                                {
                                    "bbox": [
                                        64,
                                        634,
                                        489,
                                        740
                                    ],
                                    "type": "text",
                                    "content": " converges to optimal at all encountered states even though actions are selected according to a different soft policy "
                                },
                                {
                                    "bbox": [
                                        64,
                                        634,
                                        489,
                                        740
                                    ],
                                    "type": "inline_equation",
                                    "content": "b"
                                },
                                {
                                    "bbox": [
                                        64,
                                        634,
                                        489,
                                        740
                                    ],
                                    "type": "text",
                                    "content": ", which may change between or even within episodes."
                                }
                            ]
                        }
                    ],
                    "index": 18
                }
            ],
            "discarded_blocks": [],
            "page_size": [
                595,
                842
            ],
            "page_idx": 19
        },
        {
            "para_blocks": [
                {
                    "bbox": [
                        117,
                        132,
                        365,
                        145
                    ],
                    "type": "title",
                    "lines": [
                        {
                            "bbox": [
                                117,
                                132,
                                365,
                                145
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        117,
                                        132,
                                        365,
                                        145
                                    ],
                                    "type": "text",
                                    "content": "Off-policy MC control, for estimating "
                                },
                                {
                                    "bbox": [
                                        117,
                                        132,
                                        365,
                                        145
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\pi \\approx \\pi_{*}"
                                }
                            ]
                        }
                    ],
                    "index": 0,
                    "level": 1
                },
                {
                    "bbox": [
                        117,
                        154,
                        277,
                        167
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                117,
                                154,
                                277,
                                167
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        117,
                                        154,
                                        277,
                                        167
                                    ],
                                    "type": "text",
                                    "content": "Initialize, for all "
                                },
                                {
                                    "bbox": [
                                        117,
                                        154,
                                        277,
                                        167
                                    ],
                                    "type": "inline_equation",
                                    "content": "s\\in S"
                                },
                                {
                                    "bbox": [
                                        117,
                                        154,
                                        277,
                                        167
                                    ],
                                    "type": "inline_equation",
                                    "content": "a\\in \\mathcal{A}(s)"
                                }
                            ]
                        }
                    ],
                    "index": 1
                },
                {
                    "bbox": [
                        137,
                        168,
                        255,
                        181
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                137,
                                168,
                                255,
                                181
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        137,
                                        168,
                                        255,
                                        181
                                    ],
                                    "type": "inline_equation",
                                    "content": "Q(s,a)\\in \\mathbb{R}"
                                },
                                {
                                    "bbox": [
                                        137,
                                        168,
                                        255,
                                        181
                                    ],
                                    "type": "text",
                                    "content": " (arbitrarily)"
                                }
                            ]
                        }
                    ],
                    "index": 2
                },
                {
                    "bbox": [
                        137,
                        183,
                        195,
                        194
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                137,
                                183,
                                195,
                                194
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        137,
                                        183,
                                        195,
                                        194
                                    ],
                                    "type": "inline_equation",
                                    "content": "C(s,a)\\leftarrow 0"
                                }
                            ]
                        }
                    ],
                    "index": 3
                },
                {
                    "bbox": [
                        137,
                        196,
                        415,
                        209
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                137,
                                196,
                                415,
                                209
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        137,
                                        196,
                                        415,
                                        209
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\pi (s)\\leftarrow \\arg \\max_{a}Q(s,a)"
                                },
                                {
                                    "bbox": [
                                        137,
                                        196,
                                        415,
                                        209
                                    ],
                                    "type": "text",
                                    "content": " (with ties broken consistently)"
                                }
                            ]
                        }
                    ],
                    "index": 4
                },
                {
                    "bbox": [
                        117,
                        214,
                        273,
                        227
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                117,
                                214,
                                273,
                                227
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        117,
                                        214,
                                        273,
                                        227
                                    ],
                                    "type": "text",
                                    "content": "Loop forever (for each episode):"
                                }
                            ]
                        }
                    ],
                    "index": 5
                },
                {
                    "bbox": [
                        137,
                        229,
                        232,
                        240
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                137,
                                229,
                                232,
                                240
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        137,
                                        229,
                                        232,
                                        240
                                    ],
                                    "type": "inline_equation",
                                    "content": "b\\gets"
                                },
                                {
                                    "bbox": [
                                        137,
                                        229,
                                        232,
                                        240
                                    ],
                                    "type": "text",
                                    "content": " any soft policy"
                                }
                            ]
                        }
                    ],
                    "index": 6
                },
                {
                    "bbox": [
                        137,
                        242,
                        431,
                        255
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                137,
                                242,
                                431,
                                255
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        137,
                                        242,
                                        431,
                                        255
                                    ],
                                    "type": "text",
                                    "content": "Generate an episode using "
                                },
                                {
                                    "bbox": [
                                        137,
                                        242,
                                        431,
                                        255
                                    ],
                                    "type": "inline_equation",
                                    "content": "b"
                                },
                                {
                                    "bbox": [
                                        137,
                                        242,
                                        431,
                                        255
                                    ],
                                    "type": "text",
                                    "content": " .. "
                                },
                                {
                                    "bbox": [
                                        137,
                                        242,
                                        431,
                                        255
                                    ],
                                    "type": "inline_equation",
                                    "content": "S_{0},A_{0},R_{1},\\ldots ,S_{T - 1},A_{T - 1},R_{T}"
                                }
                            ]
                        }
                    ],
                    "index": 7
                },
                {
                    "bbox": [
                        137,
                        255,
                        171,
                        266
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                137,
                                255,
                                171,
                                266
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        137,
                                        255,
                                        171,
                                        266
                                    ],
                                    "type": "inline_equation",
                                    "content": "G\\gets 0"
                                }
                            ]
                        }
                    ],
                    "index": 8
                },
                {
                    "bbox": [
                        137,
                        268,
                        173,
                        279
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                137,
                                268,
                                173,
                                279
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        137,
                                        268,
                                        173,
                                        279
                                    ],
                                    "type": "inline_equation",
                                    "content": "W\\gets 1"
                                }
                            ]
                        }
                    ],
                    "index": 9
                },
                {
                    "bbox": [
                        136,
                        282,
                        389,
                        293
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                136,
                                282,
                                389,
                                293
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        136,
                                        282,
                                        389,
                                        293
                                    ],
                                    "type": "text",
                                    "content": "Loop for each step of episode, "
                                },
                                {
                                    "bbox": [
                                        136,
                                        282,
                                        389,
                                        293
                                    ],
                                    "type": "inline_equation",
                                    "content": "t = T - 1,T - 2,\\ldots ,0"
                                }
                            ]
                        }
                    ],
                    "index": 10
                },
                {
                    "bbox": [
                        155,
                        295,
                        233,
                        308
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                155,
                                295,
                                233,
                                308
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        155,
                                        295,
                                        233,
                                        308
                                    ],
                                    "type": "inline_equation",
                                    "content": "G\\gets \\gamma G + R_{t + 1}"
                                }
                            ]
                        }
                    ],
                    "index": 11
                },
                {
                    "bbox": [
                        155,
                        309,
                        289,
                        320
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                155,
                                309,
                                289,
                                320
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        155,
                                        309,
                                        289,
                                        320
                                    ],
                                    "type": "inline_equation",
                                    "content": "C(S_{t},A_{t})\\leftarrow C(S_{t},A_{t}) + W"
                                }
                            ]
                        }
                    ],
                    "index": 12
                },
                {
                    "bbox": [
                        155,
                        321,
                        391,
                        335
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                155,
                                321,
                                391,
                                335
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        155,
                                        321,
                                        391,
                                        335
                                    ],
                                    "type": "inline_equation",
                                    "content": "Q(S_{t},A_{t})\\leftarrow Q(S_{t},A_{t}) + \\frac{W}{C(S_{t},A_{t})}\\left[G - Q(S_{t},A_{t})\\right]"
                                }
                            ]
                        }
                    ],
                    "index": 13
                },
                {
                    "bbox": [
                        155,
                        337,
                        392,
                        349
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                155,
                                337,
                                392,
                                349
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        155,
                                        337,
                                        392,
                                        349
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\pi (S_{t})\\leftarrow \\arg \\max_{a}Q(S_{t},a)"
                                },
                                {
                                    "bbox": [
                                        155,
                                        337,
                                        392,
                                        349
                                    ],
                                    "type": "text",
                                    "content": " (with ties broken consistently)"
                                }
                            ]
                        }
                    ],
                    "index": 14
                },
                {
                    "bbox": [
                        155,
                        350,
                        450,
                        362
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                155,
                                350,
                                450,
                                362
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        155,
                                        350,
                                        450,
                                        362
                                    ],
                                    "type": "text",
                                    "content": "If "
                                },
                                {
                                    "bbox": [
                                        155,
                                        350,
                                        450,
                                        362
                                    ],
                                    "type": "inline_equation",
                                    "content": "A_{t}\\neq \\pi (S_{t})"
                                },
                                {
                                    "bbox": [
                                        155,
                                        350,
                                        450,
                                        362
                                    ],
                                    "type": "text",
                                    "content": " then exit inner Loop (proceed to next episode)"
                                }
                            ]
                        }
                    ],
                    "index": 15
                },
                {
                    "bbox": [
                        155,
                        363,
                        233,
                        378
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                155,
                                363,
                                233,
                                378
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        155,
                                        363,
                                        233,
                                        378
                                    ],
                                    "type": "inline_equation",
                                    "content": "W\\gets W\\overline{b(C(S_{t})}"
                                }
                            ]
                        }
                    ],
                    "index": 16
                },
                {
                    "bbox": [
                        104,
                        415,
                        530,
                        522
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                104,
                                415,
                                530,
                                522
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        104,
                                        415,
                                        530,
                                        522
                                    ],
                                    "type": "text",
                                    "content": "A potential problem is that this method learns only from the tails of episodes, when all of the remaining actions in the episode are greedy. If nongreedy actions are common, then learning will be slow, particularly for states appearing in the early portions of long episodes. Potentially, this could greatly slow learning. There has been insufficient experience with off- policy Monte Carlo methods to assess how serious this problem is. If it is serious, the most important way to address it is probably by incorporating temporal- difference learning, the algorithmic idea developed in the next chapter. Alternatively, if "
                                },
                                {
                                    "bbox": [
                                        104,
                                        415,
                                        530,
                                        522
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\gamma"
                                },
                                {
                                    "bbox": [
                                        104,
                                        415,
                                        530,
                                        522
                                    ],
                                    "type": "text",
                                    "content": " is less than 1, then the idea developed in the next section may also help significantly."
                                }
                            ]
                        }
                    ],
                    "index": 17
                },
                {
                    "bbox": [
                        104,
                        527,
                        530,
                        575
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                104,
                                527,
                                530,
                                575
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        104,
                                        527,
                                        530,
                                        575
                                    ],
                                    "type": "text",
                                    "content": "Exercise 5.11 In the boxed algorithm for off- policy MC control, you may have been expecting the "
                                },
                                {
                                    "bbox": [
                                        104,
                                        527,
                                        530,
                                        575
                                    ],
                                    "type": "inline_equation",
                                    "content": "W"
                                },
                                {
                                    "bbox": [
                                        104,
                                        527,
                                        530,
                                        575
                                    ],
                                    "type": "text",
                                    "content": " update to have involved the importance- sampling ratio "
                                },
                                {
                                    "bbox": [
                                        104,
                                        527,
                                        530,
                                        575
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\frac{\\pi(A_t|S_t)}{b(A_t|S_t)}"
                                },
                                {
                                    "bbox": [
                                        104,
                                        527,
                                        530,
                                        575
                                    ],
                                    "type": "text",
                                    "content": ", but instead it involves "
                                },
                                {
                                    "bbox": [
                                        104,
                                        527,
                                        530,
                                        575
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\frac{1}{b(A_t|S_t)}"
                                },
                                {
                                    "bbox": [
                                        104,
                                        527,
                                        530,
                                        575
                                    ],
                                    "type": "text",
                                    "content": ". Why is this nevertheless correct?"
                                }
                            ]
                        }
                    ],
                    "index": 18
                },
                {
                    "bbox": [
                        104,
                        580,
                        530,
                        740
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                104,
                                580,
                                530,
                                740
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        104,
                                        580,
                                        530,
                                        740
                                    ],
                                    "type": "text",
                                    "content": "Exercise 5.12: Racetrack (programming) Consider driving a race car around a turn like those shown in Figure 5.5. You want to go as fast as possible, but not so fast as to run off the track. In our simplified racetrack, the car is at one of a discrete set of grid positions, the cells in the diagram. The velocity is also discrete, a number of grid cells moved horizontally and vertically per time step. The actions are increments to the velocity components. Each may be changed by "
                                },
                                {
                                    "bbox": [
                                        104,
                                        580,
                                        530,
                                        740
                                    ],
                                    "type": "inline_equation",
                                    "content": "+1"
                                },
                                {
                                    "bbox": [
                                        104,
                                        580,
                                        530,
                                        740
                                    ],
                                    "type": "text",
                                    "content": ", "
                                },
                                {
                                    "bbox": [
                                        104,
                                        580,
                                        530,
                                        740
                                    ],
                                    "type": "inline_equation",
                                    "content": "- 1"
                                },
                                {
                                    "bbox": [
                                        104,
                                        580,
                                        530,
                                        740
                                    ],
                                    "type": "text",
                                    "content": ", or "
                                },
                                {
                                    "bbox": [
                                        104,
                                        580,
                                        530,
                                        740
                                    ],
                                    "type": "inline_equation",
                                    "content": "0"
                                },
                                {
                                    "bbox": [
                                        104,
                                        580,
                                        530,
                                        740
                                    ],
                                    "type": "text",
                                    "content": " in each step, for a total of nine "
                                },
                                {
                                    "bbox": [
                                        104,
                                        580,
                                        530,
                                        740
                                    ],
                                    "type": "inline_equation",
                                    "content": "(3 \\times 3)"
                                },
                                {
                                    "bbox": [
                                        104,
                                        580,
                                        530,
                                        740
                                    ],
                                    "type": "text",
                                    "content": " actions. Both velocity components are restricted to be nonnegative and less than 5, and they cannot both be zero except at the starting line. Each episode begins in one of the randomly selected start states with both velocity components zero and ends when the car crosses the finish line. The rewards are "
                                },
                                {
                                    "bbox": [
                                        104,
                                        580,
                                        530,
                                        740
                                    ],
                                    "type": "inline_equation",
                                    "content": "- 1"
                                },
                                {
                                    "bbox": [
                                        104,
                                        580,
                                        530,
                                        740
                                    ],
                                    "type": "text",
                                    "content": " for each step until the car crosses the finish line. If the car hits the track boundary, it is moved back to a random position on the starting line, both velocity components are reduced to zero, and the"
                                }
                            ]
                        }
                    ],
                    "index": 19
                }
            ],
            "discarded_blocks": [],
            "page_size": [
                595,
                842
            ],
            "page_idx": 20
        },
        {
            "para_blocks": [
                {
                    "type": "image",
                    "bbox": [
                        96,
                        137,
                        452,
                        329
                    ],
                    "blocks": [
                        {
                            "bbox": [
                                96,
                                137,
                                452,
                                329
                            ],
                            "lines": [
                                {
                                    "bbox": [
                                        96,
                                        137,
                                        452,
                                        329
                                    ],
                                    "spans": [
                                        {
                                            "bbox": [
                                                96,
                                                137,
                                                452,
                                                329
                                            ],
                                            "type": "image",
                                            "image_path": "c6a4365ddfd0c72bface573fd7c623ca659081f11c06a95b643dc719c3ef0b68.jpg"
                                        }
                                    ]
                                }
                            ],
                            "index": 0,
                            "type": "image_body"
                        },
                        {
                            "bbox": [
                                141,
                                341,
                                410,
                                354
                            ],
                            "lines": [
                                {
                                    "bbox": [
                                        141,
                                        341,
                                        410,
                                        354
                                    ],
                                    "spans": [
                                        {
                                            "bbox": [
                                                141,
                                                341,
                                                410,
                                                354
                                            ],
                                            "type": "text",
                                            "content": "Figure 5.5: A couple of right turns for the racetrack task."
                                        }
                                    ]
                                }
                            ],
                            "index": 1,
                            "type": "image_caption"
                        }
                    ],
                    "index": 0
                },
                {
                    "bbox": [
                        64,
                        373,
                        490,
                        479
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                64,
                                373,
                                490,
                                479
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        64,
                                        373,
                                        490,
                                        479
                                    ],
                                    "type": "text",
                                    "content": "episode continues. Before updating the car's location at each time step, check to see if the projected path of the car intersects the track boundary. If it intersects the finish line, the episode ends; if it intersects anywhere else, the car is considered to have hit the track boundary and is sent back to the starting line. To make the task more challenging, with probability 0.1 at each time step the velocity increments are both zero, independently of the intended increments. Apply a Monte Carlo control method to this task to compute the optimal policy from each starting state. Exhibit several trajectories following the optimal policy (but turn the noise off for these trajectories)."
                                }
                            ]
                        }
                    ],
                    "index": 2
                },
                {
                    "bbox": [
                        64,
                        502,
                        433,
                        522
                    ],
                    "type": "title",
                    "lines": [
                        {
                            "bbox": [
                                64,
                                502,
                                433,
                                522
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        64,
                                        502,
                                        433,
                                        522
                                    ],
                                    "type": "text",
                                    "content": "5.8 *Discounting-aware Importance Sampling"
                                }
                            ]
                        }
                    ],
                    "index": 3,
                    "level": 1
                },
                {
                    "bbox": [
                        64,
                        532,
                        490,
                        599
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                64,
                                532,
                                490,
                                599
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        64,
                                        532,
                                        490,
                                        599
                                    ],
                                    "type": "text",
                                    "content": "The off- policy methods that we have considered so far are based on forming importance- sampling weights for returns considered as unitary wholes, without taking into account the returns' internal structures as sums of discounted rewards. We now briefly consider cutting- edge research ideas for using this structure to significantly reduce the variance of off- policy estimators."
                                }
                            ]
                        }
                    ],
                    "index": 4
                },
                {
                    "bbox": [
                        64,
                        601,
                        490,
                        753
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                64,
                                601,
                                490,
                                753
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        64,
                                        601,
                                        490,
                                        753
                                    ],
                                    "type": "text",
                                    "content": "For example, consider the case where episodes are long and "
                                },
                                {
                                    "bbox": [
                                        64,
                                        601,
                                        490,
                                        753
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\gamma"
                                },
                                {
                                    "bbox": [
                                        64,
                                        601,
                                        490,
                                        753
                                    ],
                                    "type": "text",
                                    "content": " is significantly less than 1. For concreteness, say that episodes last 100 steps and that "
                                },
                                {
                                    "bbox": [
                                        64,
                                        601,
                                        490,
                                        753
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\gamma = 0"
                                },
                                {
                                    "bbox": [
                                        64,
                                        601,
                                        490,
                                        753
                                    ],
                                    "type": "text",
                                    "content": ". The return from time 0 will then be just "
                                },
                                {
                                    "bbox": [
                                        64,
                                        601,
                                        490,
                                        753
                                    ],
                                    "type": "inline_equation",
                                    "content": "G_{0} = R_{1}"
                                },
                                {
                                    "bbox": [
                                        64,
                                        601,
                                        490,
                                        753
                                    ],
                                    "type": "text",
                                    "content": ", but its importance sampling ratio will be a product of 100 factors, "
                                },
                                {
                                    "bbox": [
                                        64,
                                        601,
                                        490,
                                        753
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\frac{\\pi(A_{0}|S_{0})}{b(A_{0}|S_{0})} \\frac{\\pi(A_{1}|S_{1})}{b(A_{1}|S_{1})} \\dots \\frac{\\pi(A_{99}|S_{99})}{b(A_{99}|S_{99})}"
                                },
                                {
                                    "bbox": [
                                        64,
                                        601,
                                        490,
                                        753
                                    ],
                                    "type": "text",
                                    "content": ". In ordinary importance sampling, the return will be scaled by the entire product, but it is really only necessary to scale by the first factor, by "
                                },
                                {
                                    "bbox": [
                                        64,
                                        601,
                                        490,
                                        753
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\frac{\\pi(A_{0}|S_{0})}{b(A_{0}|S_{0})}"
                                },
                                {
                                    "bbox": [
                                        64,
                                        601,
                                        490,
                                        753
                                    ],
                                    "type": "text",
                                    "content": ". The other 99 factors "
                                },
                                {
                                    "bbox": [
                                        64,
                                        601,
                                        490,
                                        753
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\frac{\\pi(A_{1}|S_{1})}{b(A_{1}|S_{1})} \\dots \\frac{\\pi(A_{99}|S_{99})}{b(A_{99}|S_{99})}"
                                },
                                {
                                    "bbox": [
                                        64,
                                        601,
                                        490,
                                        753
                                    ],
                                    "type": "text",
                                    "content": " are irrelevant because after the first reward the return has already been determined. These later factors are all independent of the return and of expected value 1; they do not change the expected update, but they add enormously to its variance. In some cases they could even make the variance infinite. Let us now consider an idea for avoiding this large extraneous variance."
                                }
                            ]
                        }
                    ],
                    "index": 5
                }
            ],
            "discarded_blocks": [],
            "page_size": [
                595,
                842
            ],
            "page_idx": 21
        },
        {
            "para_blocks": [
                {
                    "bbox": [
                        104,
                        140,
                        530,
                        261
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                104,
                                140,
                                530,
                                261
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        104,
                                        140,
                                        530,
                                        261
                                    ],
                                    "type": "text",
                                    "content": "The essence of the idea is to think of discounting as determining a probability of termination or, equivalently, a degree of partial termination. For any "
                                },
                                {
                                    "bbox": [
                                        104,
                                        140,
                                        530,
                                        261
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\gamma \\in [0,1)"
                                },
                                {
                                    "bbox": [
                                        104,
                                        140,
                                        530,
                                        261
                                    ],
                                    "type": "text",
                                    "content": ", we can think of the return "
                                },
                                {
                                    "bbox": [
                                        104,
                                        140,
                                        530,
                                        261
                                    ],
                                    "type": "inline_equation",
                                    "content": "G_{0}"
                                },
                                {
                                    "bbox": [
                                        104,
                                        140,
                                        530,
                                        261
                                    ],
                                    "type": "text",
                                    "content": " as partly terminating in one step, to the degree "
                                },
                                {
                                    "bbox": [
                                        104,
                                        140,
                                        530,
                                        261
                                    ],
                                    "type": "inline_equation",
                                    "content": "1 - \\gamma"
                                },
                                {
                                    "bbox": [
                                        104,
                                        140,
                                        530,
                                        261
                                    ],
                                    "type": "text",
                                    "content": ", producing a return of just the first reward, "
                                },
                                {
                                    "bbox": [
                                        104,
                                        140,
                                        530,
                                        261
                                    ],
                                    "type": "inline_equation",
                                    "content": "R_{1}"
                                },
                                {
                                    "bbox": [
                                        104,
                                        140,
                                        530,
                                        261
                                    ],
                                    "type": "text",
                                    "content": ", and as partly terminating after two steps, to the degree "
                                },
                                {
                                    "bbox": [
                                        104,
                                        140,
                                        530,
                                        261
                                    ],
                                    "type": "inline_equation",
                                    "content": "(1 - \\gamma)\\gamma"
                                },
                                {
                                    "bbox": [
                                        104,
                                        140,
                                        530,
                                        261
                                    ],
                                    "type": "text",
                                    "content": ", producing a return of "
                                },
                                {
                                    "bbox": [
                                        104,
                                        140,
                                        530,
                                        261
                                    ],
                                    "type": "inline_equation",
                                    "content": "R_{1} + R_{2}"
                                },
                                {
                                    "bbox": [
                                        104,
                                        140,
                                        530,
                                        261
                                    ],
                                    "type": "text",
                                    "content": ", and so on. The latter degree corresponds to terminating on the second step, "
                                },
                                {
                                    "bbox": [
                                        104,
                                        140,
                                        530,
                                        261
                                    ],
                                    "type": "inline_equation",
                                    "content": "1 - \\gamma"
                                },
                                {
                                    "bbox": [
                                        104,
                                        140,
                                        530,
                                        261
                                    ],
                                    "type": "text",
                                    "content": ", and not having already terminated on the first step, "
                                },
                                {
                                    "bbox": [
                                        104,
                                        140,
                                        530,
                                        261
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\gamma"
                                },
                                {
                                    "bbox": [
                                        104,
                                        140,
                                        530,
                                        261
                                    ],
                                    "type": "text",
                                    "content": ". The degree of termination on the third step is thus "
                                },
                                {
                                    "bbox": [
                                        104,
                                        140,
                                        530,
                                        261
                                    ],
                                    "type": "inline_equation",
                                    "content": "(1 - \\gamma)\\gamma^{2}"
                                },
                                {
                                    "bbox": [
                                        104,
                                        140,
                                        530,
                                        261
                                    ],
                                    "type": "text",
                                    "content": ", with the "
                                },
                                {
                                    "bbox": [
                                        104,
                                        140,
                                        530,
                                        261
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\gamma^{2}"
                                },
                                {
                                    "bbox": [
                                        104,
                                        140,
                                        530,
                                        261
                                    ],
                                    "type": "text",
                                    "content": " reflecting that termination did not occur on either of the first two steps. The partial returns here are called flat partial returns:"
                                }
                            ]
                        }
                    ],
                    "index": 0
                },
                {
                    "bbox": [
                        132,
                        268,
                        380,
                        282
                    ],
                    "type": "interline_equation",
                    "lines": [
                        {
                            "bbox": [
                                132,
                                268,
                                380,
                                282
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        132,
                                        268,
                                        380,
                                        282
                                    ],
                                    "type": "interline_equation",
                                    "content": "\\bar{G}_{t:h} \\doteq R_{t + 1} + R_{t + 2} + \\dots + R_{h}, \\qquad 0 \\leq t < h \\leq T,",
                                    "image_path": "0a5ef34b222f6cec4cdcd07e5ae8737755e964f6441b99276b757fbeca5a6056.jpg"
                                }
                            ]
                        }
                    ],
                    "index": 1
                },
                {
                    "bbox": [
                        104,
                        289,
                        530,
                        343
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                104,
                                289,
                                530,
                                343
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        104,
                                        289,
                                        530,
                                        343
                                    ],
                                    "type": "text",
                                    "content": "where \"flat\" denotes the absence of discounting, and \"partial\" denotes that these returns do not extend all the way to termination but instead stop at "
                                },
                                {
                                    "bbox": [
                                        104,
                                        289,
                                        530,
                                        343
                                    ],
                                    "type": "inline_equation",
                                    "content": "h"
                                },
                                {
                                    "bbox": [
                                        104,
                                        289,
                                        530,
                                        343
                                    ],
                                    "type": "text",
                                    "content": ", called the horizon (and "
                                },
                                {
                                    "bbox": [
                                        104,
                                        289,
                                        530,
                                        343
                                    ],
                                    "type": "inline_equation",
                                    "content": "T"
                                },
                                {
                                    "bbox": [
                                        104,
                                        289,
                                        530,
                                        343
                                    ],
                                    "type": "text",
                                    "content": " is the time of termination of the episode). The conventional full return "
                                },
                                {
                                    "bbox": [
                                        104,
                                        289,
                                        530,
                                        343
                                    ],
                                    "type": "inline_equation",
                                    "content": "G_{t}"
                                },
                                {
                                    "bbox": [
                                        104,
                                        289,
                                        530,
                                        343
                                    ],
                                    "type": "text",
                                    "content": " can be viewed as a sum of flat partial returns as suggested above as follows:"
                                }
                            ]
                        }
                    ],
                    "index": 2
                },
                {
                    "bbox": [
                        132,
                        349,
                        378,
                        520
                    ],
                    "type": "interline_equation",
                    "lines": [
                        {
                            "bbox": [
                                132,
                                349,
                                378,
                                520
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        132,
                                        349,
                                        378,
                                        520
                                    ],
                                    "type": "interline_equation",
                                    "content": "\\begin{array}{r l} & {G_{t}\\doteq R_{t + 1} + \\gamma R_{t + 2} + \\gamma^{2}R_{t + 3} + \\dots +\\gamma^{T - t - 1}R_{T}}\\\\ & {\\quad = (1 - \\gamma)R_{t + 1}}\\\\ & {\\qquad +(1 - \\gamma)\\gamma (R_{t + 1} + R_{t + 2})}\\\\ & {\\qquad +(1 - \\gamma)\\gamma^{2}(R_{t + 1} + R_{t + 2} + R_{t + 3})}\\\\ & {\\qquad \\vdots}\\\\ & {\\qquad +(1 - \\gamma)\\gamma^{T - t - 2}(R_{t + 1} + R_{t + 2} + \\dots +R_{T - 1})}\\\\ & {\\qquad +\\gamma^{T - t - 1}(R_{t + 1} + R_{t + 2} + \\dots +R_{T})}\\\\ & {\\qquad = (1 - \\gamma)\\sum_{h = t + 1}^{T - 1}\\gamma^{h - t - 1}\\bar{G}_{t:h} + \\gamma^{T - t - 1}\\bar{G}_{t:T}.} \\end{array}",
                                    "image_path": "8f0d64a87ae630262dd5e5a22d811bbb258979c457fa1f64571a7ee114b92ae9.jpg"
                                }
                            ]
                        }
                    ],
                    "index": 3
                },
                {
                    "bbox": [
                        104,
                        525,
                        530,
                        579
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                104,
                                525,
                                530,
                                579
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        104,
                                        525,
                                        530,
                                        579
                                    ],
                                    "type": "text",
                                    "content": "Now we need to scale the flat partial returns by an importance sampling ratio that is similarly truncated. As "
                                },
                                {
                                    "bbox": [
                                        104,
                                        525,
                                        530,
                                        579
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\bar{G}_{t:h}"
                                },
                                {
                                    "bbox": [
                                        104,
                                        525,
                                        530,
                                        579
                                    ],
                                    "type": "text",
                                    "content": " only involves rewards up to a horizon "
                                },
                                {
                                    "bbox": [
                                        104,
                                        525,
                                        530,
                                        579
                                    ],
                                    "type": "inline_equation",
                                    "content": "h"
                                },
                                {
                                    "bbox": [
                                        104,
                                        525,
                                        530,
                                        579
                                    ],
                                    "type": "text",
                                    "content": ", we only need the ratio of the probabilities up to "
                                },
                                {
                                    "bbox": [
                                        104,
                                        525,
                                        530,
                                        579
                                    ],
                                    "type": "inline_equation",
                                    "content": "h - 1"
                                },
                                {
                                    "bbox": [
                                        104,
                                        525,
                                        530,
                                        579
                                    ],
                                    "type": "text",
                                    "content": ". We define an ordinary importance- sampling estimator, analogous to (5.5), as"
                                }
                            ]
                        }
                    ],
                    "index": 4
                },
                {
                    "bbox": [
                        104,
                        584,
                        528,
                        623
                    ],
                    "type": "interline_equation",
                    "lines": [
                        {
                            "bbox": [
                                104,
                                584,
                                528,
                                623
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        104,
                                        584,
                                        528,
                                        623
                                    ],
                                    "type": "interline_equation",
                                    "content": "V(s) \\doteq \\frac{\\sum_{t \\in \\mathcal{T}(s)} \\left((1 - \\gamma) \\sum_{h = t + 1}^{T(t) - 1} \\gamma^{h - t - 1} \\rho_{t:h - 1} \\bar{G}_{t:h} + \\gamma^{T(t) - t - 1} \\rho_{t:T(t) - 1} \\bar{G}_{t:T(t)}\\right)}{|\\mathcal{T}(s)|}, \\tag{5.9}",
                                    "image_path": "6d26c3969ff9b613da55bca8afda2b20878869d35a0d4e4f9bc2f9808004df06.jpg"
                                }
                            ]
                        }
                    ],
                    "index": 5
                },
                {
                    "bbox": [
                        104,
                        628,
                        445,
                        643
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                104,
                                628,
                                445,
                                643
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        104,
                                        628,
                                        445,
                                        643
                                    ],
                                    "type": "text",
                                    "content": "and a weighted importance- sampling estimator, analogous to (5.6), as"
                                }
                            ]
                        }
                    ],
                    "index": 6
                },
                {
                    "bbox": [
                        104,
                        648,
                        528,
                        694
                    ],
                    "type": "interline_equation",
                    "lines": [
                        {
                            "bbox": [
                                104,
                                648,
                                528,
                                694
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        104,
                                        648,
                                        528,
                                        694
                                    ],
                                    "type": "interline_equation",
                                    "content": "V(s) \\doteq \\frac{\\sum_{t \\in \\mathcal{T}(s)} \\left((1 - \\gamma) \\sum_{h = t + 1}^{T(t) - 1} \\gamma^{h - t - 1} \\rho_{t:h - 1} \\bar{G}_{t:h} + \\gamma^{T(t) - t - 1} \\rho_{T:T(t) - 1} \\bar{G}_{t:T(t)}\\right)}{\\sum_{t \\in \\mathcal{T}(s)} \\left((1 - \\gamma) \\sum_{h = t + 1}^{T(t) - 1} \\gamma^{h - t - 1} \\rho_{t:h - 1} + \\gamma^{T(t) - t - 1} \\rho_{T:T(t) - 1}\\right)}. \\tag{5.10}",
                                    "image_path": "97625ee9723612d5b1c7984a27835df3d06626e47452d4692acfe0eed7221902.jpg"
                                }
                            ]
                        }
                    ],
                    "index": 7
                },
                {
                    "bbox": [
                        104,
                        700,
                        530,
                        740
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                104,
                                700,
                                530,
                                740
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        104,
                                        700,
                                        530,
                                        740
                                    ],
                                    "type": "text",
                                    "content": "We call these two estimators discounting- aware importance sampling estimators. They take into account the discount rate but have no effect (are the same as the off- policy estimators from Section 5.5) if "
                                },
                                {
                                    "bbox": [
                                        104,
                                        700,
                                        530,
                                        740
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\gamma = 1"
                                },
                                {
                                    "bbox": [
                                        104,
                                        700,
                                        530,
                                        740
                                    ],
                                    "type": "text",
                                    "content": "."
                                }
                            ]
                        }
                    ],
                    "index": 8
                }
            ],
            "discarded_blocks": [],
            "page_size": [
                595,
                842
            ],
            "page_idx": 22
        },
        {
            "para_blocks": [
                {
                    "bbox": [
                        64,
                        137,
                        386,
                        154
                    ],
                    "type": "title",
                    "lines": [
                        {
                            "bbox": [
                                64,
                                137,
                                386,
                                154
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        64,
                                        137,
                                        386,
                                        154
                                    ],
                                    "type": "text",
                                    "content": "5.9 \\*Per-decision Importance Sampling"
                                }
                            ]
                        }
                    ],
                    "index": 0,
                    "level": 1
                },
                {
                    "bbox": [
                        64,
                        167,
                        490,
                        221
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                64,
                                167,
                                490,
                                221
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        64,
                                        167,
                                        490,
                                        221
                                    ],
                                    "type": "text",
                                    "content": "There is one more way in which the structure of the return as a sum of rewards can be taken into account in off- policy importance sampling, a way that may be able to reduce variance even in the absence of discounting (that is, even if "
                                },
                                {
                                    "bbox": [
                                        64,
                                        167,
                                        490,
                                        221
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\gamma = 1"
                                },
                                {
                                    "bbox": [
                                        64,
                                        167,
                                        490,
                                        221
                                    ],
                                    "type": "text",
                                    "content": " ). In the off- policy estimators (5.5) and (5.6), each term of the sum in the numerator is itself a sum:"
                                }
                            ]
                        }
                    ],
                    "index": 1
                },
                {
                    "bbox": [
                        91,
                        232,
                        489,
                        270
                    ],
                    "type": "interline_equation",
                    "lines": [
                        {
                            "bbox": [
                                91,
                                232,
                                489,
                                270
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        91,
                                        232,
                                        489,
                                        270
                                    ],
                                    "type": "interline_equation",
                                    "content": "\\begin{array}{r l} & {\\rho_{t:T - 1}G_{t} = \\rho_{t:T - 1}\\left(R_{t + 1} + \\gamma R_{t + 2} + \\dots +\\gamma^{T - t - 1}R_{T}\\right)}\\\\ & {\\qquad = \\rho_{t:T - 1}R_{t + 1} + \\gamma \\rho_{t:T - 1}R_{t + 2} + \\dots +\\gamma^{T - t - 1}\\rho_{t:T - 1}R_{T}.} \\end{array} \\tag{5.11}",
                                    "image_path": "a9fd5bb389c35a64a47dc9277eff07a4f73bf74dc946531552880e4e2a3dc48b.jpg"
                                }
                            ]
                        }
                    ],
                    "index": 2
                },
                {
                    "bbox": [
                        63,
                        281,
                        490,
                        334
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                63,
                                281,
                                490,
                                334
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        63,
                                        281,
                                        490,
                                        334
                                    ],
                                    "type": "text",
                                    "content": "The off- policy estimators rely on the expected values of these terms, which can be written in a simpler way. Note that each sub- term of (5.11) is a product of a random reward and a random importance- sampling ratio. For example, the first sub- term can be written, using (5.3), as"
                                }
                            ]
                        }
                    ],
                    "index": 3
                },
                {
                    "bbox": [
                        91,
                        346,
                        489,
                        376
                    ],
                    "type": "interline_equation",
                    "lines": [
                        {
                            "bbox": [
                                91,
                                346,
                                489,
                                376
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        91,
                                        346,
                                        489,
                                        376
                                    ],
                                    "type": "interline_equation",
                                    "content": "\\rho_{t:T - 1}R_{t + 1} = \\frac{\\pi(A_{t}|S_{k})}{b(A_{t}|S_{k})}\\frac{\\pi(A_{t + 1}|S_{t + 1})}{b(A_{t + 1}|S_{t + 1})}\\frac{\\pi(A_{t + 2}|S_{t + 2})}{b(A_{t + 2}|S_{t + 2})}\\dots \\frac{\\pi(A_{T - 1}|S_{T - 1})}{b(A_{T - 1}|S_{T - 1})} R_{t + 1}. \\tag{5.12}",
                                    "image_path": "24f29549c878e876ad38614d77c93e1d438ea59aa6b9e45f6914772140e7e12e.jpg"
                                }
                            ]
                        }
                    ],
                    "index": 4
                },
                {
                    "bbox": [
                        63,
                        389,
                        490,
                        429
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                63,
                                389,
                                490,
                                429
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        63,
                                        389,
                                        490,
                                        429
                                    ],
                                    "type": "text",
                                    "content": "Of all these factors, one might suspect that only the first and the last (the reward) are related; all the others are for events that occurred after the reward. Moreover, the expected value of all these other factors is one:"
                                }
                            ]
                        }
                    ],
                    "index": 5
                },
                {
                    "bbox": [
                        91,
                        441,
                        489,
                        474
                    ],
                    "type": "interline_equation",
                    "lines": [
                        {
                            "bbox": [
                                91,
                                441,
                                489,
                                474
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        91,
                                        441,
                                        489,
                                        474
                                    ],
                                    "type": "interline_equation",
                                    "content": "\\mathbb{E}\\bigg[\\frac{\\pi(A_{k}|S_{k})}{b(A_{k}|S_{k})}\\bigg]\\doteq \\sum_{a}b(a|S_{k})\\frac{\\pi(a|S_{k})}{b(a|S_{k})} = \\sum_{a}\\pi (a|S_{k}) = 1. \\tag{5.13}",
                                    "image_path": "2c5bd351afc397320d7978cf2eb8dfe7605902444d9b3db2ae17cbd502a6afca.jpg"
                                }
                            ]
                        }
                    ],
                    "index": 6
                },
                {
                    "bbox": [
                        63,
                        486,
                        489,
                        513
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                63,
                                486,
                                489,
                                513
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        63,
                                        486,
                                        489,
                                        513
                                    ],
                                    "type": "text",
                                    "content": "With a few more steps, one can show that, as suspected, all of these other factors have no effect in expectation, in other words, that"
                                }
                            ]
                        }
                    ],
                    "index": 7
                },
                {
                    "bbox": [
                        91,
                        527,
                        489,
                        541
                    ],
                    "type": "interline_equation",
                    "lines": [
                        {
                            "bbox": [
                                91,
                                527,
                                489,
                                541
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        91,
                                        527,
                                        489,
                                        541
                                    ],
                                    "type": "interline_equation",
                                    "content": "\\mathbb{E}[\\rho_{t:T - 1}R_{t + 1}] = \\mathbb{E}[\\rho_{t:t}R_{t + 1}]. \\tag{5.14}",
                                    "image_path": "c29ea20ff0b42f26fa3f8bb9ec3b5800850ecd291ff4d206f1161efb9685072d.jpg"
                                }
                            ]
                        }
                    ],
                    "index": 8
                },
                {
                    "bbox": [
                        63,
                        554,
                        370,
                        568
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                63,
                                554,
                                370,
                                568
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        63,
                                        554,
                                        370,
                                        568
                                    ],
                                    "type": "text",
                                    "content": "If we repeat this process for the "
                                },
                                {
                                    "bbox": [
                                        63,
                                        554,
                                        370,
                                        568
                                    ],
                                    "type": "inline_equation",
                                    "content": "k"
                                },
                                {
                                    "bbox": [
                                        63,
                                        554,
                                        370,
                                        568
                                    ],
                                    "type": "text",
                                    "content": " th sub- term of (5.11), we get"
                                }
                            ]
                        }
                    ],
                    "index": 9
                },
                {
                    "bbox": [
                        92,
                        584,
                        257,
                        597
                    ],
                    "type": "interline_equation",
                    "lines": [
                        {
                            "bbox": [
                                92,
                                584,
                                257,
                                597
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        92,
                                        584,
                                        257,
                                        597
                                    ],
                                    "type": "interline_equation",
                                    "content": "\\mathbb{E}[\\rho_{t:T - 1}R_{t + k}] = \\mathbb{E}[\\rho_{t:t + k - 1}R_{t + k}].",
                                    "image_path": "aab933e88c66b524c3ec66ff9fd87ad673d53b5f5ba6fd55419566991f8f24d2.jpg"
                                }
                            ]
                        }
                    ],
                    "index": 10
                },
                {
                    "bbox": [
                        63,
                        610,
                        443,
                        623
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                63,
                                610,
                                443,
                                623
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        63,
                                        610,
                                        443,
                                        623
                                    ],
                                    "type": "text",
                                    "content": "It follows then that the expectation of our original term (5.11) can be written"
                                }
                            ]
                        }
                    ],
                    "index": 11
                },
                {
                    "bbox": [
                        92,
                        638,
                        199,
                        660
                    ],
                    "type": "interline_equation",
                    "lines": [
                        {
                            "bbox": [
                                92,
                                638,
                                199,
                                660
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        92,
                                        638,
                                        199,
                                        660
                                    ],
                                    "type": "interline_equation",
                                    "content": "\\mathbb{E}[\\rho_{t:T - 1}G_{t}] = \\mathbb{E}\\left[\\tilde{G}_{t}\\right],",
                                    "image_path": "45eafc9458f2ffac42324f9217e729f9dc0f41b71d5a805d41f270fdea2a5251.jpg"
                                }
                            ]
                        }
                    ],
                    "index": 12
                },
                {
                    "bbox": [
                        63,
                        671,
                        94,
                        684
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                63,
                                671,
                                94,
                                684
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        63,
                                        671,
                                        94,
                                        684
                                    ],
                                    "type": "text",
                                    "content": "where"
                                }
                            ]
                        }
                    ],
                    "index": 13
                },
                {
                    "bbox": [
                        92,
                        698,
                        427,
                        714
                    ],
                    "type": "interline_equation",
                    "lines": [
                        {
                            "bbox": [
                                92,
                                698,
                                427,
                                714
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        92,
                                        698,
                                        427,
                                        714
                                    ],
                                    "type": "interline_equation",
                                    "content": "\\tilde{G}_{t} = \\rho_{t:t}R_{t + 1} + \\gamma \\rho_{t:t + 1}R_{t + 2} + \\gamma^{2}\\rho_{t:t + 2}R_{t + 3} + \\dots +\\gamma^{T - t - 1}\\rho_{t:T - 1}R_{T}.",
                                    "image_path": "2ab7637d76e8ddc224a6e2641ec3051e015299eaa828eb9ed69172d5ea3e4422.jpg"
                                }
                            ]
                        }
                    ],
                    "index": 14
                },
                {
                    "bbox": [
                        63,
                        726,
                        315,
                        740
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                63,
                                726,
                                315,
                                740
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        63,
                                        726,
                                        315,
                                        740
                                    ],
                                    "type": "text",
                                    "content": "We call this idea per- decision importance sampling."
                                }
                            ]
                        }
                    ],
                    "index": 15
                }
            ],
            "discarded_blocks": [],
            "page_size": [
                595,
                842
            ],
            "page_idx": 23
        },
        {
            "para_blocks": [
                {
                    "bbox": [
                        104,
                        141,
                        530,
                        181
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                104,
                                141,
                                530,
                                181
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        104,
                                        141,
                                        530,
                                        181
                                    ],
                                    "type": "text",
                                    "content": "It follows immediately that there is an alternate importance- sampling estimator, with the same unbiased expectation (in the first- visit case) as the ordinary- importance- sampling estimator (5.5), using "
                                },
                                {
                                    "bbox": [
                                        104,
                                        141,
                                        530,
                                        181
                                    ],
                                    "type": "inline_equation",
                                    "content": "G_{t}"
                                },
                                {
                                    "bbox": [
                                        104,
                                        141,
                                        530,
                                        181
                                    ],
                                    "type": "text",
                                    "content": ":"
                                }
                            ]
                        }
                    ],
                    "index": 0
                },
                {
                    "bbox": [
                        132,
                        192,
                        528,
                        224
                    ],
                    "type": "interline_equation",
                    "lines": [
                        {
                            "bbox": [
                                132,
                                192,
                                528,
                                224
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        132,
                                        192,
                                        528,
                                        224
                                    ],
                                    "type": "interline_equation",
                                    "content": "V(s)\\triangleq \\frac{\\sum_{t\\in\\mathcal{T}(s)}\\tilde{G}_t}{|\\mathcal{T}(s)|}, \\tag{5.15}",
                                    "image_path": "2bcf3698c0bc0c082dc795caa570fbb789b547c5b31e67e6c66dad4dd497e9c5.jpg"
                                }
                            ]
                        }
                    ],
                    "index": 1
                },
                {
                    "bbox": [
                        104,
                        235,
                        385,
                        248
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                104,
                                235,
                                385,
                                248
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        104,
                                        235,
                                        385,
                                        248
                                    ],
                                    "type": "text",
                                    "content": "which we might expect to sometimes be of lower variance."
                                }
                            ]
                        }
                    ],
                    "index": 2
                },
                {
                    "bbox": [
                        104,
                        250,
                        530,
                        289
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                104,
                                250,
                                530,
                                289
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        104,
                                        250,
                                        530,
                                        289
                                    ],
                                    "type": "text",
                                    "content": "Is there a per- decision version of weighted importance sampling? This is less clear. So far, all the estimators that have been proposed for this that we know of are not consistent (that is, they do not converge to the true value with infinite data)."
                                }
                            ]
                        }
                    ],
                    "index": 3
                },
                {
                    "bbox": [
                        105,
                        293,
                        392,
                        308
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                105,
                                293,
                                392,
                                308
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        105,
                                        293,
                                        392,
                                        308
                                    ],
                                    "type": "text",
                                    "content": "*Exercise 5.13 Show the steps to derive (5.14) from (5.12)."
                                }
                            ]
                        }
                    ],
                    "index": 4
                },
                {
                    "bbox": [
                        104,
                        312,
                        530,
                        352
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                104,
                                312,
                                530,
                                352
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        104,
                                        312,
                                        530,
                                        352
                                    ],
                                    "type": "text",
                                    "content": "*Exercise 5.14 Modify the algorithm for off- policy Monte Carlo control (page 111) to use the idea of the truncated weighted- average estimator (5.10). Note that you will first need to convert this equation to action values."
                                }
                            ]
                        }
                    ],
                    "index": 5
                },
                {
                    "bbox": [
                        104,
                        376,
                        230,
                        394
                    ],
                    "type": "title",
                    "lines": [
                        {
                            "bbox": [
                                104,
                                376,
                                230,
                                394
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        104,
                                        376,
                                        230,
                                        394
                                    ],
                                    "type": "text",
                                    "content": "5.10 Summary"
                                }
                            ]
                        }
                    ],
                    "index": 6,
                    "level": 1
                },
                {
                    "bbox": [
                        104,
                        406,
                        531,
                        538
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                104,
                                406,
                                531,
                                538
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        104,
                                        406,
                                        531,
                                        538
                                    ],
                                    "type": "text",
                                    "content": "The Monte Carlo methods presented in this chapter learn value functions and optimal policies from experience in the form of sample episodes. This gives them at least three kinds of advantages over DP methods. First, they can be used to learn optimal behavior directly from interaction with the environment, with no model of the environment's dynamics. Second, they can be used with simulation or sample models. For surprisingly many applications it is easy to simulate sample episodes even though it is difficult to construct the kind of explicit model of transition probabilities required by DP methods. Third, it is easy and efficient to focus Monte Carlo methods on a small subset of the states. A region of special interest can be accurately evaluated without going to the expense of accurately evaluating the rest of the state set (we explore this further in Chapter 8)."
                                }
                            ]
                        }
                    ],
                    "index": 7
                },
                {
                    "bbox": [
                        104,
                        539,
                        530,
                        593
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                104,
                                539,
                                530,
                                593
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        104,
                                        539,
                                        530,
                                        593
                                    ],
                                    "type": "text",
                                    "content": "A fourth advantage of Monte Carlo methods, which we discuss later in the book, is that they may be less harmed by violations of the Markov property. This is because they do not update their value estimates on the basis of the value estimates of successor states. In other words, it is because they do not bootstrap."
                                }
                            ]
                        }
                    ],
                    "index": 8
                },
                {
                    "bbox": [
                        104,
                        594,
                        531,
                        740
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                104,
                                594,
                                531,
                                740
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        104,
                                        594,
                                        531,
                                        740
                                    ],
                                    "type": "text",
                                    "content": "In designing Monte Carlo control methods we have followed the overall schema of generalized policy iteration (GPI) introduced in Chapter 4. GPI involves interacting processes of policy evaluation and policy improvement. Monte Carlo methods provide an alternative policy evaluation process. Rather than use a model to compute the value of each state, they simply average many returns that start in the state. Because a state's value is the expected return, this average can become a good approximation to the value. In control methods we are particularly interested in approximating action- value functions, because these can be used to improve the policy without requiring a model of the environment's transition dynamics. Monte Carlo methods intermix policy evaluation and policy improvement steps on an episode- by- episode basis, and can be incrementally implemented on an episode- by- episode basis."
                                }
                            ]
                        }
                    ],
                    "index": 9
                }
            ],
            "discarded_blocks": [],
            "page_size": [
                595,
                842
            ],
            "page_idx": 24
        },
        {
            "para_blocks": [
                {
                    "bbox": [
                        64,
                        141,
                        489,
                        273
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                64,
                                141,
                                489,
                                273
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        64,
                                        141,
                                        489,
                                        273
                                    ],
                                    "type": "text",
                                    "content": "Maintaining sufficient exploration is an issue in Monte Carlo control methods. It is not enough just to select the actions currently estimated to be best, because then no returns will be obtained for alternative actions, and it may never be learned that they are actually better. One approach is to ignore this problem by assuming that episodes begin with state- action pairs randomly selected to cover all possibilities. Such exploring starts can sometimes be arranged in applications with simulated episodes, but are unlikely in learning from real experience. In on- policy methods, the agent commits to always exploring and tries to find the best policy that still explores. In off- policy methods, the agent also explores, but learns a deterministic optimal policy that may be unrelated to the policy followed."
                                }
                            ]
                        }
                    ],
                    "index": 0
                },
                {
                    "bbox": [
                        64,
                        275,
                        489,
                        421
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                64,
                                275,
                                489,
                                421
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        64,
                                        275,
                                        489,
                                        421
                                    ],
                                    "type": "text",
                                    "content": "Off- policy prediction refers to learning the value function of a target policy from data generated by a different behavior policy. Such learning methods are based on some form of importance sampling, that is, on weighting returns by the ratio of the probabilities of taking the observed actions under the two policies, thereby transforming their expectations from the behavior policy to the target policy. Ordinary importance sampling uses a simple average of the weighted returns, whereas weighted importance sampling uses a weighted average. Ordinary importance sampling produces unbiased estimates, but has larger, possibly infinite, variance, whereas weighted importance sampling always has finite variance and is preferred in practice. Despite their conceptual simplicity, off- policy Monte Carlo methods for both prediction and control remain unsettled and are a subject of ongoing research."
                                }
                            ]
                        }
                    ],
                    "index": 1
                },
                {
                    "bbox": [
                        64,
                        421,
                        489,
                        513
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                64,
                                421,
                                489,
                                513
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        64,
                                        421,
                                        489,
                                        513
                                    ],
                                    "type": "text",
                                    "content": "The Monte Carlo methods treated in this chapter differ from the DP methods treated in the previous chapter in two major ways. First, they operate on sample experience, and thus can be used for direct learning without a model. Second, they do not bootstrap. That is, they do not update their value estimates on the basis of other value estimates. These two differences are not tightly linked, and can be separated. In the next chapter we consider methods that learn from experience, like Monte Carlo methods, but also bootstrap, like DP methods."
                                }
                            ]
                        }
                    ],
                    "index": 2
                },
                {
                    "bbox": [
                        64,
                        534,
                        374,
                        552
                    ],
                    "type": "title",
                    "lines": [
                        {
                            "bbox": [
                                64,
                                534,
                                374,
                                552
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        64,
                                        534,
                                        374,
                                        552
                                    ],
                                    "type": "text",
                                    "content": "Bibliographical and Historical Remarks"
                                }
                            ]
                        }
                    ],
                    "index": 3,
                    "level": 1
                },
                {
                    "bbox": [
                        64,
                        564,
                        489,
                        617
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                64,
                                564,
                                489,
                                617
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        64,
                                        564,
                                        489,
                                        617
                                    ],
                                    "type": "text",
                                    "content": "The term \"Monte Carlo\" dates from the 1940s, when physicists at Los Alamos devised games of chance that they could study to help understand complex physical phenomena relating to the atom bomb. Coverage of Monte Carlo methods in this sense can be found in several textbooks (e.g., Kalos and Whitlock, 1986; Rubinstein, 1981)."
                                }
                            ]
                        }
                    ],
                    "index": 4
                },
                {
                    "bbox": [
                        64,
                        629,
                        489,
                        708
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                64,
                                629,
                                489,
                                708
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        64,
                                        629,
                                        489,
                                        708
                                    ],
                                    "type": "text",
                                    "content": "5.1- 2 Singh and Sutton (1996) distinguished between every- visit and first- visit MC methods and proved results relating these methods to reinforcement learning algorithms. The blackjack example is based on an example used by Widrow, Gupta, and Maitra (1973). The soap bubble example is a classical Dirichlet problem whose Monte Carlo solution was first proposed by Kakutani (1945; see Hersh and Griego, 1969; Doyle and Snell, 1984)."
                                }
                            ]
                        }
                    ],
                    "index": 5
                },
                {
                    "bbox": [
                        103,
                        713,
                        489,
                        740
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                103,
                                713,
                                489,
                                740
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        103,
                                        713,
                                        489,
                                        740
                                    ],
                                    "type": "text",
                                    "content": "Barto and Duff (1994) discussed policy evaluation in the context of classical Monte Carlo algorithms for solving systems of linear equations. They used the"
                                }
                            ]
                        }
                    ],
                    "index": 6
                }
            ],
            "discarded_blocks": [],
            "page_size": [
                595,
                842
            ],
            "page_idx": 25
        },
        {
            "para_blocks": [
                {
                    "bbox": [
                        143,
                        141,
                        529,
                        167
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                143,
                                141,
                                529,
                                167
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        143,
                                        141,
                                        529,
                                        167
                                    ],
                                    "type": "text",
                                    "content": "analysis of Curtiss (1954) to point out the computational advantages of Monte Carlo policy evaluation for large problems."
                                }
                            ]
                        }
                    ],
                    "index": 0
                },
                {
                    "bbox": [
                        104,
                        179,
                        530,
                        325
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                104,
                                179,
                                530,
                                325
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        104,
                                        179,
                                        530,
                                        325
                                    ],
                                    "type": "text",
                                    "content": "5.3- 4 Monte Carlo ES was introduced in the 1998 edition of this book. That may have been the first explicit connection between Monte Carlo estimation and control methods based on policy iteration. An early use of Monte Carlo methods to estimate action values in a reinforcement learning context was by Michie and Chambers (1968). In pole balancing (page 56), they used averages of episode durations to assess the worth (expected balancing \"life\") of each possible action in each state, and then used these assessments to control action selections. Their method is similar in spirit to Monte Carlo ES with every- visit MC estimates. Narendra and Wheeler (1986) studied a Monte Carlo method for ergodic finite Markov chains that used the return accumulated between successive visits to the same state as a reward for adjusting a learning automaton's action probabilities."
                                }
                            ]
                        }
                    ],
                    "index": 1
                },
                {
                    "bbox": [
                        104,
                        337,
                        530,
                        443
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                104,
                                337,
                                530,
                                443
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        104,
                                        337,
                                        530,
                                        443
                                    ],
                                    "type": "text",
                                    "content": "5.5 Efficient off- policy learning has become recognized as an important challenge that arises in several fields. For example, it is closely related to the idea of \"interventions\" and \"counterfactuals\" in probabilistic graphical (Bayesian) models (e.g., Pearl, 1995; Balke and Pearl, 1994). Off- policy methods using importance sampling have a long history and yet still are not well understood. Weighted importance sampling, which is also sometimes called normalized importance sampling (e.g., Koller and Friedman, 2009), is discussed by Rubinstein (1981), Hesterberg (1988), Shelton (2001), and Liu (2001) among others."
                                }
                            ]
                        }
                    ],
                    "index": 2
                },
                {
                    "bbox": [
                        143,
                        448,
                        529,
                        474
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                143,
                                448,
                                529,
                                474
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        143,
                                        448,
                                        529,
                                        474
                                    ],
                                    "type": "text",
                                    "content": "The target policy in off- policy learning is sometimes referred to in the literature as the \"estimation\" policy, as it was in the first edition of this book."
                                }
                            ]
                        }
                    ],
                    "index": 3
                },
                {
                    "bbox": [
                        104,
                        486,
                        529,
                        513
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                104,
                                486,
                                529,
                                513
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        104,
                                        486,
                                        529,
                                        513
                                    ],
                                    "type": "text",
                                    "content": "5.7 The racetrack exercise is adapted from Barto, Braktke, and Singh (1995), and from Gardner (1973)."
                                }
                            ]
                        }
                    ],
                    "index": 4
                },
                {
                    "bbox": [
                        104,
                        526,
                        529,
                        578
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                104,
                                526,
                                529,
                                578
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        104,
                                        526,
                                        529,
                                        578
                                    ],
                                    "type": "text",
                                    "content": "5.8 Our treatment of the idea of discounting- aware importance sampling is based on the analysis of Sutton, Mahmood, Precup, and van Hasselt (2014). It has been worked out most fully to date by Mahmood (2017; Mahmood, van Hasselt, and Sutton, 2014)."
                                }
                            ]
                        }
                    ],
                    "index": 5
                },
                {
                    "bbox": [
                        104,
                        591,
                        530,
                        644
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                104,
                                591,
                                530,
                                644
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        104,
                                        591,
                                        530,
                                        644
                                    ],
                                    "type": "text",
                                    "content": "5.9 Per- decision importance sampling was introduced by Precup, Sutton, and Singh (2000). They also combined off- policy learning with temporal- difference learning, eligibility traces, and approximation methods, introducing subtle issues that we consider in later chapters."
                                }
                            ]
                        }
                    ],
                    "index": 6
                },
                {
                    "bbox": [
                        104,
                        659,
                        530,
                        712
                    ],
                    "type": "text",
                    "lines": [
                        {
                            "bbox": [
                                104,
                                659,
                                530,
                                712
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        104,
                                        659,
                                        530,
                                        712
                                    ],
                                    "type": "text",
                                    "content": "Exercise 5.15 Make new equations analogous to the importance- sampling Monte Carlo estimates (5.5) and (5.6), but for action value estimates "
                                },
                                {
                                    "bbox": [
                                        104,
                                        659,
                                        530,
                                        712
                                    ],
                                    "type": "inline_equation",
                                    "content": "Q(s, a)"
                                },
                                {
                                    "bbox": [
                                        104,
                                        659,
                                        530,
                                        712
                                    ],
                                    "type": "text",
                                    "content": ". You will need new notation "
                                },
                                {
                                    "bbox": [
                                        104,
                                        659,
                                        530,
                                        712
                                    ],
                                    "type": "inline_equation",
                                    "content": "\\mathcal{T}(s, a)"
                                },
                                {
                                    "bbox": [
                                        104,
                                        659,
                                        530,
                                        712
                                    ],
                                    "type": "text",
                                    "content": " for the time steps on which the state- action pair "
                                },
                                {
                                    "bbox": [
                                        104,
                                        659,
                                        530,
                                        712
                                    ],
                                    "type": "inline_equation",
                                    "content": "s, a"
                                },
                                {
                                    "bbox": [
                                        104,
                                        659,
                                        530,
                                        712
                                    ],
                                    "type": "text",
                                    "content": " is visited on the episode. Do these estimates involve more or less importance- sampling correction?"
                                }
                            ]
                        }
                    ],
                    "index": 7
                }
            ],
            "discarded_blocks": [],
            "page_size": [
                595,
                842
            ],
            "page_idx": 26
        }
    ],
    "_backend": "vlm",
    "_version_name": "2.0.6"
}